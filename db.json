{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"themes/sonic/source/css/style.styl","path":"css/style.styl","modified":1,"renderable":1},{"_id":"themes/sonic/source/fancybox/blank.gif","path":"fancybox/blank.gif","modified":1,"renderable":1},{"_id":"themes/sonic/source/fancybox/fancybox_loading.gif","path":"fancybox/fancybox_loading.gif","modified":1,"renderable":1},{"_id":"themes/sonic/source/fancybox/fancybox_loading@2x.gif","path":"fancybox/fancybox_loading@2x.gif","modified":1,"renderable":1},{"_id":"themes/sonic/source/fancybox/fancybox_overlay.png","path":"fancybox/fancybox_overlay.png","modified":1,"renderable":1},{"_id":"themes/sonic/source/fancybox/fancybox_sprite.png","path":"fancybox/fancybox_sprite.png","modified":1,"renderable":1},{"_id":"themes/sonic/source/fancybox/fancybox_sprite@2x.png","path":"fancybox/fancybox_sprite@2x.png","modified":1,"renderable":1},{"_id":"themes/sonic/source/fancybox/jquery.fancybox.css","path":"fancybox/jquery.fancybox.css","modified":1,"renderable":1},{"_id":"themes/sonic/source/js/script.js","path":"js/script.js","modified":1,"renderable":1},{"_id":"themes/sonic/source/fancybox/jquery.fancybox.pack.js","path":"fancybox/jquery.fancybox.pack.js","modified":1,"renderable":1},{"_id":"themes/sonic/source/fancybox/jquery.fancybox.js","path":"fancybox/jquery.fancybox.js","modified":1,"renderable":1},{"_id":"themes/sonic/source/css/fonts/FontAwesome.otf","path":"css/fonts/FontAwesome.otf","modified":1,"renderable":1},{"_id":"themes/sonic/source/css/fonts/fontawesome-webfont.eot","path":"css/fonts/fontawesome-webfont.eot","modified":1,"renderable":1},{"_id":"themes/sonic/source/css/images/aerial.png","path":"css/images/aerial.png","modified":1,"renderable":1},{"_id":"themes/sonic/source/css/fonts/fontawesome-webfont.woff","path":"css/fonts/fontawesome-webfont.woff","modified":1,"renderable":1},{"_id":"themes/sonic/source/css/images/cluster.png","path":"css/images/cluster.png","modified":1,"renderable":1},{"_id":"themes/sonic/source/css/images/portrait.jpg","path":"css/images/portrait.jpg","modified":1,"renderable":1},{"_id":"themes/sonic/source/css/images/ring.png","path":"css/images/ring.png","modified":1,"renderable":1},{"_id":"themes/sonic/source/fancybox/helpers/fancybox_buttons.png","path":"fancybox/helpers/fancybox_buttons.png","modified":1,"renderable":1},{"_id":"themes/sonic/source/fancybox/helpers/jquery.fancybox-buttons.js","path":"fancybox/helpers/jquery.fancybox-buttons.js","modified":1,"renderable":1},{"_id":"themes/sonic/source/fancybox/helpers/jquery.fancybox-buttons.css","path":"fancybox/helpers/jquery.fancybox-buttons.css","modified":1,"renderable":1},{"_id":"themes/sonic/source/fancybox/helpers/jquery.fancybox-media.js","path":"fancybox/helpers/jquery.fancybox-media.js","modified":1,"renderable":1},{"_id":"themes/sonic/source/fancybox/helpers/jquery.fancybox-thumbs.css","path":"fancybox/helpers/jquery.fancybox-thumbs.css","modified":1,"renderable":1},{"_id":"themes/sonic/source/fancybox/helpers/jquery.fancybox-thumbs.js","path":"fancybox/helpers/jquery.fancybox-thumbs.js","modified":1,"renderable":1},{"_id":"themes/sonic/source/css/fonts/fontawesome-webfont.ttf","path":"css/fonts/fontawesome-webfont.ttf","modified":1,"renderable":1},{"_id":"themes/sonic/source/css/fonts/fontawesome-webfont.svg","path":"css/fonts/fontawesome-webfont.svg","modified":1,"renderable":1},{"_id":"themes/sonic/source/css/images/banner.jpg","path":"css/images/banner.jpg","modified":1,"renderable":1}],"Cache":[{"_id":"themes/sonic/Gruntfile.js","hash":"71adaeaac1f3cc56e36c49d549b8d8a72235c9b9","modified":1486062152000},{"_id":"themes/sonic/LICENSE","hash":"c480fce396b23997ee23cc535518ffaaf7f458f8","modified":1486062152000},{"_id":"themes/sonic/.npmignore","hash":"58d26d4b5f2f94c2d02a4e4a448088e4a2527c77","modified":1486062152000},{"_id":"themes/sonic/README.md","hash":"c7e83cfe8f2c724fc9cac32bd71bb5faf9ceeddb","modified":1486062152000},{"_id":"themes/sonic/_config.yml","hash":"d33e3ecf7eee04b4328aebf595c0b3786a52c4b7","modified":1486744784000},{"_id":"themes/sonic/package.json","hash":"85358dc34311c6662e841584e206a4679183943f","modified":1486062152000},{"_id":"source/About/index.md","hash":"7817ba404fa111b29f00946cc79cdcb013054b03","modified":1486733828000},{"_id":"source/_posts/.DS_Store","hash":"7201c8292d07fa4fe62b8fc379bd577c0457d543","modified":1486655988000},{"_id":"source/_posts/Dropping-in-on-my-cluster.md","hash":"e10550b15d37c69b52dc1a7b155d21ff1bf65ff3","modified":1487003719000},{"_id":"source/_posts/I-m-Sure-You-Weren-t-Looking.md","hash":"4bbf894490655fcebc454249cdba90c91776c789","modified":1486504560000},{"_id":"source/_posts/Don-t-block-your-Async-calls.md","hash":"8a626e8f10786fc625064191eacbe1056bbd6551","modified":1492718313000},{"_id":"source/_posts/Mixed-Workload-DSE-Cluster-with-Raspberry-PI-s.md","hash":"b18d2189536545d5012f42eb1ad8077c07c2ff3b","modified":1486760678000},{"_id":"source/_posts/Moving-from-Cassandra-tables-to-Search-with-DataStax-Part-2.md","hash":"11e60443054710ad19b4bcc6ad9ba1b660094dd8","modified":1516380771000},{"_id":"source/_posts/Moving-from-Cassandra-tables-to-Search-with-DataStax-Part-3.md","hash":"bac07c5c6fc3c1f6c660ec2b7d3ec084503c3eb8","modified":1516380777000},{"_id":"source/_posts/Ok-yea-so-maybe-it-s-been-a-while-since-I-posted.md","hash":"33c3f0c825b104b05cd40baaaf8265f50dfeaee2","modified":1515525246000},{"_id":"source/_posts/Moving-from-Cassandra-tables-to-Search-with-DataStax-Part-I.md","hash":"492e3813a86ba0b78613a09347398191c832445b","modified":1516649903000},{"_id":"themes/sonic/languages/default.yml","hash":"3083f319b352d21d80fc5e20113ddf27889c9d11","modified":1486062152000},{"_id":"themes/sonic/languages/nl.yml","hash":"12ed59faba1fc4e8cdd1d42ab55ef518dde8039c","modified":1486062152000},{"_id":"themes/sonic/languages/fr.yml","hash":"84ab164b37c6abf625473e9a0c18f6f815dd5fd9","modified":1486062152000},{"_id":"themes/sonic/languages/no.yml","hash":"965a171e70347215ec726952e63f5b47930931ef","modified":1486062152000},{"_id":"themes/sonic/languages/ru.yml","hash":"4fda301bbd8b39f2c714e2c934eccc4b27c0a2b0","modified":1486062152000},{"_id":"themes/sonic/languages/zh-TW.yml","hash":"53ce3000c5f767759c7d2c4efcaa9049788599c3","modified":1486062152000},{"_id":"themes/sonic/layout/archive.ejs","hash":"2703b07cc8ac64ae46d1d263f4653013c7e1666b","modified":1486062152000},{"_id":"themes/sonic/languages/zh-CN.yml","hash":"ca40697097ab0b3672a80b455d3f4081292d1eed","modified":1486062152000},{"_id":"themes/sonic/layout/category.ejs","hash":"765426a9c8236828dc34759e604cc2c52292835a","modified":1486062152000},{"_id":"themes/sonic/layout/index.ejs","hash":"aa1b4456907bdb43e629be3931547e2d29ac58c8","modified":1486062152000},{"_id":"themes/sonic/layout/page.ejs","hash":"7d80e4e36b14d30a7cd2ac1f61376d9ebf264e8b","modified":1486062152000},{"_id":"themes/sonic/layout/post.ejs","hash":"7d80e4e36b14d30a7cd2ac1f61376d9ebf264e8b","modified":1486062152000},{"_id":"themes/sonic/layout/layout.ejs","hash":"f155824ca6130080bb057fa3e868a743c69c4cf5","modified":1486062152000},{"_id":"themes/sonic/layout/tag.ejs","hash":"eaa7b4ccb2ca7befb90142e4e68995fb1ea68b2e","modified":1486062152000},{"_id":"themes/sonic/scripts/fancybox.js","hash":"aa411cd072399df1ddc8e2181a3204678a5177d9","modified":1486062152000},{"_id":"source/_posts/Mixed-Workload-DSE-Cluster-with-Raspberry-PI-s/raspberrypi.jpg","hash":"272317ca80eae327245bf68500f7c56c353b2dd5","modified":1486588734000},{"_id":"source/_posts/Moving-from-Cassandra-tables-to-Search-with-DataStax-Part-I/overviewarch.png","hash":"6015d84245d41b7a1629f68bd016f0e782690000","modified":1515699175000},{"_id":"source/_posts/Moving-from-Cassandra-tables-to-Search-with-DataStax-Part-I/tagsbyletterexample.png","hash":"d8a24ea71d3d62410f66798e8ea5f2e03cd37ec2","modified":1516646427000},{"_id":"source/_posts/Moving-from-Cassandra-tables-to-Search-with-DataStax-Part-I/tag.png","hash":"763a1e46145c9d40add3ca9a5420ff0e0911bd2c","modified":1515617533000},{"_id":"themes/sonic/layout/_partial/after-footer.ejs","hash":"82a30f81c0e8ba4a8af17acd6cc99e93834e4d5e","modified":1486062152000},{"_id":"themes/sonic/layout/_partial/archive-post.ejs","hash":"c7a71425a946d05414c069ec91811b5c09a92c47","modified":1486062152000},{"_id":"themes/sonic/layout/_partial/article.ejs","hash":"c4c835615d96a950d51fa2c3b5d64d0596534fed","modified":1486062152000},{"_id":"themes/sonic/layout/_partial/archive.ejs","hash":"931aaaffa0910a48199388ede576184ff15793ee","modified":1486062152000},{"_id":"themes/sonic/layout/_partial/google-analytics.ejs","hash":"f921e7f9223d7c95165e0f835f353b2938e40c45","modified":1486062152000},{"_id":"themes/sonic/layout/_partial/footer.ejs","hash":"93518893cf91287e797ebac543c560e2a63b8d0e","modified":1486062152000},{"_id":"themes/sonic/layout/_partial/head.ejs","hash":"4fe8853e864d192701c03e5cd3a5390287b90612","modified":1486062152000},{"_id":"themes/sonic/layout/_partial/sidebar.ejs","hash":"930da35cc2d447a92e5ee8f835735e6fd2232469","modified":1486062152000},{"_id":"themes/sonic/layout/_partial/header.ejs","hash":"3e26f3453d581d76e62512fe2c90b56a0ab4e5d0","modified":1486758694000},{"_id":"themes/sonic/layout/_partial/mobile-nav.ejs","hash":"e952a532dfc583930a666b9d4479c32d4a84b44e","modified":1486062152000},{"_id":"themes/sonic/layout/_widget/archive.ejs","hash":"beb4a86fcc82a9bdda9289b59db5a1988918bec3","modified":1486062152000},{"_id":"themes/sonic/layout/_widget/tag.ejs","hash":"2de380865df9ab5f577f7d3bcadf44261eb5faae","modified":1486062152000},{"_id":"themes/sonic/layout/_widget/category.ejs","hash":"dd1e5af3c6af3f5d6c85dfd5ca1766faed6a0b05","modified":1486062152000},{"_id":"themes/sonic/layout/_widget/recent_posts.ejs","hash":"0d4f064733f8b9e45c0ce131fe4a689d570c883a","modified":1486062152000},{"_id":"themes/sonic/layout/_widget/tagcloud.ejs","hash":"b4a2079101643f63993dcdb32925c9b071763b46","modified":1486062152000},{"_id":"themes/sonic/source/css/_extend.styl","hash":"222fbe6d222531d61c1ef0f868c90f747b1c2ced","modified":1486062152000},{"_id":"themes/sonic/source/css/.DS_Store","hash":"495dc0d217dbc3e7cb0c015a4aa9af3e7011d37f","modified":1486477097000},{"_id":"themes/sonic/source/css/_variables.styl","hash":"8baf64b83bbb118d8191a6e6d7b56b82fbaa5b9d","modified":1486658549000},{"_id":"themes/sonic/source/css/style.styl","hash":"eff7ea0c1c85f78fa5b64b82bcf7c7490f5db7b9","modified":1486746726000},{"_id":"themes/sonic/source/fancybox/blank.gif","hash":"2daeaa8b5f19f0bc209d976c02bd6acb51b00b0a","modified":1486062152000},{"_id":"themes/sonic/source/fancybox/fancybox_loading.gif","hash":"1a755fb2599f3a313cc6cfdb14df043f8c14a99c","modified":1486062152000},{"_id":"themes/sonic/source/fancybox/fancybox_loading@2x.gif","hash":"273b123496a42ba45c3416adb027cd99745058b0","modified":1486062152000},{"_id":"themes/sonic/source/fancybox/fancybox_overlay.png","hash":"b3a4ee645ba494f52840ef8412015ba0f465dbe0","modified":1486062152000},{"_id":"themes/sonic/source/fancybox/fancybox_sprite.png","hash":"17df19f97628e77be09c352bf27425faea248251","modified":1486062152000},{"_id":"themes/sonic/source/fancybox/fancybox_sprite@2x.png","hash":"30c58913f327e28f466a00f4c1ac8001b560aed8","modified":1486062152000},{"_id":"themes/sonic/source/fancybox/jquery.fancybox.css","hash":"aaa582fb9eb4b7092dc69fcb2d5b1c20cca58ab6","modified":1486062152000},{"_id":"themes/sonic/source/js/script.js","hash":"2876e0b19ce557fca38d7c6f49ca55922ab666a1","modified":1486062152000},{"_id":"themes/sonic/source/fancybox/jquery.fancybox.pack.js","hash":"9e0d51ca1dbe66f6c0c7aefd552dc8122e694a6e","modified":1486062152000},{"_id":"themes/sonic/source/fancybox/jquery.fancybox.js","hash":"d08b03a42d5c4ba456ef8ba33116fdbb7a9cabed","modified":1486062152000},{"_id":"source/_posts/Mixed-Workload-DSE-Cluster-with-Raspberry-PI-s/opscenter_cluster.png","hash":"b52da9fb9e980ead1b60435f4adf26ee60ee1150","modified":1486671546000},{"_id":"source/_posts/Mixed-Workload-DSE-Cluster-with-Raspberry-PI-s/pie-pi.jpg","hash":"d93f3955eecc84e21ce33ed9e560016bb62a224e","modified":1486563203000},{"_id":"themes/sonic/layout/_partial/post/category.ejs","hash":"c6bcd0e04271ffca81da25bcff5adf3d46f02fc0","modified":1486062152000},{"_id":"themes/sonic/layout/_partial/post/gallery.ejs","hash":"3d9d81a3c693ff2378ef06ddb6810254e509de5b","modified":1486062152000},{"_id":"themes/sonic/layout/_partial/post/date.ejs","hash":"6197802873157656e3077c5099a7dda3d3b01c29","modified":1486062152000},{"_id":"themes/sonic/layout/_partial/post/nav.ejs","hash":"16a904de7bceccbb36b4267565f2215704db2880","modified":1486062152000},{"_id":"themes/sonic/layout/_partial/post/tag.ejs","hash":"2fcb0bf9c8847a644167a27824c9bb19ac74dd14","modified":1486062152000},{"_id":"themes/sonic/layout/_partial/post/title.ejs","hash":"2f275739b6f1193c123646a5a31f37d48644c667","modified":1486062152000},{"_id":"themes/sonic/source/css/_partial/archive.styl","hash":"203a8803642438c4389dde5b8158e803f556f5eb","modified":1486489179000},{"_id":"themes/sonic/source/css/_partial/comment.styl","hash":"79d280d8d203abb3bd933ca9b8e38c78ec684987","modified":1486062152000},{"_id":"themes/sonic/source/css/_partial/article.styl","hash":"5628c0f28e1e6d257e5ee172a32a9322b0362d9a","modified":1486746745000},{"_id":"themes/sonic/source/css/_partial/footer.styl","hash":"e35a060b8512031048919709a8e7b1ec0e40bc1b","modified":1486062152000},{"_id":"themes/sonic/source/css/_partial/header.styl","hash":"b40437472ec4151355b82a67ae0ca07e23395e82","modified":1486487251000},{"_id":"themes/sonic/source/css/_partial/highlight.styl","hash":"8677f7dc62a69679df3f10fafa67b78cbe84521a","modified":1486659453000},{"_id":"themes/sonic/source/css/_partial/mobile.styl","hash":"a399cf9e1e1cec3e4269066e2948d7ae5854d745","modified":1486062152000},{"_id":"themes/sonic/source/css/_partial/sidebar.styl","hash":"404ec059dc674a48b9ab89cd83f258dec4dcb24d","modified":1486062152000},{"_id":"themes/sonic/source/css/_partial/sidebar-bottom.styl","hash":"8fd4f30d319542babfd31f087ddbac550f000a8a","modified":1486062152000},{"_id":"themes/sonic/source/css/_partial/sidebar-aside.styl","hash":"890349df5145abf46ce7712010c89237900b3713","modified":1486487869000},{"_id":"themes/sonic/source/css/_util/grid.styl","hash":"0bf55ee5d09f193e249083602ac5fcdb1e571aed","modified":1486062152000},{"_id":"themes/sonic/source/css/_util/mixin.styl","hash":"44f32767d9fd3c1c08a60d91f181ee53c8f0dbb3","modified":1486062152000},{"_id":"themes/sonic/source/css/fonts/FontAwesome.otf","hash":"b5b4f9be85f91f10799e87a083da1d050f842734","modified":1486062152000},{"_id":"themes/sonic/source/css/fonts/fontawesome-webfont.eot","hash":"7619748fe34c64fb157a57f6d4ef3678f63a8f5e","modified":1486062152000},{"_id":"themes/sonic/source/css/images/aerial.png","hash":"9280b24baa6825b909b557f153cfd564bb310302","modified":1486398762000},{"_id":"themes/sonic/source/css/fonts/fontawesome-webfont.woff","hash":"04c3bf56d87a0828935bd6b4aee859995f321693","modified":1486062152000},{"_id":"themes/sonic/source/css/images/cluster.png","hash":"05fd049eaea1edc121d3ee7beb70050998b92141","modified":1486398952000},{"_id":"themes/sonic/source/css/images/portrait.jpg","hash":"7b1c23db69ed4870f8444d685d50070d3adf9df1","modified":1486395745000},{"_id":"themes/sonic/source/css/images/ring.png","hash":"86b8b08b45634a1d425baacf15bb28742f8201f1","modified":1486407903000},{"_id":"themes/sonic/source/fancybox/helpers/fancybox_buttons.png","hash":"e385b139516c6813dcd64b8fc431c364ceafe5f3","modified":1486062152000},{"_id":"themes/sonic/source/fancybox/helpers/jquery.fancybox-buttons.js","hash":"dc3645529a4bf72983a39fa34c1eb9146e082019","modified":1486062152000},{"_id":"themes/sonic/source/fancybox/helpers/jquery.fancybox-buttons.css","hash":"1a9d8e5c22b371fcc69d4dbbb823d9c39f04c0c8","modified":1486062152000},{"_id":"themes/sonic/source/fancybox/helpers/jquery.fancybox-media.js","hash":"294420f9ff20f4e3584d212b0c262a00a96ecdb3","modified":1486062152000},{"_id":"source/_posts/Mixed-Workload-DSE-Cluster-with-Raspberry-PI-s/raspberry.jpg","hash":"0f426be98f54895b574ebcf4ca9ebc1378b823d9","modified":1486563203000},{"_id":"themes/sonic/source/fancybox/helpers/jquery.fancybox-thumbs.css","hash":"4ac329c16a5277592fc12a37cca3d72ca4ec292f","modified":1486062152000},{"_id":"themes/sonic/source/fancybox/helpers/jquery.fancybox-thumbs.js","hash":"47da1ae5401c24b5c17cc18e2730780f5c1a7a0c","modified":1486062152000},{"_id":"themes/sonic/source/css/fonts/fontawesome-webfont.ttf","hash":"7f09c97f333917034ad08fa7295e916c9f72fd3f","modified":1486062152000},{"_id":"themes/sonic/source/css/fonts/fontawesome-webfont.svg","hash":"46fcc0194d75a0ddac0a038aee41b23456784814","modified":1486062152000},{"_id":"themes/sonic/source/css/images/banner.jpg","hash":"f44aa591089fcb3ec79770a1e102fd3289a7c6a6","modified":1486062152000},{"_id":"source/_posts/Moving-from-Cassandra-tables-to-Search-with-DataStax-Part-I/typeahead.png","hash":"e83013be7c58eb9d029dac05ca452283b4437bd1","modified":1515679919000},{"_id":"source/_posts/Moving-from-Cassandra-tables-to-Search-with-DataStax-Part-I/morelikethis.png","hash":"907f9bd145dcdbc6bd1b310eed80e8b8d93b2db5","modified":1515618084000},{"_id":"source/_posts/Moving-from-Cassandra-tables-to-Search-with-DataStax-Part-I/videodetail.png","hash":"ddd7aae5daeeb1145b269287f4f7ccef0ffa6667","modified":1515618433000},{"_id":"source/_posts/Mixed-Workload-DSE-Cluster-with-Raspberry-PI-s/myPIs.gif","hash":"c4fcede0402ea86cdb7c8456dead47112caa3189","modified":1486654238000},{"_id":"source/_posts/Dropping-in-on-my-cluster/datastax_drop.gif","hash":"ea2bb1ac95206e178572205412fd7f8da36645b8","modified":1487003427000},{"_id":"public/content.json","hash":"3de676b9366017481922b7c4534099d79fc88b0f","modified":1516650011713},{"_id":"public/About/index.html","hash":"16338fd863a962e47a05654d073d900426350a37","modified":1516650011825},{"_id":"public/2018/01/09/Ok-yea-so-maybe-it-s-been-a-while-since-I-posted/index.html","hash":"cbe284895a21c12d3b5b81501c9e98b06d2e3fd0","modified":1516650011825},{"_id":"public/2017/02/13/Dropping-in-on-my-cluster/index.html","hash":"bae0ce625187c055e32c9bb757fdcf98b9e03a38","modified":1516650011825},{"_id":"public/2017/02/07/I-m-Sure-You-Weren-t-Looking/index.html","hash":"1f60154dd9d6d7604bb278624d062a5f3afb0cf2","modified":1516650011826},{"_id":"public/archives/index.html","hash":"46af21b1b78da617cffffdcc52e525e916566313","modified":1516650011826},{"_id":"public/archives/2017/index.html","hash":"d71879da54911e7fc8b7c18b1aa6a133a733d5f9","modified":1516650011826},{"_id":"public/archives/2017/02/index.html","hash":"65b7827bf5bcff32fec60a5097967b023806c909","modified":1516650011826},{"_id":"public/archives/2017/04/index.html","hash":"acd979a846a909fd5835541c2b56571eee7d303e","modified":1516650011826},{"_id":"public/archives/2018/index.html","hash":"6524c34de7fbb2cc6aed25561232dfc12c92b97f","modified":1516650011826},{"_id":"public/archives/2018/01/index.html","hash":"76cfd06ee135ef483a76e523b8f6f6e675b5d897","modified":1516650011826},{"_id":"public/categories/Something-Else/index.html","hash":"09bf3cdd51ee62b7df14f25924afe71128be32a8","modified":1516650011826},{"_id":"public/categories/Aerial/index.html","hash":"8eb1f3d6db4f18baa5d2422829abace095536bd3","modified":1516650011826},{"_id":"public/categories/Technical/index.html","hash":"063a6b4d3c8e0c905938e994370af5439bdbf5fa","modified":1516650011827},{"_id":"public/tags/hi-there/index.html","hash":"adb21bb31410e112a2d7d8042248e055f84db0d0","modified":1516650011827},{"_id":"public/tags/welcome/index.html","hash":"88c24e33d0b3ea6bd58c03e20761c2d95f4f5948","modified":1516650011827},{"_id":"public/tags/fun-times/index.html","hash":"9cfbb9e9376d46fa9348043452e7bc7e3aa4970c","modified":1516650011827},{"_id":"public/tags/OMG/index.html","hash":"78715876e9fdf2916b2466f1542444d7c8fa3bd8","modified":1516650011827},{"_id":"public/tags/datastax/index.html","hash":"cac20beb732a3750a738ed60de51b90e2a4d4045","modified":1516650011827},{"_id":"public/tags/opscenter/index.html","hash":"3262a991012b330cb371a77c2ec7d8b599532e35","modified":1516650011827},{"_id":"public/tags/aerial/index.html","hash":"b2c2c111825afdd80bcdd85b7aa4a8fddddbf56e","modified":1516650011827},{"_id":"public/tags/drop/index.html","hash":"d5607ef0c2580b2f47cc6b499169dc123505628e","modified":1516650011827},{"_id":"public/tags/TIL/index.html","hash":"ae27933e2e59b0a04b88b6cf1e668c4d65bdfc5b","modified":1516650011827},{"_id":"public/tags/async/index.html","hash":"9ca0c12b66d86778e7dfab5b94ddd8ef3052b1a8","modified":1516650011827},{"_id":"public/tags/blocking/index.html","hash":"30b4758ab40a6317517ef8582d3d5b54d7f59a02","modified":1516650011827},{"_id":"public/tags/java/index.html","hash":"ffdd69da5ee0e517f58d9a8ed143d5a9f3305502","modified":1516650011827},{"_id":"public/tags/killrvideo/index.html","hash":"232f92df549a5c4deaf3ec99b1d0271bb0a338c9","modified":1516650011827},{"_id":"public/tags/raspberry-PI/index.html","hash":"49cad00d85ddf3ba7f4c5f88c25ea278bf5fb05a","modified":1516650011828},{"_id":"public/tags/cluster/index.html","hash":"0cc1b22051aae911235d93f5a461b7ef1e729ba0","modified":1516650011828},{"_id":"public/2018/01/10/Moving-from-Cassandra-tables-to-Search-with-DataStax-Part-I/index.html","hash":"b376180ab7c7679f571a468abdc7b5fe9d23a970","modified":1516650011828},{"_id":"public/2017/04/17/Don-t-block-your-Async-calls/index.html","hash":"b36914ab7eb6ec3a6757015226f66509eaf97168","modified":1516650011828},{"_id":"public/2017/02/07/Mixed-Workload-DSE-Cluster-with-Raspberry-PI-s/index.html","hash":"4fcdbed9839e5ebd3a80ce641b32812c84573dec","modified":1516650011828},{"_id":"public/index.html","hash":"d66e7d21283411b650301b861a38a7c83c4f8883","modified":1516650011828},{"_id":"public/fancybox/blank.gif","hash":"2daeaa8b5f19f0bc209d976c02bd6acb51b00b0a","modified":1516650011848},{"_id":"public/fancybox/fancybox_loading.gif","hash":"1a755fb2599f3a313cc6cfdb14df043f8c14a99c","modified":1516650011848},{"_id":"public/fancybox/fancybox_loading@2x.gif","hash":"273b123496a42ba45c3416adb027cd99745058b0","modified":1516650011849},{"_id":"public/fancybox/fancybox_overlay.png","hash":"b3a4ee645ba494f52840ef8412015ba0f465dbe0","modified":1516650011849},{"_id":"public/fancybox/fancybox_sprite.png","hash":"17df19f97628e77be09c352bf27425faea248251","modified":1516650011849},{"_id":"public/fancybox/fancybox_sprite@2x.png","hash":"30c58913f327e28f466a00f4c1ac8001b560aed8","modified":1516650011849},{"_id":"public/css/fonts/FontAwesome.otf","hash":"b5b4f9be85f91f10799e87a083da1d050f842734","modified":1516650011849},{"_id":"public/css/fonts/fontawesome-webfont.eot","hash":"7619748fe34c64fb157a57f6d4ef3678f63a8f5e","modified":1516650011849},{"_id":"public/css/images/aerial.png","hash":"9280b24baa6825b909b557f153cfd564bb310302","modified":1516650011849},{"_id":"public/css/images/cluster.png","hash":"05fd049eaea1edc121d3ee7beb70050998b92141","modified":1516650011849},{"_id":"public/css/fonts/fontawesome-webfont.woff","hash":"04c3bf56d87a0828935bd6b4aee859995f321693","modified":1516650011849},{"_id":"public/css/images/portrait.jpg","hash":"7b1c23db69ed4870f8444d685d50070d3adf9df1","modified":1516650011849},{"_id":"public/css/images/ring.png","hash":"86b8b08b45634a1d425baacf15bb28742f8201f1","modified":1516650011849},{"_id":"public/fancybox/helpers/fancybox_buttons.png","hash":"e385b139516c6813dcd64b8fc431c364ceafe5f3","modified":1516650011849},{"_id":"public/2017/02/07/Mixed-Workload-DSE-Cluster-with-Raspberry-PI-s/raspberrypi.jpg","hash":"272317ca80eae327245bf68500f7c56c353b2dd5","modified":1516650011849},{"_id":"public/2018/01/10/Moving-from-Cassandra-tables-to-Search-with-DataStax-Part-I/overviewarch.png","hash":"6015d84245d41b7a1629f68bd016f0e782690000","modified":1516650011849},{"_id":"public/2018/01/10/Moving-from-Cassandra-tables-to-Search-with-DataStax-Part-I/tag.png","hash":"763a1e46145c9d40add3ca9a5420ff0e0911bd2c","modified":1516650011849},{"_id":"public/2018/01/10/Moving-from-Cassandra-tables-to-Search-with-DataStax-Part-I/tagsbyletterexample.png","hash":"d8a24ea71d3d62410f66798e8ea5f2e03cd37ec2","modified":1516650011849},{"_id":"public/css/style.css","hash":"49fd3973b38875d6beccfbe16691632784d7eeba","modified":1516650012531},{"_id":"public/css/fonts/fontawesome-webfont.ttf","hash":"7f09c97f333917034ad08fa7295e916c9f72fd3f","modified":1516650012531},{"_id":"public/2017/02/07/Mixed-Workload-DSE-Cluster-with-Raspberry-PI-s/opscenter_cluster.png","hash":"b52da9fb9e980ead1b60435f4adf26ee60ee1150","modified":1516650012533},{"_id":"public/fancybox/jquery.fancybox.css","hash":"aaa582fb9eb4b7092dc69fcb2d5b1c20cca58ab6","modified":1516650012534},{"_id":"public/js/script.js","hash":"2876e0b19ce557fca38d7c6f49ca55922ab666a1","modified":1516650012534},{"_id":"public/fancybox/helpers/jquery.fancybox-buttons.js","hash":"dc3645529a4bf72983a39fa34c1eb9146e082019","modified":1516650012534},{"_id":"public/fancybox/helpers/jquery.fancybox-buttons.css","hash":"1a9d8e5c22b371fcc69d4dbbb823d9c39f04c0c8","modified":1516650012534},{"_id":"public/fancybox/helpers/jquery.fancybox-media.js","hash":"294420f9ff20f4e3584d212b0c262a00a96ecdb3","modified":1516650012534},{"_id":"public/fancybox/helpers/jquery.fancybox-thumbs.css","hash":"4ac329c16a5277592fc12a37cca3d72ca4ec292f","modified":1516650012534},{"_id":"public/fancybox/helpers/jquery.fancybox-thumbs.js","hash":"47da1ae5401c24b5c17cc18e2730780f5c1a7a0c","modified":1516650012534},{"_id":"public/fancybox/jquery.fancybox.pack.js","hash":"9e0d51ca1dbe66f6c0c7aefd552dc8122e694a6e","modified":1516650012534},{"_id":"public/fancybox/jquery.fancybox.js","hash":"d08b03a42d5c4ba456ef8ba33116fdbb7a9cabed","modified":1516650012535},{"_id":"public/2017/02/07/Mixed-Workload-DSE-Cluster-with-Raspberry-PI-s/pie-pi.jpg","hash":"d93f3955eecc84e21ce33ed9e560016bb62a224e","modified":1516650012535},{"_id":"public/css/fonts/fontawesome-webfont.svg","hash":"46fcc0194d75a0ddac0a038aee41b23456784814","modified":1516650012539},{"_id":"public/2017/02/07/Mixed-Workload-DSE-Cluster-with-Raspberry-PI-s/raspberry.jpg","hash":"0f426be98f54895b574ebcf4ca9ebc1378b823d9","modified":1516650012540},{"_id":"public/css/images/banner.jpg","hash":"f44aa591089fcb3ec79770a1e102fd3289a7c6a6","modified":1516650012540},{"_id":"public/2018/01/10/Moving-from-Cassandra-tables-to-Search-with-DataStax-Part-I/typeahead.png","hash":"e83013be7c58eb9d029dac05ca452283b4437bd1","modified":1516650012555},{"_id":"public/2018/01/10/Moving-from-Cassandra-tables-to-Search-with-DataStax-Part-I/morelikethis.png","hash":"907f9bd145dcdbc6bd1b310eed80e8b8d93b2db5","modified":1516650012559},{"_id":"public/2018/01/10/Moving-from-Cassandra-tables-to-Search-with-DataStax-Part-I/videodetail.png","hash":"ddd7aae5daeeb1145b269287f4f7ccef0ffa6667","modified":1516650012564},{"_id":"public/2017/02/07/Mixed-Workload-DSE-Cluster-with-Raspberry-PI-s/myPIs.gif","hash":"c4fcede0402ea86cdb7c8456dead47112caa3189","modified":1516650012566},{"_id":"public/2017/02/13/Dropping-in-on-my-cluster/datastax_drop.gif","hash":"ea2bb1ac95206e178572205412fd7f8da36645b8","modified":1516650012575}],"Category":[{"name":"Something Else","_id":"cjcqm9a5b0003v6km5n0ouenj"},{"name":"Aerial","_id":"cjcqm9a5h0005v6km2jrs7ysz"},{"name":"Technical","_id":"cjcqm9a66000pv6kmu6e5qkte"}],"Data":[],"Page":[{"title":"About me","date":"2017-02-06T20:54:38.000Z","_content":"Hi there, I'm David Gilardi, a nerd, sci-fi, fantasy enthusiast who would like nothing more than to get on the Starship Enterprise (or anything remotely like it that won't explode on its first voyage) and explore the universe.  Until that happens I'll continue playing games, building distributed database clusters, climbing up multi-story strips of fabric while calling it \"art\", and \"improving\" every bit of my house that I can.\n\n## You mentioned distributed databases\nYuppers.  I'm currently a Technical Evangelist at DataStax and let me tell you after 20+ years in my career coding, DBAing, building bare metal and cloud infrastructure, and managing I am a happy camper getting back into some seriously cool tech.  I have a mixed-workload search/graph/Cassandra cluster using 4 Raspberry PI's for my core Cassandra DC.  You can't get much more commodity hardware than PI's and my cluster is humming along quite nicely.\n\n## Strips of fabric?\nYes!  One of my favorite activities is aerial arts.  Seriously, drop the gym, start climbing stuff and your body will thank you.  It also might reward you with some torn, ripped, pulled tendons, ligaments, and muscles, but no matter.  It's all earned pain.  I realize I don't make it sound all that great, but after 5 years I'm still in one piece and love every moment of it (most of the time).\n\nHere is a fun example.  Sorry for the potato quality, it won't happen again.  Turn up the sound and wait for the end. \n{% youtube RywLBWQcrys %}","source":"About/index.md","raw":"---\ntitle: About me\ndate: 2017-02-06 15:54:38\n---\nHi there, I'm David Gilardi, a nerd, sci-fi, fantasy enthusiast who would like nothing more than to get on the Starship Enterprise (or anything remotely like it that won't explode on its first voyage) and explore the universe.  Until that happens I'll continue playing games, building distributed database clusters, climbing up multi-story strips of fabric while calling it \"art\", and \"improving\" every bit of my house that I can.\n\n## You mentioned distributed databases\nYuppers.  I'm currently a Technical Evangelist at DataStax and let me tell you after 20+ years in my career coding, DBAing, building bare metal and cloud infrastructure, and managing I am a happy camper getting back into some seriously cool tech.  I have a mixed-workload search/graph/Cassandra cluster using 4 Raspberry PI's for my core Cassandra DC.  You can't get much more commodity hardware than PI's and my cluster is humming along quite nicely.\n\n## Strips of fabric?\nYes!  One of my favorite activities is aerial arts.  Seriously, drop the gym, start climbing stuff and your body will thank you.  It also might reward you with some torn, ripped, pulled tendons, ligaments, and muscles, but no matter.  It's all earned pain.  I realize I don't make it sound all that great, but after 5 years I'm still in one piece and love every moment of it (most of the time).\n\nHere is a fun example.  Sorry for the potato quality, it won't happen again.  Turn up the sound and wait for the end. \n{% youtube RywLBWQcrys %}","updated":"2017-02-10T13:37:08.000Z","path":"About/index.html","comments":1,"layout":"page","_id":"cjcqm9a540000v6kmyh64z620","content":"<p>Hi there, I’m David Gilardi, a nerd, sci-fi, fantasy enthusiast who would like nothing more than to get on the Starship Enterprise (or anything remotely like it that won’t explode on its first voyage) and explore the universe.  Until that happens I’ll continue playing games, building distributed database clusters, climbing up multi-story strips of fabric while calling it “art”, and “improving” every bit of my house that I can.</p>\n<h2 id=\"You-mentioned-distributed-databases\"><a href=\"#You-mentioned-distributed-databases\" class=\"headerlink\" title=\"You mentioned distributed databases\"></a>You mentioned distributed databases</h2><p>Yuppers.  I’m currently a Technical Evangelist at DataStax and let me tell you after 20+ years in my career coding, DBAing, building bare metal and cloud infrastructure, and managing I am a happy camper getting back into some seriously cool tech.  I have a mixed-workload search/graph/Cassandra cluster using 4 Raspberry PI’s for my core Cassandra DC.  You can’t get much more commodity hardware than PI’s and my cluster is humming along quite nicely.</p>\n<h2 id=\"Strips-of-fabric\"><a href=\"#Strips-of-fabric\" class=\"headerlink\" title=\"Strips of fabric?\"></a>Strips of fabric?</h2><p>Yes!  One of my favorite activities is aerial arts.  Seriously, drop the gym, start climbing stuff and your body will thank you.  It also might reward you with some torn, ripped, pulled tendons, ligaments, and muscles, but no matter.  It’s all earned pain.  I realize I don’t make it sound all that great, but after 5 years I’m still in one piece and love every moment of it (most of the time).</p>\n<p>Here is a fun example.  Sorry for the potato quality, it won’t happen again.  Turn up the sound and wait for the end.<br><div class=\"video-container\"><iframe src=\"//www.youtube.com/embed/RywLBWQcrys\" frameborder=\"0\" allowfullscreen></iframe></div></p>\n","excerpt":"","more":"<p>Hi there, I’m David Gilardi, a nerd, sci-fi, fantasy enthusiast who would like nothing more than to get on the Starship Enterprise (or anything remotely like it that won’t explode on its first voyage) and explore the universe.  Until that happens I’ll continue playing games, building distributed database clusters, climbing up multi-story strips of fabric while calling it “art”, and “improving” every bit of my house that I can.</p>\n<h2 id=\"You-mentioned-distributed-databases\"><a href=\"#You-mentioned-distributed-databases\" class=\"headerlink\" title=\"You mentioned distributed databases\"></a>You mentioned distributed databases</h2><p>Yuppers.  I’m currently a Technical Evangelist at DataStax and let me tell you after 20+ years in my career coding, DBAing, building bare metal and cloud infrastructure, and managing I am a happy camper getting back into some seriously cool tech.  I have a mixed-workload search/graph/Cassandra cluster using 4 Raspberry PI’s for my core Cassandra DC.  You can’t get much more commodity hardware than PI’s and my cluster is humming along quite nicely.</p>\n<h2 id=\"Strips-of-fabric\"><a href=\"#Strips-of-fabric\" class=\"headerlink\" title=\"Strips of fabric?\"></a>Strips of fabric?</h2><p>Yes!  One of my favorite activities is aerial arts.  Seriously, drop the gym, start climbing stuff and your body will thank you.  It also might reward you with some torn, ripped, pulled tendons, ligaments, and muscles, but no matter.  It’s all earned pain.  I realize I don’t make it sound all that great, but after 5 years I’m still in one piece and love every moment of it (most of the time).</p>\n<p>Here is a fun example.  Sorry for the potato quality, it won’t happen again.  Turn up the sound and wait for the end.<br><div class=\"video-container\"><iframe src=\"//www.youtube.com/embed/RywLBWQcrys\" frameborder=\"0\" allowfullscreen></iframe></div></p>\n"}],"Post":[{"title":"I'm Sure You Weren't Looking","date":"2017-02-07T18:51:11.000Z","_content":"Hi there and welcome to my blog.  As the title suggests I am pretty sure you had no idea this blog or page even existed.  This is most likely due to the fact that I had not published anything until....just now.  \n\n\nWow, you are like....\n\n\n**THE FIRST PERSON HERE OMG!**\n<iframe src=\"//giphy.com/embed/l3q2SubtPHg5E3utW?html5=true\" width=\"480\" height=\"266\" frameBorder=\"0\" class=\"giphy-embed\" allowFullScreen></iframe>\n\nSeriously though, thanks for taking a look and make sure to come back and check out my other posts as I muse on things ranging from mishaps while up on silks to technical discussions on distributed database clusters.\n\nIn my next post, I'm going to bring you through my experience setting up a Raspberry PI mixed-worlkload cluster using Cassandra.\n\nSee ya :)","source":"_posts/I-m-Sure-You-Weren-t-Looking.md","raw":"---\ntitle: I'm Sure You Weren't Looking\ndate: 2017-02-07 13:51:11\ncategories:\n    - Something Else\ntags:\n    - hi there\n    - welcome\n    - fun times\n    - OMG\n---\nHi there and welcome to my blog.  As the title suggests I am pretty sure you had no idea this blog or page even existed.  This is most likely due to the fact that I had not published anything until....just now.  \n\n\nWow, you are like....\n\n\n**THE FIRST PERSON HERE OMG!**\n<iframe src=\"//giphy.com/embed/l3q2SubtPHg5E3utW?html5=true\" width=\"480\" height=\"266\" frameBorder=\"0\" class=\"giphy-embed\" allowFullScreen></iframe>\n\nSeriously though, thanks for taking a look and make sure to come back and check out my other posts as I muse on things ranging from mishaps while up on silks to technical discussions on distributed database clusters.\n\nIn my next post, I'm going to bring you through my experience setting up a Raspberry PI mixed-worlkload cluster using Cassandra.\n\nSee ya :)","slug":"I-m-Sure-You-Weren-t-Looking","published":1,"updated":"2017-02-07T21:56:00.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcqm9a560001v6kmzj6f5wkm","content":"<p>Hi there and welcome to my blog.  As the title suggests I am pretty sure you had no idea this blog or page even existed.  This is most likely due to the fact that I had not published anything until….just now.  </p>\n<p>Wow, you are like….</p>\n<p><strong>THE FIRST PERSON HERE OMG!</strong></p>\n<iframe src=\"//giphy.com/embed/l3q2SubtPHg5E3utW?html5=true\" width=\"480\" height=\"266\" frameborder=\"0\" class=\"giphy-embed\" allowfullscreen></iframe>\n\n<p>Seriously though, thanks for taking a look and make sure to come back and check out my other posts as I muse on things ranging from mishaps while up on silks to technical discussions on distributed database clusters.</p>\n<p>In my next post, I’m going to bring you through my experience setting up a Raspberry PI mixed-worlkload cluster using Cassandra.</p>\n<p>See ya :)</p>\n","excerpt":"","more":"<p>Hi there and welcome to my blog.  As the title suggests I am pretty sure you had no idea this blog or page even existed.  This is most likely due to the fact that I had not published anything until….just now.  </p>\n<p>Wow, you are like….</p>\n<p><strong>THE FIRST PERSON HERE OMG!</strong></p>\n<iframe src=\"//giphy.com/embed/l3q2SubtPHg5E3utW?html5=true\" width=\"480\" height=\"266\" frameBorder=\"0\" class=\"giphy-embed\" allowFullScreen></iframe>\n\n<p>Seriously though, thanks for taking a look and make sure to come back and check out my other posts as I muse on things ranging from mishaps while up on silks to technical discussions on distributed database clusters.</p>\n<p>In my next post, I’m going to bring you through my experience setting up a Raspberry PI mixed-worlkload cluster using Cassandra.</p>\n<p>See ya :)</p>\n"},{"title":"Dropping in on my cluster","date":"2017-02-13T16:27:17.000Z","_content":"{% asset_img datastax_drop.gif \"Dropping in on my cluster\" %}\nLooks like my nodes are healthy.  :)","source":"_posts/Dropping-in-on-my-cluster.md","raw":"---\ntitle: Dropping in on my cluster\ndate: 2017-02-13 11:27:17\ntags:\n    - datastax\n    - opscenter\n    - aerial\n    - drop\ncategories: Aerial\n---\n{% asset_img datastax_drop.gif \"Dropping in on my cluster\" %}\nLooks like my nodes are healthy.  :)","slug":"Dropping-in-on-my-cluster","published":1,"updated":"2017-02-13T16:35:19.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcqm9a590002v6km8ltkbqr7","content":"<img src=\"/2017/02/13/Dropping-in-on-my-cluster/datastax_drop.gif\" alt=\"Dropping in on my cluster\" title=\"Dropping in on my cluster\">\n<p>Looks like my nodes are healthy.  :)</p>\n","excerpt":"","more":"<img src=\"/2017/02/13/Dropping-in-on-my-cluster/datastax_drop.gif\" alt=\"Dropping in on my cluster\" title=\"Dropping in on my cluster\">\n<p>Looks like my nodes are healthy.  :)</p>\n"},{"title":"Don't block your Async calls","date":"2017-04-17T14:31:42.000Z","_content":"Or rather I should be saying that to myself.  So, TIL (today I learned) something simple yet profound while working with asynchronous programming and the [DSE java driver][dsejava].  Ensure that you are properly iterating through your results when making an async call.  You cannot simply iterate all of your rows using a for loop or something along the lines.  Ok, well, technically you can, but if you have more rows than your fetch size the [DSE java driver][dsejava] will throw a big fat error your way letting you know you are blocking within an async call.  I should point that I am still somewhat new to working with asynchronous calls (yes, someone finally pulled up the rock I was under) so for you veterans this may be knowledge already gained from async NOOB 101.  By the way, here is the error the driver threw at me (thank you for doing so DSE driver peeps).\n\n<!-- more -->\n\n```java\nDetected a synchronous call on an I/O thread, this can cause deadlocks or unpredictable behavior. This generally happens when a Future callback calls a synchronous Session method (execute() or prepare()), or iterates a result set past the fetch size (causing an internal synchronous fetch of the next page of results). Avoid this in your callbacks, or schedule them on a different executor.\n\tcom.datastax.driver.core.AbstractSession.checkNotInEventLoop(AbstractSession.java:206)\n\tcom.datastax.driver.core.ArrayBackedResultSet$MultiPage.prepareNextRow(ArrayBackedResultSet.java:310)\n\tcom.datastax.driver.core.ArrayBackedResultSet$MultiPage.isExhausted(ArrayBackedResultSet.java:269)\n\tcom.datastax.driver.core.ArrayBackedResultSet$1.hasNext(ArrayBackedResultSet.java:143)\n\tcom.datastax.driver.mapping.Result$1.hasNext(Result.java:102...\n```\n\nThe reason is stated [here][asyncpaging].  I'll quote it just to be clear \"If you consume a ResultSet in a callback, be aware that iterating the rows will trigger synchronous queries as you page through the results. To avoid this, use getAvailableWithoutFetching to limit the iteration to the current page, and fetchMoreResults to get a future to the next page\".  Even though I read this before I started into this code I must have glossed over this concept the first time through as my implementation was acting very strange indeed.\n\nLet's look at a simple example.  At this point in my code I already made an aynchronous call with session.executeAsync(), created a future, and returned my results into a callback.  The following examples are within my callback.\nIn the case below I mapped my results to the UserVideos entity and now I am iterating through those results to do something with each \"userVideo\" object.\nThis...DOES NOT work and will throw the error I mentioned above.\n\n*Ehem, I have a utility class handle callbacks if you were wondering where that was.  I wanted to keep the example nice and simple.  Just know that by the time you see \".handle\" we are within the callback.*\n```java\n        FutureUtils.buildCompletableFuture(userVideosMapper.mapAsync(future))\n                .handle((userVideos, ex) -> {\n                    try {\n                        if (userVideos != null) {\n                            for (UserVideos userVideo : userVideos) {\n                                \"do something with userVideo here\"\n                            }\n\n```\nIt seems so simple.  I returned my results and now I want to iterate over those results and do something with them, but these aren't synchronous calls that block until complete.  I need to handle them properly from an asynchronous standpoint and only grab those results that have actually been returned.  The rest I will need to fetch with more asynchronous calls.\n\nAgain, this is demonstrated very clearly [here][asyncpaging] in the Async paging section.\n\nThis...is a snippet pulled from the working code using the example given from the [async][asyncpaging] page I keep referencing.  Now, I see how many items I have remaining without fetching, loop through the remaining items, and break out once I have exhausted the list.  You may not see in my example below, but once I \"break;\" I exit out and grab futures for any more items that may be left, rinse and repeat.   \n```java\n        FutureUtils.buildCompletableFuture(userVideosMapper.mapAsync(future))\n                .handle((userVideos, ex) -> {\n                    try {\n                        if (userVideos != null) {\n                            int remaining = userVideos.getAvailableWithoutFetching();\n                            for (UserVideos userVideo : userVideos) {\n                                \"do something with userVideo here\"\n\n                                if (--remaining == 0) {\n                                    break;\n                                }\n                            }\n```\nThe whole point of this post was to point out a potential \"gotcha\" with a very simple fix when dealing with asynchronous programming and the [DSE driver for Java][dsejava].  This one tripped me up for a moment until I realized my mistake.  Now that I know better my \"futures\" are looking bright in deed....see my joke there....ha....haha.....ha...*awkward pause*.  Honestly, this simple change tightend all of my async code up.  No more strange artifacts\n\n\n\n[dsejava]: http://docs.datastax.com/en/developer/java-driver/3.2/\n[asyncprogramming]: http://docs.datastax.com/en/developer/java-driver/3.2/manual/async/\n[asyncpaging]: http://docs.datastax.com/en/developer/java-driver/3.2/manual/async/#async-paging","source":"_posts/Don-t-block-your-Async-calls.md","raw":"---\ntitle: Don't block your Async calls\ndate: 2017-04-17 10:31:42\ntags:\n    - TIL\n    - async\n    - blocking\n    - java\n    - killrvideo\ncategories:\n    - Technical\n---\nOr rather I should be saying that to myself.  So, TIL (today I learned) something simple yet profound while working with asynchronous programming and the [DSE java driver][dsejava].  Ensure that you are properly iterating through your results when making an async call.  You cannot simply iterate all of your rows using a for loop or something along the lines.  Ok, well, technically you can, but if you have more rows than your fetch size the [DSE java driver][dsejava] will throw a big fat error your way letting you know you are blocking within an async call.  I should point that I am still somewhat new to working with asynchronous calls (yes, someone finally pulled up the rock I was under) so for you veterans this may be knowledge already gained from async NOOB 101.  By the way, here is the error the driver threw at me (thank you for doing so DSE driver peeps).\n\n<!-- more -->\n\n```java\nDetected a synchronous call on an I/O thread, this can cause deadlocks or unpredictable behavior. This generally happens when a Future callback calls a synchronous Session method (execute() or prepare()), or iterates a result set past the fetch size (causing an internal synchronous fetch of the next page of results). Avoid this in your callbacks, or schedule them on a different executor.\n\tcom.datastax.driver.core.AbstractSession.checkNotInEventLoop(AbstractSession.java:206)\n\tcom.datastax.driver.core.ArrayBackedResultSet$MultiPage.prepareNextRow(ArrayBackedResultSet.java:310)\n\tcom.datastax.driver.core.ArrayBackedResultSet$MultiPage.isExhausted(ArrayBackedResultSet.java:269)\n\tcom.datastax.driver.core.ArrayBackedResultSet$1.hasNext(ArrayBackedResultSet.java:143)\n\tcom.datastax.driver.mapping.Result$1.hasNext(Result.java:102...\n```\n\nThe reason is stated [here][asyncpaging].  I'll quote it just to be clear \"If you consume a ResultSet in a callback, be aware that iterating the rows will trigger synchronous queries as you page through the results. To avoid this, use getAvailableWithoutFetching to limit the iteration to the current page, and fetchMoreResults to get a future to the next page\".  Even though I read this before I started into this code I must have glossed over this concept the first time through as my implementation was acting very strange indeed.\n\nLet's look at a simple example.  At this point in my code I already made an aynchronous call with session.executeAsync(), created a future, and returned my results into a callback.  The following examples are within my callback.\nIn the case below I mapped my results to the UserVideos entity and now I am iterating through those results to do something with each \"userVideo\" object.\nThis...DOES NOT work and will throw the error I mentioned above.\n\n*Ehem, I have a utility class handle callbacks if you were wondering where that was.  I wanted to keep the example nice and simple.  Just know that by the time you see \".handle\" we are within the callback.*\n```java\n        FutureUtils.buildCompletableFuture(userVideosMapper.mapAsync(future))\n                .handle((userVideos, ex) -> {\n                    try {\n                        if (userVideos != null) {\n                            for (UserVideos userVideo : userVideos) {\n                                \"do something with userVideo here\"\n                            }\n\n```\nIt seems so simple.  I returned my results and now I want to iterate over those results and do something with them, but these aren't synchronous calls that block until complete.  I need to handle them properly from an asynchronous standpoint and only grab those results that have actually been returned.  The rest I will need to fetch with more asynchronous calls.\n\nAgain, this is demonstrated very clearly [here][asyncpaging] in the Async paging section.\n\nThis...is a snippet pulled from the working code using the example given from the [async][asyncpaging] page I keep referencing.  Now, I see how many items I have remaining without fetching, loop through the remaining items, and break out once I have exhausted the list.  You may not see in my example below, but once I \"break;\" I exit out and grab futures for any more items that may be left, rinse and repeat.   \n```java\n        FutureUtils.buildCompletableFuture(userVideosMapper.mapAsync(future))\n                .handle((userVideos, ex) -> {\n                    try {\n                        if (userVideos != null) {\n                            int remaining = userVideos.getAvailableWithoutFetching();\n                            for (UserVideos userVideo : userVideos) {\n                                \"do something with userVideo here\"\n\n                                if (--remaining == 0) {\n                                    break;\n                                }\n                            }\n```\nThe whole point of this post was to point out a potential \"gotcha\" with a very simple fix when dealing with asynchronous programming and the [DSE driver for Java][dsejava].  This one tripped me up for a moment until I realized my mistake.  Now that I know better my \"futures\" are looking bright in deed....see my joke there....ha....haha.....ha...*awkward pause*.  Honestly, this simple change tightend all of my async code up.  No more strange artifacts\n\n\n\n[dsejava]: http://docs.datastax.com/en/developer/java-driver/3.2/\n[asyncprogramming]: http://docs.datastax.com/en/developer/java-driver/3.2/manual/async/\n[asyncpaging]: http://docs.datastax.com/en/developer/java-driver/3.2/manual/async/#async-paging","slug":"Don-t-block-your-Async-calls","published":1,"updated":"2017-04-20T19:58:33.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcqm9a5z000nv6kmb74oez6v","content":"<p>Or rather I should be saying that to myself.  So, TIL (today I learned) something simple yet profound while working with asynchronous programming and the <a href=\"http://docs.datastax.com/en/developer/java-driver/3.2/\" target=\"_blank\" rel=\"external\">DSE java driver</a>.  Ensure that you are properly iterating through your results when making an async call.  You cannot simply iterate all of your rows using a for loop or something along the lines.  Ok, well, technically you can, but if you have more rows than your fetch size the <a href=\"http://docs.datastax.com/en/developer/java-driver/3.2/\" target=\"_blank\" rel=\"external\">DSE java driver</a> will throw a big fat error your way letting you know you are blocking within an async call.  I should point that I am still somewhat new to working with asynchronous calls (yes, someone finally pulled up the rock I was under) so for you veterans this may be knowledge already gained from async NOOB 101.  By the way, here is the error the driver threw at me (thank you for doing so DSE driver peeps).</p>\n<a id=\"more\"></a>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">Detected a synchronous call on an I/O thread, <span class=\"keyword\">this</span> can cause deadlocks or unpredictable behavior. <span class=\"function\">This generally happens when a Future callback calls a synchronous Session <span class=\"title\">method</span> <span class=\"params\">(execute()</span> or <span class=\"title\">prepare</span><span class=\"params\">()</span>), or iterates a result set past the fetch <span class=\"title\">size</span> <span class=\"params\">(causing an internal synchronous fetch of the next page of results)</span>. Avoid <span class=\"keyword\">this</span> in your callbacks, or schedule them on a different executor.</span></div><div class=\"line\">\tcom.datastax.driver.core.AbstractSession.<span class=\"title\">checkNotInEventLoop</span><span class=\"params\">(AbstractSession.java:<span class=\"number\">206</span>)</span></div><div class=\"line\">\tcom.datastax.driver.core.ArrayBackedResultSet$MultiPage.<span class=\"title\">prepareNextRow</span><span class=\"params\">(ArrayBackedResultSet.java:<span class=\"number\">310</span>)</span></div><div class=\"line\">\tcom.datastax.driver.core.ArrayBackedResultSet$MultiPage.<span class=\"title\">isExhausted</span><span class=\"params\">(ArrayBackedResultSet.java:<span class=\"number\">269</span>)</span></div><div class=\"line\">\tcom.datastax.driver.core.ArrayBackedResultSet$1.<span class=\"title\">hasNext</span><span class=\"params\">(ArrayBackedResultSet.java:<span class=\"number\">143</span>)</span></div><div class=\"line\">\tcom.datastax.driver.mapping.Result$1.<span class=\"title\">hasNext</span><span class=\"params\">(Result.java:<span class=\"number\">102.</span>..</span></div></pre></td></tr></table></figure>\n<p>The reason is stated <a href=\"http://docs.datastax.com/en/developer/java-driver/3.2/manual/async/#async-paging\" target=\"_blank\" rel=\"external\">here</a>.  I’ll quote it just to be clear “If you consume a ResultSet in a callback, be aware that iterating the rows will trigger synchronous queries as you page through the results. To avoid this, use getAvailableWithoutFetching to limit the iteration to the current page, and fetchMoreResults to get a future to the next page”.  Even though I read this before I started into this code I must have glossed over this concept the first time through as my implementation was acting very strange indeed.</p>\n<p>Let’s look at a simple example.  At this point in my code I already made an aynchronous call with session.executeAsync(), created a future, and returned my results into a callback.  The following examples are within my callback.<br>In the case below I mapped my results to the UserVideos entity and now I am iterating through those results to do something with each “userVideo” object.<br>This…DOES NOT work and will throw the error I mentioned above.</p>\n<p><em>Ehem, I have a utility class handle callbacks if you were wondering where that was.  I wanted to keep the example nice and simple.  Just know that by the time you see “.handle” we are within the callback.</em><br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\">FutureUtils.buildCompletableFuture(userVideosMapper.mapAsync(future))</div><div class=\"line\">        .handle((userVideos, ex) -&gt; &#123;</div><div class=\"line\">            <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">                <span class=\"keyword\">if</span> (userVideos != <span class=\"keyword\">null</span>) &#123;</div><div class=\"line\">                    <span class=\"keyword\">for</span> (UserVideos userVideo : userVideos) &#123;</div><div class=\"line\">                        <span class=\"string\">\"do something with userVideo here\"</span></div><div class=\"line\">                    &#125;</div></pre></td></tr></table></figure></p>\n<p>It seems so simple.  I returned my results and now I want to iterate over those results and do something with them, but these aren’t synchronous calls that block until complete.  I need to handle them properly from an asynchronous standpoint and only grab those results that have actually been returned.  The rest I will need to fetch with more asynchronous calls.</p>\n<p>Again, this is demonstrated very clearly <a href=\"http://docs.datastax.com/en/developer/java-driver/3.2/manual/async/#async-paging\" target=\"_blank\" rel=\"external\">here</a> in the Async paging section.</p>\n<p>This…is a snippet pulled from the working code using the example given from the <a href=\"http://docs.datastax.com/en/developer/java-driver/3.2/manual/async/#async-paging\" target=\"_blank\" rel=\"external\">async</a> page I keep referencing.  Now, I see how many items I have remaining without fetching, loop through the remaining items, and break out once I have exhausted the list.  You may not see in my example below, but once I “break;” I exit out and grab futures for any more items that may be left, rinse and repeat.<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\">FutureUtils.buildCompletableFuture(userVideosMapper.mapAsync(future))</div><div class=\"line\">        .handle((userVideos, ex) -&gt; &#123;</div><div class=\"line\">            <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">                <span class=\"keyword\">if</span> (userVideos != <span class=\"keyword\">null</span>) &#123;</div><div class=\"line\">                    <span class=\"keyword\">int</span> remaining = userVideos.getAvailableWithoutFetching();</div><div class=\"line\">                    <span class=\"keyword\">for</span> (UserVideos userVideo : userVideos) &#123;</div><div class=\"line\">                        <span class=\"string\">\"do something with userVideo here\"</span></div><div class=\"line\"></div><div class=\"line\">                        <span class=\"keyword\">if</span> (--remaining == <span class=\"number\">0</span>) &#123;</div><div class=\"line\">                            <span class=\"keyword\">break</span>;</div><div class=\"line\">                        &#125;</div><div class=\"line\">                    &#125;</div></pre></td></tr></table></figure></p>\n<p>The whole point of this post was to point out a potential “gotcha” with a very simple fix when dealing with asynchronous programming and the <a href=\"http://docs.datastax.com/en/developer/java-driver/3.2/\" target=\"_blank\" rel=\"external\">DSE driver for Java</a>.  This one tripped me up for a moment until I realized my mistake.  Now that I know better my “futures” are looking bright in deed….see my joke there….ha….haha…..ha…<em>awkward pause</em>.  Honestly, this simple change tightend all of my async code up.  No more strange artifacts</p>\n","excerpt":"<p>Or rather I should be saying that to myself.  So, TIL (today I learned) something simple yet profound while working with asynchronous programming and the <a href=\"http://docs.datastax.com/en/developer/java-driver/3.2/\">DSE java driver</a>.  Ensure that you are properly iterating through your results when making an async call.  You cannot simply iterate all of your rows using a for loop or something along the lines.  Ok, well, technically you can, but if you have more rows than your fetch size the <a href=\"http://docs.datastax.com/en/developer/java-driver/3.2/\">DSE java driver</a> will throw a big fat error your way letting you know you are blocking within an async call.  I should point that I am still somewhat new to working with asynchronous calls (yes, someone finally pulled up the rock I was under) so for you veterans this may be knowledge already gained from async NOOB 101.  By the way, here is the error the driver threw at me (thank you for doing so DSE driver peeps).</p>","more":"<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">Detected a synchronous call on an I/O thread, <span class=\"keyword\">this</span> can cause deadlocks or unpredictable behavior. <span class=\"function\">This generally happens when a Future callback calls a synchronous Session <span class=\"title\">method</span> <span class=\"params\">(execute()</span> or <span class=\"title\">prepare</span><span class=\"params\">()</span>), or iterates a result set past the fetch <span class=\"title\">size</span> <span class=\"params\">(causing an internal synchronous fetch of the next page of results)</span>. Avoid <span class=\"keyword\">this</span> in your callbacks, or schedule them on a different executor.</div><div class=\"line\">\tcom.datastax.driver.core.AbstractSession.<span class=\"title\">checkNotInEventLoop</span><span class=\"params\">(AbstractSession.java:<span class=\"number\">206</span>)</span></div><div class=\"line\">\tcom.datastax.driver.core.ArrayBackedResultSet$MultiPage.<span class=\"title\">prepareNextRow</span><span class=\"params\">(ArrayBackedResultSet.java:<span class=\"number\">310</span>)</span></div><div class=\"line\">\tcom.datastax.driver.core.ArrayBackedResultSet$MultiPage.<span class=\"title\">isExhausted</span><span class=\"params\">(ArrayBackedResultSet.java:<span class=\"number\">269</span>)</span></div><div class=\"line\">\tcom.datastax.driver.core.ArrayBackedResultSet$1.<span class=\"title\">hasNext</span><span class=\"params\">(ArrayBackedResultSet.java:<span class=\"number\">143</span>)</span></div><div class=\"line\">\tcom.datastax.driver.mapping.Result$1.<span class=\"title\">hasNext</span><span class=\"params\">(Result.java:<span class=\"number\">102.</span>..</span></span></div></pre></td></tr></table></figure>\n<p>The reason is stated <a href=\"http://docs.datastax.com/en/developer/java-driver/3.2/manual/async/#async-paging\">here</a>.  I’ll quote it just to be clear “If you consume a ResultSet in a callback, be aware that iterating the rows will trigger synchronous queries as you page through the results. To avoid this, use getAvailableWithoutFetching to limit the iteration to the current page, and fetchMoreResults to get a future to the next page”.  Even though I read this before I started into this code I must have glossed over this concept the first time through as my implementation was acting very strange indeed.</p>\n<p>Let’s look at a simple example.  At this point in my code I already made an aynchronous call with session.executeAsync(), created a future, and returned my results into a callback.  The following examples are within my callback.<br>In the case below I mapped my results to the UserVideos entity and now I am iterating through those results to do something with each “userVideo” object.<br>This…DOES NOT work and will throw the error I mentioned above.</p>\n<p><em>Ehem, I have a utility class handle callbacks if you were wondering where that was.  I wanted to keep the example nice and simple.  Just know that by the time you see “.handle” we are within the callback.</em><br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\">FutureUtils.buildCompletableFuture(userVideosMapper.mapAsync(future))</div><div class=\"line\">        .handle((userVideos, ex) -&gt; &#123;</div><div class=\"line\">            <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">                <span class=\"keyword\">if</span> (userVideos != <span class=\"keyword\">null</span>) &#123;</div><div class=\"line\">                    <span class=\"keyword\">for</span> (UserVideos userVideo : userVideos) &#123;</div><div class=\"line\">                        <span class=\"string\">\"do something with userVideo here\"</span></div><div class=\"line\">                    &#125;</div></pre></td></tr></table></figure></p>\n<p>It seems so simple.  I returned my results and now I want to iterate over those results and do something with them, but these aren’t synchronous calls that block until complete.  I need to handle them properly from an asynchronous standpoint and only grab those results that have actually been returned.  The rest I will need to fetch with more asynchronous calls.</p>\n<p>Again, this is demonstrated very clearly <a href=\"http://docs.datastax.com/en/developer/java-driver/3.2/manual/async/#async-paging\">here</a> in the Async paging section.</p>\n<p>This…is a snippet pulled from the working code using the example given from the <a href=\"http://docs.datastax.com/en/developer/java-driver/3.2/manual/async/#async-paging\">async</a> page I keep referencing.  Now, I see how many items I have remaining without fetching, loop through the remaining items, and break out once I have exhausted the list.  You may not see in my example below, but once I “break;” I exit out and grab futures for any more items that may be left, rinse and repeat.<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\">FutureUtils.buildCompletableFuture(userVideosMapper.mapAsync(future))</div><div class=\"line\">        .handle((userVideos, ex) -&gt; &#123;</div><div class=\"line\">            <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">                <span class=\"keyword\">if</span> (userVideos != <span class=\"keyword\">null</span>) &#123;</div><div class=\"line\">                    <span class=\"keyword\">int</span> remaining = userVideos.getAvailableWithoutFetching();</div><div class=\"line\">                    <span class=\"keyword\">for</span> (UserVideos userVideo : userVideos) &#123;</div><div class=\"line\">                        <span class=\"string\">\"do something with userVideo here\"</span></div><div class=\"line\"></div><div class=\"line\">                        <span class=\"keyword\">if</span> (--remaining == <span class=\"number\">0</span>) &#123;</div><div class=\"line\">                            <span class=\"keyword\">break</span>;</div><div class=\"line\">                        &#125;</div><div class=\"line\">                    &#125;</div></pre></td></tr></table></figure></p>\n<p>The whole point of this post was to point out a potential “gotcha” with a very simple fix when dealing with asynchronous programming and the <a href=\"http://docs.datastax.com/en/developer/java-driver/3.2/\">DSE driver for Java</a>.  This one tripped me up for a moment until I realized my mistake.  Now that I know better my “futures” are looking bright in deed….see my joke there….ha….haha…..ha…<em>awkward pause</em>.  Honestly, this simple change tightend all of my async code up.  No more strange artifacts</p>"},{"title":"Mixed Workload DSE Cluster with Raspberry PI's","date":"2017-02-07T18:52:11.000Z","_content":"Alrighty, as I mentioned in my previous [post](/2017/02/07/I-m-Sure-You-Weren-t-Looking) I have a mixed-workload cluster (Cassandra, DSE search, DSE graph) using a combination of 4 Raspberry PI's and my laptop.  I had multiple things in mind when I started into this.\n\n1. Low cost for learning\n\n1. Something I can break and not cry about\n\n1. How low can one really go when setting up a cluster?\n\n1. Get some DSE OpsCenter knowledge\n\n1. These are Raspberry PI's, they are just damn cool, so why not setup a cluster?!\n\n<!-- more -->\n\n## PIE?  Raspberries? 3.14? PI?\n{% raw %}\n<div class=\"responsive-container\" style=\"height:160px\">\n    <div class=\"dummy\"></div>\n    <div class=\"img-container\">\n        <div class=\"centerer\"></div>\n          <img src=\"/2017/02/07/Mixed-Workload-DSE-Cluster-with-Raspberry-PI-s/pie-pi.jpg\" title=\"pie\" width=\"25%\" height=\"auto\">\n          <span><strong>+</strong></span>\n          <img src=\"/2017/02/07/Mixed-Workload-DSE-Cluster-with-Raspberry-PI-s/raspberry.jpg\" title=\"raspberries\" width=\"25%\" height=\"auto\">\n          <span><strong>=</strong></span>\n          <img src=\"/2017/02/07/Mixed-Workload-DSE-Cluster-with-Raspberry-PI-s/raspberrypi.jpg\" title=\"raspberrypi\" width=\"25%\" height=\"auto\">\n    </div>\n</div>\n{% endraw %}\n\nIf you are not already familiar with RaspberryPI's [go take a look][raspberrypi].  These are cool little machines for very little cost.\n\n[Here are the specs for the model 3][model3], but just to summarize each node in our cluster only has 1GB of RAM and a 1.2GHz quad-core processor.  This is clearly not a setup to use in your production environment.  This is, however, a great way to learn and experiment.\n\n\n## The setup\n4 [RaspberryPI's][raspberrypi] (wired ethernet)\nNOTE:  These are designed to be \"built up\" so you will need to purchase microSD cards and the outer shells separately\n\nOne `2.6GHz 8 core` MacBook with `16GB RAM` (wired ethernet)\n\n[DataStax Enterprise Opscenter 6.0.7][opscenter] using [tarball installation][opscentertarball]\n\n[DataStax Agent 6.0.7][agent] using [tarball installation][agenttarball]\n\n[DataStax Enterprise 5.0.5][dse], again, using the [tarball installation][dsetarball]\n\n[RAVPower 6 port USB charger][rav] with a set of USB `Male A` to `Micro B` cables.  I also purchased a `4x1 HDMI` switch, but you can easily run these headless if you know your way around a Linux shell.\n\nJust a quick note about the tarball installations.  DSE generally supports using installers across most major platforms and for each of the various installs, but since we are using RaspberryPI's in this case and since I used the [NOOBS][noobs] install to get up and going as fast as I could it just so happens that combination **only works with tarball installs**.  Please, learn from me and don't spend the many, many hours I did eventually figuring this out.   \n\nYou can, in fact, install other operating systems on RaspberryPI's which may allow the installers to work, but you'll have to come back and tell me about it if you give it a go.\n\nAaaaaaand for the reveal dun dunn dunnnnnnnnn! (Yes, those are shiny, lighted cables)\n{% asset_img myPIs.gif \"My Raspberry PI Cluster\" %}\n\n## I may have cheated just a little bit\nSo, I mentioned above \"mixed workload cluster with Raspberry PI's\".  This is 100% true, but also notice there is a laptop in the mix.  I ended up using the laptop to house OpsCenter and my search/graph datacenter and I'm using the PI's for my core Cassandra cluster.  In my experience I don't usually install operations tools and the like directly on production devices facing the public because they have a tendency to cause unpredicatable load.  The limited RAM on the PI's (1GB) is also a factor which I will address here in a moment.  As far as the search/graph datacenter portion I simply used the laptop out of convienence because I already had a 4-node core Cassandra cluster running on the PI's at the time and I wanted to observe the interaction between my search/graph and Cassandra datacenters in a \"pure\" fashion.\n\n## Get this working on PI's\nRaspberry PI's are special snowflakes when it comes to making this all work.  I will detail all this below, but here, for you, is the summarized list of what is needed.\n\n1. [Disable swap][swap]\n`sudo swapoff -a` is your friend.  It is also the quick and dirty way, not permanent on reboot.  Take a look at the \"Disable swapping\" section of [this post][disableswap] if you would like a more permanent solution.\n\n1. Go Headless\nThis is quite easy to do using `sudo raspi-config` while ssh'd into your PI and it will help free up enough memory to make things stable.  Just make sure you already know your PI's IP address or know how to find it if things go sour.\n\n1. Decrease RAM allocated to datastax-agent from `128MB to 64MB` \nEdit `datastax-agent-env.sh` located in [your datastax-agent install dir]/conf/datastax-agent-env.sh\n```bash\nFrom:\nJVM_OPTS=\"$JVM_OPTS -Xmx128M -Djclouds.mpu.parts.magnitude=100000 -Djclouds.mpu.parts.size=16777216\"\n\nTo:\nJVM_OPTS=\"$JVM_OPTS -Xmx64M -Djclouds.mpu.parts.magnitude=100000 -Djclouds.mpu.parts.size=16777216\"\n```\n\n1. Explicitly set Java HEAP settings for Cassandra node\nEdit `cassandra-env.sh` located in [your DSE install dir]/resources/cassandra/conf/cassandra-env.sh.  Search for \"HEAP\" to find and edit the lines.  Notice mine are already set to the working values.  These are commented out by default which will allow the script to calculate values for you, but for our PI case we cannot use the calculated values.\n```bash\nMAX_HEAP_SIZE=\"200M\"\nHEAP_NEWSIZE=\"50M\"\n```\n\n1. [Store collection data on a separate cluster][storecollection]\nRemember that part about \"cheating\" with my [OpsCenter][opscenter] laptop?  Yup, this is part of it.  I'll give more details down below.\n\n## Let's talk about OpsCenter, agents, memory, disk speed, and mucho frustrationo \nThat's kind of a long list now that I see it all typed out, but there's a lot to consider.\n\nWe have nodes with `1GB of RAM`, a `32 bit` os, `4 cores`, and a `32GB microSD` drive acting as a hard disk.  This is way below the recommended values of `16-32GB of RAM`, `500GB-1TB` of fast disk, and `64bit` with `8 cores` for running Cassandra nodes, or really any database for that matter.  I wasn't really sure how well this would work, if at all, given memory contraints alone not to mention the speed of microSD's for a database that is known to need very fast disk.\n\n### OpsCenter\nI decided right off the bat I wanted OpsCenter in the mix.  Part of this whole project was to learn and what better way than to go whole hog and see what it could do.  If you use OpsCenter you must install [DataStax agents][agent] on each of your nodes in order for magic to happen.  That magic comes at a memory cost, not a huge one, but one that matters when only dealing with `1GB of RAM`.  In order to leave enough room for the Cassandra node itself to run I effectively cut this requirement in half.  So far, after months of running, I have not seen an issue running agents at `64MB of RAM`.\n{% asset_img opscenter_cluster.png \"Laptop + PI Mixed-Workload Cluster\" %}\n\n### Cassandra memory\nThe default auto caluclated memory configuration for DSE managed Cassandra nodes works well enough even on the PI's, but there's a catch.  Remember those agents we need for [OpsCenter][opscenter]?  Well, turns out the agents need just enough extra memory to push things over the edge and on a system with no swap file this means **page fault** which is exactly what happened.  I tried to quash every little process I could to free up enough RAM for my nodes to remain stable and I even made them headless, but to remain stable I had to explicitly configure the HEAP settings for my Cassandra nodes.  The end result is listed up above.\n\n### Headless\nSo, before I went headless things were working...uhh...well enough.  Not well enough that I could leave it alone really and any time the system was put under stress **!BAM!** I would lose a node.  This ended up being **the clincher**.  I noticed the Raspbian UI itself was eating up just enough RAM to prevent my nodes from allocating more in times of need.  I chopped off their heads and since then along with the other changes I made my nodes have been rock solid on the memory front.\n\n### Memory is good how about disk?\nWe already talked about the swap file.  Not only is it [strongly recommended][swap] to disable swap on nodes running Cassandra, but even more so on PI's running on microSD's.  Before I did so it was clear my nodes were struggling as even small tasks kept driving load up and upon some inspection it was obvious I/O was mostly to blame.  However, something else was lurking even after I disabled swap.  At times I would see my nodes shoot up from a load of `<1 upwards to 10+`.  At this point they would usually become unresponsive and either crash or eventually come back to reality, but always, always under heavy load.\n\n### Colllleccccctionnnnnn Daaaaatttttaaaaa\nSorry, couldn't help myself.  As stated above move collection data storage off the PI's onto a [separate cluster][storecollection].  They simply cannot handle all of the I/O associated with collecting, storing, and repairing the collection data from the rollup\\* tables.  Compaction was happening way too fast for the nodes to keep up most likely a result of having very little memory to work with, the PI's could not keep up with the amount of collection data itself, and read repair on the rollup\\* tables was a constant, never ending stream of repair.  Once I made the switch my PI nodes all quieted down to a normal `load around 1`, things have stabilized, and   I no longer have gaps in my analytics data (except for when I **HULK SMASH** nodes myself for fun).\n\n## Finally, the mixed workload part\nYup, right there in the title and all and I haven't really mentioned it.  Part of the reason I went and did all of this aside from learning and seeing what could be done was to extend [Luke Tillman's **\\*cough\\*....shame...less..plug \\*cooouugh\\***][luke] freaking awesome [KillrVideo][killrvideo] reference app to hook up to clusters outside of its [Dockerized][docker] container.  This forced me to extend my existing Cassandra cluster into a mixed workload scenario with [DSE Search][dsesearch].  Right, I could have simply put search within the same cluster, but I was looking to emulate what I would do in a production scenario.  I have an upcoming post on this very topic coming here in the future.  I also had need to extend into [DSE graph][dsegraph] as well for some of my own projects so I took the opportunity to go ahead and just do it all.  The end result is a fully functional Cassandra/Search/Graph DSE managed mixed workload cluster being served up mostly on Raspberry PI's with a little help from a laptop all hooked up to [KillrVideo][killrvideo].\n\nOne last thing before I go.  I find that tailing the agent.log, opscenterd.log, and system.log files from all of the nodes is quite insightful especially when watching the interaction between the nodes when performing regular CQL, search, and graph queries.  I'm also the type of person who can watch a defrag for hours and find every little box color change useful information.  \n\nNot sure what that says about me.  \n\n\n[raspberrypi]: https://www.raspberrypi.org/ \n[model3]: https://www.raspberrypi.org/products/raspberry-pi-3-model-b/ \n[opscenter]: http://docs.datastax.com/en/latest-opscenter/opsc/about_c.html\n[opscentertarball]: https://docs.datastax.com/en/latest-opscenter/opsc/install/opscInstallTar_t.html\n[agent]: http://docs.datastax.com/en/latest-opscenter/opsc/install/installDSagents.html\n[agenttarball]: http://docs.datastax.com/en/latest-opscenter/opsc/install/opsc-agentInstallManual_t.html\n[dse]: http://docs.datastax.com/en/latest-dse/\n[dsetarball]: http://docs.datastax.com/en/latest-dse/datastax_enterprise/install/installTARdse.html\n[dsesearch]: http://docs.datastax.com/en/datastax_enterprise/5.0/datastax_enterprise/srch/searchOverview.html\n[dsegraph]: http://www.datastax.com/products/datastax-enterprise-graph\n[noobs]: https://www.raspberrypi.org/downloads/noobs/\n[rav]: https://www.ravpower.com/6-port-usb-wall-charger-black-.html\n[recommendedsettings]: https://docs.datastax.com/en/landing_page/doc/landing_page/recommendedSettingsLinux.html\n[swap]: https://docs.datastax.com/en/landing_page/doc/landing_page/recommendedSettingsLinux.html#recommendedSettingsLinux__disable-swap\n[disableswap]: http://ideaheap.com/2013/07/stopping-sd-card-corruption-on-a-raspberry-pi/\n[storecollection]: https://docs.datastax.com/en/opscenter/6.0/opsc/configure/opscStoringCollectionDataDifferentCluster_t.html\n[killrvideo]: https://killrvideo.github.io/\n[luke]: http://www.luketillman.com/\n[docker]: https://www.docker.com/","source":"_posts/Mixed-Workload-DSE-Cluster-with-Raspberry-PI-s.md","raw":"---\ntitle: Mixed Workload DSE Cluster with Raspberry PI's\ndate: 2017-02-07 13:52:11\ncategories:\n    - Technical\ntags:\n    - raspberry PI\n    - cluster\n    - killrvideo\n---\nAlrighty, as I mentioned in my previous [post](/2017/02/07/I-m-Sure-You-Weren-t-Looking) I have a mixed-workload cluster (Cassandra, DSE search, DSE graph) using a combination of 4 Raspberry PI's and my laptop.  I had multiple things in mind when I started into this.\n\n1. Low cost for learning\n\n1. Something I can break and not cry about\n\n1. How low can one really go when setting up a cluster?\n\n1. Get some DSE OpsCenter knowledge\n\n1. These are Raspberry PI's, they are just damn cool, so why not setup a cluster?!\n\n<!-- more -->\n\n## PIE?  Raspberries? 3.14? PI?\n{% raw %}\n<div class=\"responsive-container\" style=\"height:160px\">\n    <div class=\"dummy\"></div>\n    <div class=\"img-container\">\n        <div class=\"centerer\"></div>\n          <img src=\"/2017/02/07/Mixed-Workload-DSE-Cluster-with-Raspberry-PI-s/pie-pi.jpg\" title=\"pie\" width=\"25%\" height=\"auto\">\n          <span><strong>+</strong></span>\n          <img src=\"/2017/02/07/Mixed-Workload-DSE-Cluster-with-Raspberry-PI-s/raspberry.jpg\" title=\"raspberries\" width=\"25%\" height=\"auto\">\n          <span><strong>=</strong></span>\n          <img src=\"/2017/02/07/Mixed-Workload-DSE-Cluster-with-Raspberry-PI-s/raspberrypi.jpg\" title=\"raspberrypi\" width=\"25%\" height=\"auto\">\n    </div>\n</div>\n{% endraw %}\n\nIf you are not already familiar with RaspberryPI's [go take a look][raspberrypi].  These are cool little machines for very little cost.\n\n[Here are the specs for the model 3][model3], but just to summarize each node in our cluster only has 1GB of RAM and a 1.2GHz quad-core processor.  This is clearly not a setup to use in your production environment.  This is, however, a great way to learn and experiment.\n\n\n## The setup\n4 [RaspberryPI's][raspberrypi] (wired ethernet)\nNOTE:  These are designed to be \"built up\" so you will need to purchase microSD cards and the outer shells separately\n\nOne `2.6GHz 8 core` MacBook with `16GB RAM` (wired ethernet)\n\n[DataStax Enterprise Opscenter 6.0.7][opscenter] using [tarball installation][opscentertarball]\n\n[DataStax Agent 6.0.7][agent] using [tarball installation][agenttarball]\n\n[DataStax Enterprise 5.0.5][dse], again, using the [tarball installation][dsetarball]\n\n[RAVPower 6 port USB charger][rav] with a set of USB `Male A` to `Micro B` cables.  I also purchased a `4x1 HDMI` switch, but you can easily run these headless if you know your way around a Linux shell.\n\nJust a quick note about the tarball installations.  DSE generally supports using installers across most major platforms and for each of the various installs, but since we are using RaspberryPI's in this case and since I used the [NOOBS][noobs] install to get up and going as fast as I could it just so happens that combination **only works with tarball installs**.  Please, learn from me and don't spend the many, many hours I did eventually figuring this out.   \n\nYou can, in fact, install other operating systems on RaspberryPI's which may allow the installers to work, but you'll have to come back and tell me about it if you give it a go.\n\nAaaaaaand for the reveal dun dunn dunnnnnnnnn! (Yes, those are shiny, lighted cables)\n{% asset_img myPIs.gif \"My Raspberry PI Cluster\" %}\n\n## I may have cheated just a little bit\nSo, I mentioned above \"mixed workload cluster with Raspberry PI's\".  This is 100% true, but also notice there is a laptop in the mix.  I ended up using the laptop to house OpsCenter and my search/graph datacenter and I'm using the PI's for my core Cassandra cluster.  In my experience I don't usually install operations tools and the like directly on production devices facing the public because they have a tendency to cause unpredicatable load.  The limited RAM on the PI's (1GB) is also a factor which I will address here in a moment.  As far as the search/graph datacenter portion I simply used the laptop out of convienence because I already had a 4-node core Cassandra cluster running on the PI's at the time and I wanted to observe the interaction between my search/graph and Cassandra datacenters in a \"pure\" fashion.\n\n## Get this working on PI's\nRaspberry PI's are special snowflakes when it comes to making this all work.  I will detail all this below, but here, for you, is the summarized list of what is needed.\n\n1. [Disable swap][swap]\n`sudo swapoff -a` is your friend.  It is also the quick and dirty way, not permanent on reboot.  Take a look at the \"Disable swapping\" section of [this post][disableswap] if you would like a more permanent solution.\n\n1. Go Headless\nThis is quite easy to do using `sudo raspi-config` while ssh'd into your PI and it will help free up enough memory to make things stable.  Just make sure you already know your PI's IP address or know how to find it if things go sour.\n\n1. Decrease RAM allocated to datastax-agent from `128MB to 64MB` \nEdit `datastax-agent-env.sh` located in [your datastax-agent install dir]/conf/datastax-agent-env.sh\n```bash\nFrom:\nJVM_OPTS=\"$JVM_OPTS -Xmx128M -Djclouds.mpu.parts.magnitude=100000 -Djclouds.mpu.parts.size=16777216\"\n\nTo:\nJVM_OPTS=\"$JVM_OPTS -Xmx64M -Djclouds.mpu.parts.magnitude=100000 -Djclouds.mpu.parts.size=16777216\"\n```\n\n1. Explicitly set Java HEAP settings for Cassandra node\nEdit `cassandra-env.sh` located in [your DSE install dir]/resources/cassandra/conf/cassandra-env.sh.  Search for \"HEAP\" to find and edit the lines.  Notice mine are already set to the working values.  These are commented out by default which will allow the script to calculate values for you, but for our PI case we cannot use the calculated values.\n```bash\nMAX_HEAP_SIZE=\"200M\"\nHEAP_NEWSIZE=\"50M\"\n```\n\n1. [Store collection data on a separate cluster][storecollection]\nRemember that part about \"cheating\" with my [OpsCenter][opscenter] laptop?  Yup, this is part of it.  I'll give more details down below.\n\n## Let's talk about OpsCenter, agents, memory, disk speed, and mucho frustrationo \nThat's kind of a long list now that I see it all typed out, but there's a lot to consider.\n\nWe have nodes with `1GB of RAM`, a `32 bit` os, `4 cores`, and a `32GB microSD` drive acting as a hard disk.  This is way below the recommended values of `16-32GB of RAM`, `500GB-1TB` of fast disk, and `64bit` with `8 cores` for running Cassandra nodes, or really any database for that matter.  I wasn't really sure how well this would work, if at all, given memory contraints alone not to mention the speed of microSD's for a database that is known to need very fast disk.\n\n### OpsCenter\nI decided right off the bat I wanted OpsCenter in the mix.  Part of this whole project was to learn and what better way than to go whole hog and see what it could do.  If you use OpsCenter you must install [DataStax agents][agent] on each of your nodes in order for magic to happen.  That magic comes at a memory cost, not a huge one, but one that matters when only dealing with `1GB of RAM`.  In order to leave enough room for the Cassandra node itself to run I effectively cut this requirement in half.  So far, after months of running, I have not seen an issue running agents at `64MB of RAM`.\n{% asset_img opscenter_cluster.png \"Laptop + PI Mixed-Workload Cluster\" %}\n\n### Cassandra memory\nThe default auto caluclated memory configuration for DSE managed Cassandra nodes works well enough even on the PI's, but there's a catch.  Remember those agents we need for [OpsCenter][opscenter]?  Well, turns out the agents need just enough extra memory to push things over the edge and on a system with no swap file this means **page fault** which is exactly what happened.  I tried to quash every little process I could to free up enough RAM for my nodes to remain stable and I even made them headless, but to remain stable I had to explicitly configure the HEAP settings for my Cassandra nodes.  The end result is listed up above.\n\n### Headless\nSo, before I went headless things were working...uhh...well enough.  Not well enough that I could leave it alone really and any time the system was put under stress **!BAM!** I would lose a node.  This ended up being **the clincher**.  I noticed the Raspbian UI itself was eating up just enough RAM to prevent my nodes from allocating more in times of need.  I chopped off their heads and since then along with the other changes I made my nodes have been rock solid on the memory front.\n\n### Memory is good how about disk?\nWe already talked about the swap file.  Not only is it [strongly recommended][swap] to disable swap on nodes running Cassandra, but even more so on PI's running on microSD's.  Before I did so it was clear my nodes were struggling as even small tasks kept driving load up and upon some inspection it was obvious I/O was mostly to blame.  However, something else was lurking even after I disabled swap.  At times I would see my nodes shoot up from a load of `<1 upwards to 10+`.  At this point they would usually become unresponsive and either crash or eventually come back to reality, but always, always under heavy load.\n\n### Colllleccccctionnnnnn Daaaaatttttaaaaa\nSorry, couldn't help myself.  As stated above move collection data storage off the PI's onto a [separate cluster][storecollection].  They simply cannot handle all of the I/O associated with collecting, storing, and repairing the collection data from the rollup\\* tables.  Compaction was happening way too fast for the nodes to keep up most likely a result of having very little memory to work with, the PI's could not keep up with the amount of collection data itself, and read repair on the rollup\\* tables was a constant, never ending stream of repair.  Once I made the switch my PI nodes all quieted down to a normal `load around 1`, things have stabilized, and   I no longer have gaps in my analytics data (except for when I **HULK SMASH** nodes myself for fun).\n\n## Finally, the mixed workload part\nYup, right there in the title and all and I haven't really mentioned it.  Part of the reason I went and did all of this aside from learning and seeing what could be done was to extend [Luke Tillman's **\\*cough\\*....shame...less..plug \\*cooouugh\\***][luke] freaking awesome [KillrVideo][killrvideo] reference app to hook up to clusters outside of its [Dockerized][docker] container.  This forced me to extend my existing Cassandra cluster into a mixed workload scenario with [DSE Search][dsesearch].  Right, I could have simply put search within the same cluster, but I was looking to emulate what I would do in a production scenario.  I have an upcoming post on this very topic coming here in the future.  I also had need to extend into [DSE graph][dsegraph] as well for some of my own projects so I took the opportunity to go ahead and just do it all.  The end result is a fully functional Cassandra/Search/Graph DSE managed mixed workload cluster being served up mostly on Raspberry PI's with a little help from a laptop all hooked up to [KillrVideo][killrvideo].\n\nOne last thing before I go.  I find that tailing the agent.log, opscenterd.log, and system.log files from all of the nodes is quite insightful especially when watching the interaction between the nodes when performing regular CQL, search, and graph queries.  I'm also the type of person who can watch a defrag for hours and find every little box color change useful information.  \n\nNot sure what that says about me.  \n\n\n[raspberrypi]: https://www.raspberrypi.org/ \n[model3]: https://www.raspberrypi.org/products/raspberry-pi-3-model-b/ \n[opscenter]: http://docs.datastax.com/en/latest-opscenter/opsc/about_c.html\n[opscentertarball]: https://docs.datastax.com/en/latest-opscenter/opsc/install/opscInstallTar_t.html\n[agent]: http://docs.datastax.com/en/latest-opscenter/opsc/install/installDSagents.html\n[agenttarball]: http://docs.datastax.com/en/latest-opscenter/opsc/install/opsc-agentInstallManual_t.html\n[dse]: http://docs.datastax.com/en/latest-dse/\n[dsetarball]: http://docs.datastax.com/en/latest-dse/datastax_enterprise/install/installTARdse.html\n[dsesearch]: http://docs.datastax.com/en/datastax_enterprise/5.0/datastax_enterprise/srch/searchOverview.html\n[dsegraph]: http://www.datastax.com/products/datastax-enterprise-graph\n[noobs]: https://www.raspberrypi.org/downloads/noobs/\n[rav]: https://www.ravpower.com/6-port-usb-wall-charger-black-.html\n[recommendedsettings]: https://docs.datastax.com/en/landing_page/doc/landing_page/recommendedSettingsLinux.html\n[swap]: https://docs.datastax.com/en/landing_page/doc/landing_page/recommendedSettingsLinux.html#recommendedSettingsLinux__disable-swap\n[disableswap]: http://ideaheap.com/2013/07/stopping-sd-card-corruption-on-a-raspberry-pi/\n[storecollection]: https://docs.datastax.com/en/opscenter/6.0/opsc/configure/opscStoringCollectionDataDifferentCluster_t.html\n[killrvideo]: https://killrvideo.github.io/\n[luke]: http://www.luketillman.com/\n[docker]: https://www.docker.com/","slug":"Mixed-Workload-DSE-Cluster-with-Raspberry-PI-s","published":1,"updated":"2017-02-10T21:04:38.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcqm9a61000ov6km4zzyyrfl","content":"<p>Alrighty, as I mentioned in my previous <a href=\"/2017/02/07/I-m-Sure-You-Weren-t-Looking\">post</a> I have a mixed-workload cluster (Cassandra, DSE search, DSE graph) using a combination of 4 Raspberry PI’s and my laptop.  I had multiple things in mind when I started into this.</p>\n<ol>\n<li><p>Low cost for learning</p>\n</li>\n<li><p>Something I can break and not cry about</p>\n</li>\n<li><p>How low can one really go when setting up a cluster?</p>\n</li>\n<li><p>Get some DSE OpsCenter knowledge</p>\n</li>\n<li><p>These are Raspberry PI’s, they are just damn cool, so why not setup a cluster?!</p>\n</li>\n</ol>\n<a id=\"more\"></a>\n<h2 id=\"PIE-Raspberries-3-14-PI\"><a href=\"#PIE-Raspberries-3-14-PI\" class=\"headerlink\" title=\"PIE?  Raspberries? 3.14? PI?\"></a>PIE?  Raspberries? 3.14? PI?</h2>\n<div class=\"responsive-container\" style=\"height:160px\">\n    <div class=\"dummy\"></div>\n    <div class=\"img-container\">\n        <div class=\"centerer\"></div>\n          <img src=\"/2017/02/07/Mixed-Workload-DSE-Cluster-with-Raspberry-PI-s/pie-pi.jpg\" title=\"pie\" width=\"25%\" height=\"auto\">\n          <span><strong>+</strong></span>\n          <img src=\"/2017/02/07/Mixed-Workload-DSE-Cluster-with-Raspberry-PI-s/raspberry.jpg\" title=\"raspberries\" width=\"25%\" height=\"auto\">\n          <span><strong>=</strong></span>\n          <img src=\"/2017/02/07/Mixed-Workload-DSE-Cluster-with-Raspberry-PI-s/raspberrypi.jpg\" title=\"raspberrypi\" width=\"25%\" height=\"auto\">\n    </div>\n</div>\n\n<p>If you are not already familiar with RaspberryPI’s <a href=\"https://www.raspberrypi.org/\" target=\"_blank\" rel=\"external\">go take a look</a>.  These are cool little machines for very little cost.</p>\n<p><a href=\"https://www.raspberrypi.org/products/raspberry-pi-3-model-b/\" target=\"_blank\" rel=\"external\">Here are the specs for the model 3</a>, but just to summarize each node in our cluster only has 1GB of RAM and a 1.2GHz quad-core processor.  This is clearly not a setup to use in your production environment.  This is, however, a great way to learn and experiment.</p>\n<h2 id=\"The-setup\"><a href=\"#The-setup\" class=\"headerlink\" title=\"The setup\"></a>The setup</h2><p>4 <a href=\"https://www.raspberrypi.org/\" target=\"_blank\" rel=\"external\">RaspberryPI’s</a> (wired ethernet)<br>NOTE:  These are designed to be “built up” so you will need to purchase microSD cards and the outer shells separately</p>\n<p>One <code>2.6GHz 8 core</code> MacBook with <code>16GB RAM</code> (wired ethernet)</p>\n<p><a href=\"http://docs.datastax.com/en/latest-opscenter/opsc/about_c.html\" target=\"_blank\" rel=\"external\">DataStax Enterprise Opscenter 6.0.7</a> using <a href=\"https://docs.datastax.com/en/latest-opscenter/opsc/install/opscInstallTar_t.html\" target=\"_blank\" rel=\"external\">tarball installation</a></p>\n<p><a href=\"http://docs.datastax.com/en/latest-opscenter/opsc/install/installDSagents.html\" target=\"_blank\" rel=\"external\">DataStax Agent 6.0.7</a> using <a href=\"http://docs.datastax.com/en/latest-opscenter/opsc/install/opsc-agentInstallManual_t.html\" target=\"_blank\" rel=\"external\">tarball installation</a></p>\n<p><a href=\"http://docs.datastax.com/en/latest-dse/\" target=\"_blank\" rel=\"external\">DataStax Enterprise 5.0.5</a>, again, using the <a href=\"http://docs.datastax.com/en/latest-dse/datastax_enterprise/install/installTARdse.html\" target=\"_blank\" rel=\"external\">tarball installation</a></p>\n<p><a href=\"https://www.ravpower.com/6-port-usb-wall-charger-black-.html\" target=\"_blank\" rel=\"external\">RAVPower 6 port USB charger</a> with a set of USB <code>Male A</code> to <code>Micro B</code> cables.  I also purchased a <code>4x1 HDMI</code> switch, but you can easily run these headless if you know your way around a Linux shell.</p>\n<p>Just a quick note about the tarball installations.  DSE generally supports using installers across most major platforms and for each of the various installs, but since we are using RaspberryPI’s in this case and since I used the <a href=\"https://www.raspberrypi.org/downloads/noobs/\" target=\"_blank\" rel=\"external\">NOOBS</a> install to get up and going as fast as I could it just so happens that combination <strong>only works with tarball installs</strong>.  Please, learn from me and don’t spend the many, many hours I did eventually figuring this out.   </p>\n<p>You can, in fact, install other operating systems on RaspberryPI’s which may allow the installers to work, but you’ll have to come back and tell me about it if you give it a go.</p>\n<p>Aaaaaaand for the reveal dun dunn dunnnnnnnnn! (Yes, those are shiny, lighted cables)<br><img src=\"/2017/02/07/Mixed-Workload-DSE-Cluster-with-Raspberry-PI-s/myPIs.gif\" alt=\"My Raspberry PI Cluster\" title=\"My Raspberry PI Cluster\"></p>\n<h2 id=\"I-may-have-cheated-just-a-little-bit\"><a href=\"#I-may-have-cheated-just-a-little-bit\" class=\"headerlink\" title=\"I may have cheated just a little bit\"></a>I may have cheated just a little bit</h2><p>So, I mentioned above “mixed workload cluster with Raspberry PI’s”.  This is 100% true, but also notice there is a laptop in the mix.  I ended up using the laptop to house OpsCenter and my search/graph datacenter and I’m using the PI’s for my core Cassandra cluster.  In my experience I don’t usually install operations tools and the like directly on production devices facing the public because they have a tendency to cause unpredicatable load.  The limited RAM on the PI’s (1GB) is also a factor which I will address here in a moment.  As far as the search/graph datacenter portion I simply used the laptop out of convienence because I already had a 4-node core Cassandra cluster running on the PI’s at the time and I wanted to observe the interaction between my search/graph and Cassandra datacenters in a “pure” fashion.</p>\n<h2 id=\"Get-this-working-on-PI’s\"><a href=\"#Get-this-working-on-PI’s\" class=\"headerlink\" title=\"Get this working on PI’s\"></a>Get this working on PI’s</h2><p>Raspberry PI’s are special snowflakes when it comes to making this all work.  I will detail all this below, but here, for you, is the summarized list of what is needed.</p>\n<ol>\n<li><p><a href=\"https://docs.datastax.com/en/landing_page/doc/landing_page/recommendedSettingsLinux.html#recommendedSettingsLinux__disable-swap\" target=\"_blank\" rel=\"external\">Disable swap</a><br><code>sudo swapoff -a</code> is your friend.  It is also the quick and dirty way, not permanent on reboot.  Take a look at the “Disable swapping” section of <a href=\"http://ideaheap.com/2013/07/stopping-sd-card-corruption-on-a-raspberry-pi/\" target=\"_blank\" rel=\"external\">this post</a> if you would like a more permanent solution.</p>\n</li>\n<li><p>Go Headless<br>This is quite easy to do using <code>sudo raspi-config</code> while ssh’d into your PI and it will help free up enough memory to make things stable.  Just make sure you already know your PI’s IP address or know how to find it if things go sour.</p>\n</li>\n<li><p>Decrease RAM allocated to datastax-agent from <code>128MB to 64MB</code><br>Edit <code>datastax-agent-env.sh</code> located in [your datastax-agent install dir]/conf/datastax-agent-env.sh</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">From:</div><div class=\"line\">JVM_OPTS=<span class=\"string\">\"<span class=\"variable\">$JVM_OPTS</span> -Xmx128M -Djclouds.mpu.parts.magnitude=100000 -Djclouds.mpu.parts.size=16777216\"</span></div><div class=\"line\"></div><div class=\"line\">To:</div><div class=\"line\">JVM_OPTS=<span class=\"string\">\"<span class=\"variable\">$JVM_OPTS</span> -Xmx64M -Djclouds.mpu.parts.magnitude=100000 -Djclouds.mpu.parts.size=16777216\"</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>Explicitly set Java HEAP settings for Cassandra node<br>Edit <code>cassandra-env.sh</code> located in [your DSE install dir]/resources/cassandra/conf/cassandra-env.sh.  Search for “HEAP” to find and edit the lines.  Notice mine are already set to the working values.  These are commented out by default which will allow the script to calculate values for you, but for our PI case we cannot use the calculated values.</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">MAX_HEAP_SIZE=<span class=\"string\">\"200M\"</span></div><div class=\"line\">HEAP_NEWSIZE=<span class=\"string\">\"50M\"</span></div></pre></td></tr></table></figure>\n</li>\n<li><p><a href=\"https://docs.datastax.com/en/opscenter/6.0/opsc/configure/opscStoringCollectionDataDifferentCluster_t.html\" target=\"_blank\" rel=\"external\">Store collection data on a separate cluster</a><br>Remember that part about “cheating” with my <a href=\"http://docs.datastax.com/en/latest-opscenter/opsc/about_c.html\" target=\"_blank\" rel=\"external\">OpsCenter</a> laptop?  Yup, this is part of it.  I’ll give more details down below.</p>\n</li>\n</ol>\n<h2 id=\"Let’s-talk-about-OpsCenter-agents-memory-disk-speed-and-mucho-frustrationo\"><a href=\"#Let’s-talk-about-OpsCenter-agents-memory-disk-speed-and-mucho-frustrationo\" class=\"headerlink\" title=\"Let’s talk about OpsCenter, agents, memory, disk speed, and mucho frustrationo\"></a>Let’s talk about OpsCenter, agents, memory, disk speed, and mucho frustrationo</h2><p>That’s kind of a long list now that I see it all typed out, but there’s a lot to consider.</p>\n<p>We have nodes with <code>1GB of RAM</code>, a <code>32 bit</code> os, <code>4 cores</code>, and a <code>32GB microSD</code> drive acting as a hard disk.  This is way below the recommended values of <code>16-32GB of RAM</code>, <code>500GB-1TB</code> of fast disk, and <code>64bit</code> with <code>8 cores</code> for running Cassandra nodes, or really any database for that matter.  I wasn’t really sure how well this would work, if at all, given memory contraints alone not to mention the speed of microSD’s for a database that is known to need very fast disk.</p>\n<h3 id=\"OpsCenter\"><a href=\"#OpsCenter\" class=\"headerlink\" title=\"OpsCenter\"></a>OpsCenter</h3><p>I decided right off the bat I wanted OpsCenter in the mix.  Part of this whole project was to learn and what better way than to go whole hog and see what it could do.  If you use OpsCenter you must install <a href=\"http://docs.datastax.com/en/latest-opscenter/opsc/install/installDSagents.html\" target=\"_blank\" rel=\"external\">DataStax agents</a> on each of your nodes in order for magic to happen.  That magic comes at a memory cost, not a huge one, but one that matters when only dealing with <code>1GB of RAM</code>.  In order to leave enough room for the Cassandra node itself to run I effectively cut this requirement in half.  So far, after months of running, I have not seen an issue running agents at <code>64MB of RAM</code>.<br><img src=\"/2017/02/07/Mixed-Workload-DSE-Cluster-with-Raspberry-PI-s/opscenter_cluster.png\" alt=\"Laptop + PI Mixed-Workload Cluster\" title=\"Laptop + PI Mixed-Workload Cluster\"></p>\n<h3 id=\"Cassandra-memory\"><a href=\"#Cassandra-memory\" class=\"headerlink\" title=\"Cassandra memory\"></a>Cassandra memory</h3><p>The default auto caluclated memory configuration for DSE managed Cassandra nodes works well enough even on the PI’s, but there’s a catch.  Remember those agents we need for <a href=\"http://docs.datastax.com/en/latest-opscenter/opsc/about_c.html\" target=\"_blank\" rel=\"external\">OpsCenter</a>?  Well, turns out the agents need just enough extra memory to push things over the edge and on a system with no swap file this means <strong>page fault</strong> which is exactly what happened.  I tried to quash every little process I could to free up enough RAM for my nodes to remain stable and I even made them headless, but to remain stable I had to explicitly configure the HEAP settings for my Cassandra nodes.  The end result is listed up above.</p>\n<h3 id=\"Headless\"><a href=\"#Headless\" class=\"headerlink\" title=\"Headless\"></a>Headless</h3><p>So, before I went headless things were working…uhh…well enough.  Not well enough that I could leave it alone really and any time the system was put under stress <strong>!BAM!</strong> I would lose a node.  This ended up being <strong>the clincher</strong>.  I noticed the Raspbian UI itself was eating up just enough RAM to prevent my nodes from allocating more in times of need.  I chopped off their heads and since then along with the other changes I made my nodes have been rock solid on the memory front.</p>\n<h3 id=\"Memory-is-good-how-about-disk\"><a href=\"#Memory-is-good-how-about-disk\" class=\"headerlink\" title=\"Memory is good how about disk?\"></a>Memory is good how about disk?</h3><p>We already talked about the swap file.  Not only is it <a href=\"https://docs.datastax.com/en/landing_page/doc/landing_page/recommendedSettingsLinux.html#recommendedSettingsLinux__disable-swap\" target=\"_blank\" rel=\"external\">strongly recommended</a> to disable swap on nodes running Cassandra, but even more so on PI’s running on microSD’s.  Before I did so it was clear my nodes were struggling as even small tasks kept driving load up and upon some inspection it was obvious I/O was mostly to blame.  However, something else was lurking even after I disabled swap.  At times I would see my nodes shoot up from a load of <code>&lt;1 upwards to 10+</code>.  At this point they would usually become unresponsive and either crash or eventually come back to reality, but always, always under heavy load.</p>\n<h3 id=\"Colllleccccctionnnnnn-Daaaaatttttaaaaa\"><a href=\"#Colllleccccctionnnnnn-Daaaaatttttaaaaa\" class=\"headerlink\" title=\"Colllleccccctionnnnnn Daaaaatttttaaaaa\"></a>Colllleccccctionnnnnn Daaaaatttttaaaaa</h3><p>Sorry, couldn’t help myself.  As stated above move collection data storage off the PI’s onto a <a href=\"https://docs.datastax.com/en/opscenter/6.0/opsc/configure/opscStoringCollectionDataDifferentCluster_t.html\" target=\"_blank\" rel=\"external\">separate cluster</a>.  They simply cannot handle all of the I/O associated with collecting, storing, and repairing the collection data from the rollup* tables.  Compaction was happening way too fast for the nodes to keep up most likely a result of having very little memory to work with, the PI’s could not keep up with the amount of collection data itself, and read repair on the rollup* tables was a constant, never ending stream of repair.  Once I made the switch my PI nodes all quieted down to a normal <code>load around 1</code>, things have stabilized, and   I no longer have gaps in my analytics data (except for when I <strong>HULK SMASH</strong> nodes myself for fun).</p>\n<h2 id=\"Finally-the-mixed-workload-part\"><a href=\"#Finally-the-mixed-workload-part\" class=\"headerlink\" title=\"Finally, the mixed workload part\"></a>Finally, the mixed workload part</h2><p>Yup, right there in the title and all and I haven’t really mentioned it.  Part of the reason I went and did all of this aside from learning and seeing what could be done was to extend <a href=\"http://www.luketillman.com/\" target=\"_blank\" rel=\"external\">Luke Tillman’s <strong>*cough*….shame…less..plug *cooouugh*</strong></a> freaking awesome <a href=\"https://killrvideo.github.io/\" target=\"_blank\" rel=\"external\">KillrVideo</a> reference app to hook up to clusters outside of its <a href=\"https://www.docker.com/\" target=\"_blank\" rel=\"external\">Dockerized</a> container.  This forced me to extend my existing Cassandra cluster into a mixed workload scenario with <a href=\"http://docs.datastax.com/en/datastax_enterprise/5.0/datastax_enterprise/srch/searchOverview.html\" target=\"_blank\" rel=\"external\">DSE Search</a>.  Right, I could have simply put search within the same cluster, but I was looking to emulate what I would do in a production scenario.  I have an upcoming post on this very topic coming here in the future.  I also had need to extend into <a href=\"http://www.datastax.com/products/datastax-enterprise-graph\" target=\"_blank\" rel=\"external\">DSE graph</a> as well for some of my own projects so I took the opportunity to go ahead and just do it all.  The end result is a fully functional Cassandra/Search/Graph DSE managed mixed workload cluster being served up mostly on Raspberry PI’s with a little help from a laptop all hooked up to <a href=\"https://killrvideo.github.io/\" target=\"_blank\" rel=\"external\">KillrVideo</a>.</p>\n<p>One last thing before I go.  I find that tailing the agent.log, opscenterd.log, and system.log files from all of the nodes is quite insightful especially when watching the interaction between the nodes when performing regular CQL, search, and graph queries.  I’m also the type of person who can watch a defrag for hours and find every little box color change useful information.  </p>\n<p>Not sure what that says about me.  </p>\n","excerpt":"<p>Alrighty, as I mentioned in my previous <a href=\"/2017/02/07/I-m-Sure-You-Weren-t-Looking\">post</a> I have a mixed-workload cluster (Cassandra, DSE search, DSE graph) using a combination of 4 Raspberry PI’s and my laptop.  I had multiple things in mind when I started into this.</p>\n<ol>\n<li><p>Low cost for learning</p>\n</li>\n<li><p>Something I can break and not cry about</p>\n</li>\n<li><p>How low can one really go when setting up a cluster?</p>\n</li>\n<li><p>Get some DSE OpsCenter knowledge</p>\n</li>\n<li><p>These are Raspberry PI’s, they are just damn cool, so why not setup a cluster?!</p>\n</li>\n</ol>","more":"<h2 id=\"PIE-Raspberries-3-14-PI\"><a href=\"#PIE-Raspberries-3-14-PI\" class=\"headerlink\" title=\"PIE?  Raspberries? 3.14? PI?\"></a>PIE?  Raspberries? 3.14? PI?</h2>\n<div class=\"responsive-container\" style=\"height:160px\">\n    <div class=\"dummy\"></div>\n    <div class=\"img-container\">\n        <div class=\"centerer\"></div>\n          <img src=\"/2017/02/07/Mixed-Workload-DSE-Cluster-with-Raspberry-PI-s/pie-pi.jpg\" title=\"pie\" width=\"25%\" height=\"auto\">\n          <span><strong>+</strong></span>\n          <img src=\"/2017/02/07/Mixed-Workload-DSE-Cluster-with-Raspberry-PI-s/raspberry.jpg\" title=\"raspberries\" width=\"25%\" height=\"auto\">\n          <span><strong>=</strong></span>\n          <img src=\"/2017/02/07/Mixed-Workload-DSE-Cluster-with-Raspberry-PI-s/raspberrypi.jpg\" title=\"raspberrypi\" width=\"25%\" height=\"auto\">\n    </div>\n</div>\n\n<p>If you are not already familiar with RaspberryPI’s <a href=\"https://www.raspberrypi.org/\">go take a look</a>.  These are cool little machines for very little cost.</p>\n<p><a href=\"https://www.raspberrypi.org/products/raspberry-pi-3-model-b/\">Here are the specs for the model 3</a>, but just to summarize each node in our cluster only has 1GB of RAM and a 1.2GHz quad-core processor.  This is clearly not a setup to use in your production environment.  This is, however, a great way to learn and experiment.</p>\n<h2 id=\"The-setup\"><a href=\"#The-setup\" class=\"headerlink\" title=\"The setup\"></a>The setup</h2><p>4 <a href=\"https://www.raspberrypi.org/\">RaspberryPI’s</a> (wired ethernet)<br>NOTE:  These are designed to be “built up” so you will need to purchase microSD cards and the outer shells separately</p>\n<p>One <code>2.6GHz 8 core</code> MacBook with <code>16GB RAM</code> (wired ethernet)</p>\n<p><a href=\"http://docs.datastax.com/en/latest-opscenter/opsc/about_c.html\">DataStax Enterprise Opscenter 6.0.7</a> using <a href=\"https://docs.datastax.com/en/latest-opscenter/opsc/install/opscInstallTar_t.html\">tarball installation</a></p>\n<p><a href=\"http://docs.datastax.com/en/latest-opscenter/opsc/install/installDSagents.html\">DataStax Agent 6.0.7</a> using <a href=\"http://docs.datastax.com/en/latest-opscenter/opsc/install/opsc-agentInstallManual_t.html\">tarball installation</a></p>\n<p><a href=\"http://docs.datastax.com/en/latest-dse/\">DataStax Enterprise 5.0.5</a>, again, using the <a href=\"http://docs.datastax.com/en/latest-dse/datastax_enterprise/install/installTARdse.html\">tarball installation</a></p>\n<p><a href=\"https://www.ravpower.com/6-port-usb-wall-charger-black-.html\">RAVPower 6 port USB charger</a> with a set of USB <code>Male A</code> to <code>Micro B</code> cables.  I also purchased a <code>4x1 HDMI</code> switch, but you can easily run these headless if you know your way around a Linux shell.</p>\n<p>Just a quick note about the tarball installations.  DSE generally supports using installers across most major platforms and for each of the various installs, but since we are using RaspberryPI’s in this case and since I used the <a href=\"https://www.raspberrypi.org/downloads/noobs/\">NOOBS</a> install to get up and going as fast as I could it just so happens that combination <strong>only works with tarball installs</strong>.  Please, learn from me and don’t spend the many, many hours I did eventually figuring this out.   </p>\n<p>You can, in fact, install other operating systems on RaspberryPI’s which may allow the installers to work, but you’ll have to come back and tell me about it if you give it a go.</p>\n<p>Aaaaaaand for the reveal dun dunn dunnnnnnnnn! (Yes, those are shiny, lighted cables)<br><img src=\"/2017/02/07/Mixed-Workload-DSE-Cluster-with-Raspberry-PI-s/myPIs.gif\" alt=\"My Raspberry PI Cluster\" title=\"My Raspberry PI Cluster\"></p>\n<h2 id=\"I-may-have-cheated-just-a-little-bit\"><a href=\"#I-may-have-cheated-just-a-little-bit\" class=\"headerlink\" title=\"I may have cheated just a little bit\"></a>I may have cheated just a little bit</h2><p>So, I mentioned above “mixed workload cluster with Raspberry PI’s”.  This is 100% true, but also notice there is a laptop in the mix.  I ended up using the laptop to house OpsCenter and my search/graph datacenter and I’m using the PI’s for my core Cassandra cluster.  In my experience I don’t usually install operations tools and the like directly on production devices facing the public because they have a tendency to cause unpredicatable load.  The limited RAM on the PI’s (1GB) is also a factor which I will address here in a moment.  As far as the search/graph datacenter portion I simply used the laptop out of convienence because I already had a 4-node core Cassandra cluster running on the PI’s at the time and I wanted to observe the interaction between my search/graph and Cassandra datacenters in a “pure” fashion.</p>\n<h2 id=\"Get-this-working-on-PI’s\"><a href=\"#Get-this-working-on-PI’s\" class=\"headerlink\" title=\"Get this working on PI’s\"></a>Get this working on PI’s</h2><p>Raspberry PI’s are special snowflakes when it comes to making this all work.  I will detail all this below, but here, for you, is the summarized list of what is needed.</p>\n<ol>\n<li><p><a href=\"https://docs.datastax.com/en/landing_page/doc/landing_page/recommendedSettingsLinux.html#recommendedSettingsLinux__disable-swap\">Disable swap</a><br><code>sudo swapoff -a</code> is your friend.  It is also the quick and dirty way, not permanent on reboot.  Take a look at the “Disable swapping” section of <a href=\"http://ideaheap.com/2013/07/stopping-sd-card-corruption-on-a-raspberry-pi/\">this post</a> if you would like a more permanent solution.</p>\n</li>\n<li><p>Go Headless<br>This is quite easy to do using <code>sudo raspi-config</code> while ssh’d into your PI and it will help free up enough memory to make things stable.  Just make sure you already know your PI’s IP address or know how to find it if things go sour.</p>\n</li>\n<li><p>Decrease RAM allocated to datastax-agent from <code>128MB to 64MB</code><br>Edit <code>datastax-agent-env.sh</code> located in [your datastax-agent install dir]/conf/datastax-agent-env.sh</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">From:</div><div class=\"line\">JVM_OPTS=<span class=\"string\">\"<span class=\"variable\">$JVM_OPTS</span> -Xmx128M -Djclouds.mpu.parts.magnitude=100000 -Djclouds.mpu.parts.size=16777216\"</span></div><div class=\"line\"></div><div class=\"line\">To:</div><div class=\"line\">JVM_OPTS=<span class=\"string\">\"<span class=\"variable\">$JVM_OPTS</span> -Xmx64M -Djclouds.mpu.parts.magnitude=100000 -Djclouds.mpu.parts.size=16777216\"</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>Explicitly set Java HEAP settings for Cassandra node<br>Edit <code>cassandra-env.sh</code> located in [your DSE install dir]/resources/cassandra/conf/cassandra-env.sh.  Search for “HEAP” to find and edit the lines.  Notice mine are already set to the working values.  These are commented out by default which will allow the script to calculate values for you, but for our PI case we cannot use the calculated values.</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">MAX_HEAP_SIZE=<span class=\"string\">\"200M\"</span></div><div class=\"line\">HEAP_NEWSIZE=<span class=\"string\">\"50M\"</span></div></pre></td></tr></table></figure>\n</li>\n<li><p><a href=\"https://docs.datastax.com/en/opscenter/6.0/opsc/configure/opscStoringCollectionDataDifferentCluster_t.html\">Store collection data on a separate cluster</a><br>Remember that part about “cheating” with my <a href=\"http://docs.datastax.com/en/latest-opscenter/opsc/about_c.html\">OpsCenter</a> laptop?  Yup, this is part of it.  I’ll give more details down below.</p>\n</li>\n</ol>\n<h2 id=\"Let’s-talk-about-OpsCenter-agents-memory-disk-speed-and-mucho-frustrationo\"><a href=\"#Let’s-talk-about-OpsCenter-agents-memory-disk-speed-and-mucho-frustrationo\" class=\"headerlink\" title=\"Let’s talk about OpsCenter, agents, memory, disk speed, and mucho frustrationo\"></a>Let’s talk about OpsCenter, agents, memory, disk speed, and mucho frustrationo</h2><p>That’s kind of a long list now that I see it all typed out, but there’s a lot to consider.</p>\n<p>We have nodes with <code>1GB of RAM</code>, a <code>32 bit</code> os, <code>4 cores</code>, and a <code>32GB microSD</code> drive acting as a hard disk.  This is way below the recommended values of <code>16-32GB of RAM</code>, <code>500GB-1TB</code> of fast disk, and <code>64bit</code> with <code>8 cores</code> for running Cassandra nodes, or really any database for that matter.  I wasn’t really sure how well this would work, if at all, given memory contraints alone not to mention the speed of microSD’s for a database that is known to need very fast disk.</p>\n<h3 id=\"OpsCenter\"><a href=\"#OpsCenter\" class=\"headerlink\" title=\"OpsCenter\"></a>OpsCenter</h3><p>I decided right off the bat I wanted OpsCenter in the mix.  Part of this whole project was to learn and what better way than to go whole hog and see what it could do.  If you use OpsCenter you must install <a href=\"http://docs.datastax.com/en/latest-opscenter/opsc/install/installDSagents.html\">DataStax agents</a> on each of your nodes in order for magic to happen.  That magic comes at a memory cost, not a huge one, but one that matters when only dealing with <code>1GB of RAM</code>.  In order to leave enough room for the Cassandra node itself to run I effectively cut this requirement in half.  So far, after months of running, I have not seen an issue running agents at <code>64MB of RAM</code>.<br><img src=\"/2017/02/07/Mixed-Workload-DSE-Cluster-with-Raspberry-PI-s/opscenter_cluster.png\" alt=\"Laptop + PI Mixed-Workload Cluster\" title=\"Laptop + PI Mixed-Workload Cluster\"></p>\n<h3 id=\"Cassandra-memory\"><a href=\"#Cassandra-memory\" class=\"headerlink\" title=\"Cassandra memory\"></a>Cassandra memory</h3><p>The default auto caluclated memory configuration for DSE managed Cassandra nodes works well enough even on the PI’s, but there’s a catch.  Remember those agents we need for <a href=\"http://docs.datastax.com/en/latest-opscenter/opsc/about_c.html\">OpsCenter</a>?  Well, turns out the agents need just enough extra memory to push things over the edge and on a system with no swap file this means <strong>page fault</strong> which is exactly what happened.  I tried to quash every little process I could to free up enough RAM for my nodes to remain stable and I even made them headless, but to remain stable I had to explicitly configure the HEAP settings for my Cassandra nodes.  The end result is listed up above.</p>\n<h3 id=\"Headless\"><a href=\"#Headless\" class=\"headerlink\" title=\"Headless\"></a>Headless</h3><p>So, before I went headless things were working…uhh…well enough.  Not well enough that I could leave it alone really and any time the system was put under stress <strong>!BAM!</strong> I would lose a node.  This ended up being <strong>the clincher</strong>.  I noticed the Raspbian UI itself was eating up just enough RAM to prevent my nodes from allocating more in times of need.  I chopped off their heads and since then along with the other changes I made my nodes have been rock solid on the memory front.</p>\n<h3 id=\"Memory-is-good-how-about-disk\"><a href=\"#Memory-is-good-how-about-disk\" class=\"headerlink\" title=\"Memory is good how about disk?\"></a>Memory is good how about disk?</h3><p>We already talked about the swap file.  Not only is it <a href=\"https://docs.datastax.com/en/landing_page/doc/landing_page/recommendedSettingsLinux.html#recommendedSettingsLinux__disable-swap\">strongly recommended</a> to disable swap on nodes running Cassandra, but even more so on PI’s running on microSD’s.  Before I did so it was clear my nodes were struggling as even small tasks kept driving load up and upon some inspection it was obvious I/O was mostly to blame.  However, something else was lurking even after I disabled swap.  At times I would see my nodes shoot up from a load of <code>&lt;1 upwards to 10+</code>.  At this point they would usually become unresponsive and either crash or eventually come back to reality, but always, always under heavy load.</p>\n<h3 id=\"Colllleccccctionnnnnn-Daaaaatttttaaaaa\"><a href=\"#Colllleccccctionnnnnn-Daaaaatttttaaaaa\" class=\"headerlink\" title=\"Colllleccccctionnnnnn Daaaaatttttaaaaa\"></a>Colllleccccctionnnnnn Daaaaatttttaaaaa</h3><p>Sorry, couldn’t help myself.  As stated above move collection data storage off the PI’s onto a <a href=\"https://docs.datastax.com/en/opscenter/6.0/opsc/configure/opscStoringCollectionDataDifferentCluster_t.html\">separate cluster</a>.  They simply cannot handle all of the I/O associated with collecting, storing, and repairing the collection data from the rollup* tables.  Compaction was happening way too fast for the nodes to keep up most likely a result of having very little memory to work with, the PI’s could not keep up with the amount of collection data itself, and read repair on the rollup* tables was a constant, never ending stream of repair.  Once I made the switch my PI nodes all quieted down to a normal <code>load around 1</code>, things have stabilized, and   I no longer have gaps in my analytics data (except for when I <strong>HULK SMASH</strong> nodes myself for fun).</p>\n<h2 id=\"Finally-the-mixed-workload-part\"><a href=\"#Finally-the-mixed-workload-part\" class=\"headerlink\" title=\"Finally, the mixed workload part\"></a>Finally, the mixed workload part</h2><p>Yup, right there in the title and all and I haven’t really mentioned it.  Part of the reason I went and did all of this aside from learning and seeing what could be done was to extend <a href=\"http://www.luketillman.com/\">Luke Tillman’s <strong>*cough*….shame…less..plug *cooouugh*</strong></a> freaking awesome <a href=\"https://killrvideo.github.io/\">KillrVideo</a> reference app to hook up to clusters outside of its <a href=\"https://www.docker.com/\">Dockerized</a> container.  This forced me to extend my existing Cassandra cluster into a mixed workload scenario with <a href=\"http://docs.datastax.com/en/datastax_enterprise/5.0/datastax_enterprise/srch/searchOverview.html\">DSE Search</a>.  Right, I could have simply put search within the same cluster, but I was looking to emulate what I would do in a production scenario.  I have an upcoming post on this very topic coming here in the future.  I also had need to extend into <a href=\"http://www.datastax.com/products/datastax-enterprise-graph\">DSE graph</a> as well for some of my own projects so I took the opportunity to go ahead and just do it all.  The end result is a fully functional Cassandra/Search/Graph DSE managed mixed workload cluster being served up mostly on Raspberry PI’s with a little help from a laptop all hooked up to <a href=\"https://killrvideo.github.io/\">KillrVideo</a>.</p>\n<p>One last thing before I go.  I find that tailing the agent.log, opscenterd.log, and system.log files from all of the nodes is quite insightful especially when watching the interaction between the nodes when performing regular CQL, search, and graph queries.  I’m also the type of person who can watch a defrag for hours and find every little box color change useful information.  </p>\n<p>Not sure what that says about me.  </p>"},{"title":"Moving from Cassandra tables to Search with DataStax: Part 2","date":"2018-02-10T16:09:12.000Z","_content":"LOCAL_ONE compared to LOCAL_QUORUM\n\nexclusion of conjunctions now that search expands beyond tags","source":"_posts/Moving-from-Cassandra-tables-to-Search-with-DataStax-Part-2.md","raw":"---\ntitle: 'Moving from Cassandra tables to Search with DataStax: Part 2'\ndate: 2018-02-10 11:09:12\ntags:\n---\nLOCAL_ONE compared to LOCAL_QUORUM\n\nexclusion of conjunctions now that search expands beyond tags","slug":"Moving-from-Cassandra-tables-to-Search-with-DataStax-Part-2","published":1,"updated":"2018-01-19T16:52:51.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcqm9a67000rv6kmswt7cufc","content":"<p>LOCAL_ONE compared to LOCAL_QUORUM</p>\n<p>exclusion of conjunctions now that search expands beyond tags</p>\n","excerpt":"","more":"<p>LOCAL_ONE compared to LOCAL_QUORUM</p>\n<p>exclusion of conjunctions now that search expands beyond tags</p>\n"},{"title":"Moving from Cassandra tables to Search with DataStax: Part 3","date":"2018-02-10T16:09:15.000Z","_content":"\nResults\nNotice that we can use the exact same return types because Search is embedded within CQL queries","source":"_posts/Moving-from-Cassandra-tables-to-Search-with-DataStax-Part-3.md","raw":"---\ntitle: 'Moving from Cassandra tables to Search with DataStax: Part 3'\ndate: 2018-02-10 11:09:15\ntags:\n---\n\nResults\nNotice that we can use the exact same return types because Search is embedded within CQL queries","slug":"Moving-from-Cassandra-tables-to-Search-with-DataStax-Part-3","published":1,"updated":"2018-01-19T16:52:57.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcqm9a6a000sv6km4yj9j6vf","content":"<p>Results<br>Notice that we can use the exact same return types because Search is embedded within CQL queries</p>\n","excerpt":"","more":"<p>Results<br>Notice that we can use the exact same return types because Search is embedded within CQL queries</p>\n"},{"title":"Ok, yea, so maybe it's been a while since I posted","date":"2018-01-09T15:38:20.000Z","_content":"So...I've been busy.  Quite busy since the last time I posted.  Let's see, I got married, added 2 greyhounds to the family, repaired things from Hurricane Irma, been digging into all things [DataStax][datastax], and I have a child on the way (due March 15th).  On the [DataStax][datastax] and [KillrVideo][killrvideo] front I added both a graph based recommendation engine with [DSE Graph][dsegraph] and recently [DSE Search][dsesearch] capability for all video searches in the [Java][killrvideo-java] version.  We also have SparkSQL fun coming up here soon as well.  All of the [application code][killrvideo-java] is available for folks to really do whatever they want with it.  Feel free to leave comments, issues, or make pull requests if you have something fun to add.  My main goal is for KillrVideo to be useful to folks trying to figure this stuff out.\n\nOnce Spark gets into the mix KillrVideo will cover the 4 horsemen of [DataStax Enterprise][enterprise], namely, \n**[Cassandra][enterprise]**, **[Graph][dsegraph]**, **[Search][dsesearch]**, and **[Analytics][dseanalytics]**.  \n<iframe src=\"https://giphy.com/embed/4lF4W1jzt6jC0\" width=\"480\" height=\"272\" frameBorder=\"0\" class=\"giphy-embed\" allowFullScreen></iframe>\n\n<!-- more -->\n\nAnd then...\n...this battle station will be fully operational!!!!\n<iframe src=\"https://giphy.com/embed/yI3rO1XBSf0He\" width=\"480\" height=\"203\" frameBorder=\"0\" class=\"giphy-embed\" allowFullScreen></iframe>\nMostly, except for some unfinished turbo lasers, maybe some panels, like a whole hemisphere worth, just some small items really.\n\n## Sooooo much cool stuff coming!\nSeriously, new OpsCenter, Studio, and DSE everything updates on the way along with a child, but that last one is not part of the normal development cycle....kind of a side project.  Once I can talk about some of the new changes I'll start posting and getting things worked into code.\n\nUntil then I'll be posting about much of what I've been up to this last year and passing on some things I've learned while wrapping my tendrils around all of this NoSQL distributed database stuff.  Fun for all I'm sure.  ;)\n\n\n\n[datastax]: https://www.datastax.com/\n[enterprise]: https://www.datastax.com/products/datastax-enterprise\n[killrvideo]: https://killrvideo.github.io/\n[dsegraph]: http://www.datastax.com/products/datastax-enterprise-graph\n[dsesearch]: https://www.datastax.com/products/datastax-enterprise-search\n[dseanalytics]: https://www.datastax.com/products/datastax-enterprise-analytics\n[opscenter]: https://www.datastax.com/products/datastax-opscenter\n[studio]: https://www.datastax.com/products/datastax-studio-and-development-tools#DataStax-Studio\n[killrvideo-java]: https://github.com/KillrVideo/killrvideo-java","source":"_posts/Ok-yea-so-maybe-it-s-been-a-while-since-I-posted.md","raw":"---\ntitle: 'Ok, yea, so maybe it''s been a while since I posted'\ndate: 2018-01-09 10:38:20\ncategories:\n    - Something Else\ntags:\n    - killrvideo\n    - datastax\n---\nSo...I've been busy.  Quite busy since the last time I posted.  Let's see, I got married, added 2 greyhounds to the family, repaired things from Hurricane Irma, been digging into all things [DataStax][datastax], and I have a child on the way (due March 15th).  On the [DataStax][datastax] and [KillrVideo][killrvideo] front I added both a graph based recommendation engine with [DSE Graph][dsegraph] and recently [DSE Search][dsesearch] capability for all video searches in the [Java][killrvideo-java] version.  We also have SparkSQL fun coming up here soon as well.  All of the [application code][killrvideo-java] is available for folks to really do whatever they want with it.  Feel free to leave comments, issues, or make pull requests if you have something fun to add.  My main goal is for KillrVideo to be useful to folks trying to figure this stuff out.\n\nOnce Spark gets into the mix KillrVideo will cover the 4 horsemen of [DataStax Enterprise][enterprise], namely, \n**[Cassandra][enterprise]**, **[Graph][dsegraph]**, **[Search][dsesearch]**, and **[Analytics][dseanalytics]**.  \n<iframe src=\"https://giphy.com/embed/4lF4W1jzt6jC0\" width=\"480\" height=\"272\" frameBorder=\"0\" class=\"giphy-embed\" allowFullScreen></iframe>\n\n<!-- more -->\n\nAnd then...\n...this battle station will be fully operational!!!!\n<iframe src=\"https://giphy.com/embed/yI3rO1XBSf0He\" width=\"480\" height=\"203\" frameBorder=\"0\" class=\"giphy-embed\" allowFullScreen></iframe>\nMostly, except for some unfinished turbo lasers, maybe some panels, like a whole hemisphere worth, just some small items really.\n\n## Sooooo much cool stuff coming!\nSeriously, new OpsCenter, Studio, and DSE everything updates on the way along with a child, but that last one is not part of the normal development cycle....kind of a side project.  Once I can talk about some of the new changes I'll start posting and getting things worked into code.\n\nUntil then I'll be posting about much of what I've been up to this last year and passing on some things I've learned while wrapping my tendrils around all of this NoSQL distributed database stuff.  Fun for all I'm sure.  ;)\n\n\n\n[datastax]: https://www.datastax.com/\n[enterprise]: https://www.datastax.com/products/datastax-enterprise\n[killrvideo]: https://killrvideo.github.io/\n[dsegraph]: http://www.datastax.com/products/datastax-enterprise-graph\n[dsesearch]: https://www.datastax.com/products/datastax-enterprise-search\n[dseanalytics]: https://www.datastax.com/products/datastax-enterprise-analytics\n[opscenter]: https://www.datastax.com/products/datastax-opscenter\n[studio]: https://www.datastax.com/products/datastax-studio-and-development-tools#DataStax-Studio\n[killrvideo-java]: https://github.com/KillrVideo/killrvideo-java","slug":"Ok-yea-so-maybe-it-s-been-a-while-since-I-posted","published":1,"updated":"2018-01-09T19:14:06.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcqm9a6c000tv6km5li4uv4w","content":"<p>So…I’ve been busy.  Quite busy since the last time I posted.  Let’s see, I got married, added 2 greyhounds to the family, repaired things from Hurricane Irma, been digging into all things <a href=\"https://www.datastax.com/\" target=\"_blank\" rel=\"external\">DataStax</a>, and I have a child on the way (due March 15th).  On the <a href=\"https://www.datastax.com/\" target=\"_blank\" rel=\"external\">DataStax</a> and <a href=\"https://killrvideo.github.io/\" target=\"_blank\" rel=\"external\">KillrVideo</a> front I added both a graph based recommendation engine with <a href=\"http://www.datastax.com/products/datastax-enterprise-graph\" target=\"_blank\" rel=\"external\">DSE Graph</a> and recently <a href=\"https://www.datastax.com/products/datastax-enterprise-search\" target=\"_blank\" rel=\"external\">DSE Search</a> capability for all video searches in the <a href=\"https://github.com/KillrVideo/killrvideo-java\" target=\"_blank\" rel=\"external\">Java</a> version.  We also have SparkSQL fun coming up here soon as well.  All of the <a href=\"https://github.com/KillrVideo/killrvideo-java\" target=\"_blank\" rel=\"external\">application code</a> is available for folks to really do whatever they want with it.  Feel free to leave comments, issues, or make pull requests if you have something fun to add.  My main goal is for KillrVideo to be useful to folks trying to figure this stuff out.</p>\n<p>Once Spark gets into the mix KillrVideo will cover the 4 horsemen of <a href=\"https://www.datastax.com/products/datastax-enterprise\" target=\"_blank\" rel=\"external\">DataStax Enterprise</a>, namely,<br><strong><a href=\"https://www.datastax.com/products/datastax-enterprise\" target=\"_blank\" rel=\"external\">Cassandra</a></strong>, <strong><a href=\"http://www.datastax.com/products/datastax-enterprise-graph\" target=\"_blank\" rel=\"external\">Graph</a></strong>, <strong><a href=\"https://www.datastax.com/products/datastax-enterprise-search\" target=\"_blank\" rel=\"external\">Search</a></strong>, and <strong><a href=\"https://www.datastax.com/products/datastax-enterprise-analytics\" target=\"_blank\" rel=\"external\">Analytics</a></strong>.  </p>\n<iframe src=\"https://giphy.com/embed/4lF4W1jzt6jC0\" width=\"480\" height=\"272\" frameborder=\"0\" class=\"giphy-embed\" allowfullscreen></iframe>\n\n<a id=\"more\"></a>\n<p>And then…<br>…this battle station will be fully operational!!!!</p>\n<p><iframe src=\"https://giphy.com/embed/yI3rO1XBSf0He\" width=\"480\" height=\"203\" frameborder=\"0\" class=\"giphy-embed\" allowfullscreen></iframe><br>Mostly, except for some unfinished turbo lasers, maybe some panels, like a whole hemisphere worth, just some small items really.</p>\n<h2 id=\"Sooooo-much-cool-stuff-coming\"><a href=\"#Sooooo-much-cool-stuff-coming\" class=\"headerlink\" title=\"Sooooo much cool stuff coming!\"></a>Sooooo much cool stuff coming!</h2><p>Seriously, new OpsCenter, Studio, and DSE everything updates on the way along with a child, but that last one is not part of the normal development cycle….kind of a side project.  Once I can talk about some of the new changes I’ll start posting and getting things worked into code.</p>\n<p>Until then I’ll be posting about much of what I’ve been up to this last year and passing on some things I’ve learned while wrapping my tendrils around all of this NoSQL distributed database stuff.  Fun for all I’m sure.  ;)</p>\n","excerpt":"<p>So…I’ve been busy.  Quite busy since the last time I posted.  Let’s see, I got married, added 2 greyhounds to the family, repaired things from Hurricane Irma, been digging into all things <a href=\"https://www.datastax.com/\">DataStax</a>, and I have a child on the way (due March 15th).  On the <a href=\"https://www.datastax.com/\">DataStax</a> and <a href=\"https://killrvideo.github.io/\">KillrVideo</a> front I added both a graph based recommendation engine with <a href=\"http://www.datastax.com/products/datastax-enterprise-graph\">DSE Graph</a> and recently <a href=\"https://www.datastax.com/products/datastax-enterprise-search\">DSE Search</a> capability for all video searches in the <a href=\"https://github.com/KillrVideo/killrvideo-java\">Java</a> version.  We also have SparkSQL fun coming up here soon as well.  All of the <a href=\"https://github.com/KillrVideo/killrvideo-java\">application code</a> is available for folks to really do whatever they want with it.  Feel free to leave comments, issues, or make pull requests if you have something fun to add.  My main goal is for KillrVideo to be useful to folks trying to figure this stuff out.</p>\n<p>Once Spark gets into the mix KillrVideo will cover the 4 horsemen of <a href=\"https://www.datastax.com/products/datastax-enterprise\">DataStax Enterprise</a>, namely,<br><strong><a href=\"https://www.datastax.com/products/datastax-enterprise\">Cassandra</a></strong>, <strong><a href=\"http://www.datastax.com/products/datastax-enterprise-graph\">Graph</a></strong>, <strong><a href=\"https://www.datastax.com/products/datastax-enterprise-search\">Search</a></strong>, and <strong><a href=\"https://www.datastax.com/products/datastax-enterprise-analytics\">Analytics</a></strong>.  </p>\n<iframe src=\"https://giphy.com/embed/4lF4W1jzt6jC0\" width=\"480\" height=\"272\" frameBorder=\"0\" class=\"giphy-embed\" allowFullScreen></iframe>","more":"<p>And then…<br>…this battle station will be fully operational!!!!</p>\n<p><iframe src=\"https://giphy.com/embed/yI3rO1XBSf0He\" width=\"480\" height=\"203\" frameBorder=\"0\" class=\"giphy-embed\" allowFullScreen></iframe><br>Mostly, except for some unfinished turbo lasers, maybe some panels, like a whole hemisphere worth, just some small items really.</p>\n<h2 id=\"Sooooo-much-cool-stuff-coming\"><a href=\"#Sooooo-much-cool-stuff-coming\" class=\"headerlink\" title=\"Sooooo much cool stuff coming!\"></a>Sooooo much cool stuff coming!</h2><p>Seriously, new OpsCenter, Studio, and DSE everything updates on the way along with a child, but that last one is not part of the normal development cycle….kind of a side project.  Once I can talk about some of the new changes I’ll start posting and getting things worked into code.</p>\n<p>Until then I’ll be posting about much of what I’ve been up to this last year and passing on some things I’ve learned while wrapping my tendrils around all of this NoSQL distributed database stuff.  Fun for all I’m sure.  ;)</p>"},{"title":"Moving from Cassandra tables to Search with DataStax: Part 1","date":"2018-01-10T14:28:42.000Z","_content":"Hi there and welcome to **part 1** of a three part series on upgrading our KillrVideo java reference application from Cassandra based tabular searches to using DSE Search.\n\nHere in **part 1**, we'll take a look at the \"before\" picture and how we were previously performing searches.  I'll give some examples of the types of searches and how those were implemented with Cassandra tables.  We'll also talk a little about the \"why\" of moving to DSE Search.\n\nIn **part 2**, I'll explain the transition to DSE Search and what considerations I had to take into account along with a before and after code comparison.\n\nFinally, in **part 3**, we'll take a look at our results along with some of the more advanced types of searches we can now perform.\n\n## Ok, let's do this\nFirst things first...assumptions!  \nIf it isn't obvious, we are using the Java based KillrVideo application for reference.  If you aren't familiar with KillrVideo go take a look [here][killrvideo] to get up to speed.  In short, this is a real, open source, micro-service style application that we build and maintain to present examples and help folks understand the DataStax tech stack.  It's also a nice way that I personally get some code time against the stack in a real application as compared to punching out demo apps.  \n\nWe are using DataStax Enterprise from drivers to cluster.  All of the capabilities we're talking about here are assumed to be within that ecosystem.\n\n<!-- more -->\n\n## Do we really need to use DSE Search?\nNo. Maybe. Yes?  ¯\\\\\\_(ツ)_/¯\nOk, it depends, but for the most basic searches it isn't a requirement.  As a matter of fact search was already implemented in the Java version without using DSE Search.  So, why the change?  Mostly it comes down to requirements and the right tool for the job.  So, before I get into all of this why don't we take a look at the various types of searches that exist in KillrVideo.\n\nIn KillrVideo, you can get details and play any video from the video detail page.  A quick look at the whole page and you can see all of the available searches.  At the top left is the **\"typeahead\" search** bar, over to the right are the **tag search** buttons, and at the very bottom is the **\"more videos like this\"** search.\n{% asset_img videodetail.png \"videodetail\" %}\n\n#### \"Typeahead\" search\nSo, nothing new here really.  These types of searches have been around for quite some time.  Start typing letters in the search bar and you are provided with a list of potential matches \n{% asset_img typeahead.png \"typeahead\" %}\n\n#### Tag search\nThis next one is pretty straightforward as well.  If you click on any of the tag buttons on the video detail page it will perform a search for other videos with the same tag.\n{% asset_img tag.png \"tag\" %}\n\n#### \"More videos like this\" search\nAt the bottom of the video detail page is a section labeled \"More Videos Like This\".  This search will happen automatically when you navigate to any video and present a set of videos that are similar to the video you are currently viewing.  \n{% asset_img morelikethis.png \"more videos like this\" %}\n\n### Let's take a look at the implementation\nRemember I mentioned **before moving** to using DSE Search these were all powered with Cassandra tables.  Let's break some of this down and take a look at some details.  Also, if you are interested check out this [pull request][pullrequest] up on github.  You can use this as a reference of the before and after changes if you so choose.\n\n#### Overview\nSo overall the setup is pretty simple.  We have 3 searches that are supported by a combination of 3 Cassandra tables (the number of searches and tables just happen to match, there is no correlation between them), 3 [table entities][mappedclasses] that map to our Cassandra tables, and 3 [mapping objects][usingmapper] derived from our table entities.  Here is a simple visual representation.\n{% asset_img overviewarch.png \"overview\" %}\n\nNow, I'm really pointing out these particular items because they will come into play later once we move to using DSE Search, namely, we will need to remove most of them.  We'll leave that there for now and come back to it later.\n\nOf the 3 tables I just mentioned 2 of them exist only to support Cassandra based searches in KillrVideo, **tags_by_letter** and **videos_by_tag**.  They follow the [denormalized data model][datamodel] pattern we've come to love in Cassandra and were created solely to support this purpose.  The **videos** table stores all videos inserted into KillrVideo.  It is not specialized to Cassandra based searches and will come into play a little later.\n\nI just mentioned that both **tags_by_letter** and **videos_by_tag** were specially created to support searches within KillrVideo.  Let's take a deeper look at both tables and see what's going on.  If you aren't familiar with primary keys in Apache Cassandra{% raw %}&#8482{% endraw %}\n I highly suggest you take 5 minutes to read [Patrick McFadin's post][primarykeypatrick] on their importance.  This will better explain how they are applied below.\n\nHere is the CQL schema for the **tags_by_letter** table:\n```SQL\nCREATE TABLE IF NOT EXISTS tags_by_letter (\n    first_letter text,\n    tag text,\n    PRIMARY KEY (first_letter, tag)\n);\n```\nThe **first_letter** column is the partition key with **tag** as a clustering column.  The partition key determines where data is located in your cluster while clustering columns handle how data is ordered within the partition.  This is especially useful in cases like a \"typeahead\" search where searches typically start with the first letter of a given search term and usually provide an alphabetical list of results.  This, in a sense, pre-optimizes query results and prevents us from having to sort our data, whether in query execution or code.\n\nJust to absolutely belabor this point (because who doesn't like belaboring something) here is an example of this in action.  Notice how the results are sorted automatically per the **tag** column with no sorting or extra commands needed in the query.\n{% asset_img tagsbyletterexample.png \"tags_by_letter query example\" %}\n\n\nMoving on, here is the CQL schema for the **videos_by_tag** table:\n```SQL\nCREATE TABLE IF NOT EXISTS videos_by_tag (\n    tag text,\n    videoid uuid,\n    added_date timestamp,\n    userid uuid,\n    name text,\n    preview_image_location text,\n    tagged_date timestamp,\n    PRIMARY KEY (tag, videoid)\n);\n```\nAgain, this table was specially created to answer the question of what videos have a specified tag.  It uses **tag** as the partition key which allows for fast retrieval of videos that match a tag when querying.  The other fields you see listed are there to provide information required by our web tier UI.\n\n\n#### VideoAddedHandlers\nAnother portion we need to keep an eye on is the VideoAddedHandlers class.  As the name implies this class is responsible for performing some action(s) every time a video is added to KillrVideo.  If you take a look at the two prepared statements within the init() method you should notice they are inserting data into the 2 search tables we mentioned above **tags_by_letter** and **videos_by_tag**.\n```java\n        videosByTagPrepared = dseSession.prepare(\n                \"INSERT INTO \" + Schema.KEYSPACE + \".\" + videosByTagTableName + \" \" +\n                        \"(tag, videoid, added_date, userid, name, preview_image_location, tagged_date) \" +\n                        \"VALUES (?, ?, ?, ?, ?, ?, ?)\"\n        );\n\n        tagsByLetterPrepared = dseSession.prepare(\n                \"INSERT INTO \" + Schema.KEYSPACE + \".\" + tagsByLetterTableName + \" \" +\n                        \"(first_letter, tag) VALUES (?, ?)\"\n        );\n```\n\nEvery time a video is added these queries are fired off to power our searches.  Notice some of the column names, things like \"tag\" and \"first_letter\".  Again, we will dig into the detailed logic here soon.\n\n#### Detailed logic here soon \nAlrighty, so, we've gone over a high level overview of the various items and objects we are using to support our Cassandra based searches.  Now, let's get into the searches themselves and see what they are doing.\n\n##### \"Typeahead\" search \nAs I mentioned above the typeahead search simply takes the values the user types into the search bar and provides search suggestions based off of the sequence of letters typed in usually with a wildcard attached to the end of the sequence.  An example is something like \"d\" which might return \"database\", \"decision\", \"document\", etc... Then, if the user continues with something like \"da\" could be \"database\", \"databases\", \"datastax\", etc... and so on.\n\nIn the Cassandra based search case this is supported by the **tags_by_letter** table.  Every time a video is added the related subscriber method in the VideoAddedHandlers class is called and **ALL** tags are inserted along with the first letter of the tag into their respective columns.  Since multiple tags are allowed this means we end up looping through and batching up all commands for each tag.\n\nThen, when a user starts typing into the search bar we have the following query to get our results:\n```SQL\nSELECT tag FROM tags_by_letter WHERE first_letter = ? AND tag >= ?\n```\nWhich returns all tags that match the query string from our search.  We loop through those results and send our tags back to the UI.  Pretty simple.  \n\nRemember I previously mentioned the **first_letter** column is the partition key and **tag** is the clustering column which handles data ordering.  This is where this all comes into play.  \n\nAt this point I'd like to point out that we are working only with tags.  **Neither the name or description of any videos are considered**.  Sure, we could add support for this in our data model and code if we really wanted to, but it is something we have to explicitly take into account if we want that capability. \n\n##### Tag search\nOk, let's move to the tag based search.  This one is pretty straightforward.  Click on a tag button in the video details page and return all videos that have the same tag.  This search is supported by the **videos_by_tag** table.  Every time a video is added the related subscriber method in the VideoAddedHandlers class is called and an entry is made for each tag associated with the video.  If a video has one tag there will be a single entry, if it has 5 there will be 5 entries, and so on.  Note that the **videos_by_tag** table is optimized specifically for this task.\n\nIf you click on a tag button the following query is executed:\n```SQL\nSELECT * FROM videos_by_tag WHERE tag = ?\n```\nWhich returns all videos that match the tag provided in the query.  We send these back to the UI which provides a list of videos for you to choose from.\n\n##### \"More videos like this\" search\nThe related videos or \"More videos like this\" section is very similar to the tag search.  The difference in this case is instead of matching only to the selected tag this search will find videos that match all tags of the selected video.  So, if my selected video has tags of \"datastax\", \"dsl\", \"graph\", and \"gremlin\" then the search will return videos that include any of those.  It uses the same query as the tag search above.  The only difference is we'll perform a query for each tag that exists with the video and combine the results.\n\n## A couple things to point out\nFor one, notice how our tables and searches work in lock-step.  The tables were created to support a particular set of searches or \"questions\" asked by our application UI and our code supports whatever CRUD operations are needed to maintain the data we use for searches.  Essentially this was all purpose made to fit our search needs exactly in a denormalized fashion.  This is quite different from how we may have handled things in the relational world.\n\nAlso notice the number of operations needed, mostly on the insert end, to constantly populate the search based tables with data when videos are added to the system.  Now, we're talking about Cassandra here so this is not really that much of an issue, but there is overhead associated with those operations and the code needed to support it.\n\n## Why move to DSE Search?\nSo, what happens now when we want to expand our searches to include more fields separate from tag, provide more varied results, or enable advanced searches?  Is there a way we could reduce the number of overall actions and code needed to support our searches and also speed things up?  Lastly, can we do this in such a way that does not take a whole rethink of our data model?\n\nWell, I think at this point you know exactly what I'm going to suggest, but you'll have to wait until part 2 of this series for details.\n\nOooo...suspense...I know....totally suspenseful\n\nUntil then (quite soon honestly), thanks for reading and I hope you got something useful out of part 1.  Always feel free to add comments or contact me directly for any thoughts or questions.\n\nTake care :D\n\n\n\n[killrvideo]: https://killrvideo.github.io/\n[killrvideo-java]: https://github.com/KillrVideo/killrvideo-java\n[killrvideo-c#]: https://github.com/LukeTillman/killrvideo-csharp\n[killrvideo-nodejs]: https://github.com/KillrVideo/killrvideo-nodejs\n[pullrequest]: https://github.com/KillrVideo/killrvideo-java/pull/23/files\n[mappedclasses]: https://docs.datastax.com/en/developer/java-driver-dse/1.4/manual/object_mapper/creating/\n[usingmapper]: https://docs.datastax.com/en/developer/java-driver-dse/1.4/manual/object_mapper/using/\n[datamodel]: https://www.datastax.com/dev/blog/basic-rules-of-cassandra-data-modeling\n[primarykeypatrick]: https://www.datastax.com/dev/blog/the-most-important-thing-to-know-in-cassandra-data-modeling-the-primary-key\n","source":"_posts/Moving-from-Cassandra-tables-to-Search-with-DataStax-Part-I.md","raw":"---\ntitle: 'Moving from Cassandra tables to Search with DataStax: Part 1'\ndate: 2018-01-10 09:28:42\ntags:\n---\nHi there and welcome to **part 1** of a three part series on upgrading our KillrVideo java reference application from Cassandra based tabular searches to using DSE Search.\n\nHere in **part 1**, we'll take a look at the \"before\" picture and how we were previously performing searches.  I'll give some examples of the types of searches and how those were implemented with Cassandra tables.  We'll also talk a little about the \"why\" of moving to DSE Search.\n\nIn **part 2**, I'll explain the transition to DSE Search and what considerations I had to take into account along with a before and after code comparison.\n\nFinally, in **part 3**, we'll take a look at our results along with some of the more advanced types of searches we can now perform.\n\n## Ok, let's do this\nFirst things first...assumptions!  \nIf it isn't obvious, we are using the Java based KillrVideo application for reference.  If you aren't familiar with KillrVideo go take a look [here][killrvideo] to get up to speed.  In short, this is a real, open source, micro-service style application that we build and maintain to present examples and help folks understand the DataStax tech stack.  It's also a nice way that I personally get some code time against the stack in a real application as compared to punching out demo apps.  \n\nWe are using DataStax Enterprise from drivers to cluster.  All of the capabilities we're talking about here are assumed to be within that ecosystem.\n\n<!-- more -->\n\n## Do we really need to use DSE Search?\nNo. Maybe. Yes?  ¯\\\\\\_(ツ)_/¯\nOk, it depends, but for the most basic searches it isn't a requirement.  As a matter of fact search was already implemented in the Java version without using DSE Search.  So, why the change?  Mostly it comes down to requirements and the right tool for the job.  So, before I get into all of this why don't we take a look at the various types of searches that exist in KillrVideo.\n\nIn KillrVideo, you can get details and play any video from the video detail page.  A quick look at the whole page and you can see all of the available searches.  At the top left is the **\"typeahead\" search** bar, over to the right are the **tag search** buttons, and at the very bottom is the **\"more videos like this\"** search.\n{% asset_img videodetail.png \"videodetail\" %}\n\n#### \"Typeahead\" search\nSo, nothing new here really.  These types of searches have been around for quite some time.  Start typing letters in the search bar and you are provided with a list of potential matches \n{% asset_img typeahead.png \"typeahead\" %}\n\n#### Tag search\nThis next one is pretty straightforward as well.  If you click on any of the tag buttons on the video detail page it will perform a search for other videos with the same tag.\n{% asset_img tag.png \"tag\" %}\n\n#### \"More videos like this\" search\nAt the bottom of the video detail page is a section labeled \"More Videos Like This\".  This search will happen automatically when you navigate to any video and present a set of videos that are similar to the video you are currently viewing.  \n{% asset_img morelikethis.png \"more videos like this\" %}\n\n### Let's take a look at the implementation\nRemember I mentioned **before moving** to using DSE Search these were all powered with Cassandra tables.  Let's break some of this down and take a look at some details.  Also, if you are interested check out this [pull request][pullrequest] up on github.  You can use this as a reference of the before and after changes if you so choose.\n\n#### Overview\nSo overall the setup is pretty simple.  We have 3 searches that are supported by a combination of 3 Cassandra tables (the number of searches and tables just happen to match, there is no correlation between them), 3 [table entities][mappedclasses] that map to our Cassandra tables, and 3 [mapping objects][usingmapper] derived from our table entities.  Here is a simple visual representation.\n{% asset_img overviewarch.png \"overview\" %}\n\nNow, I'm really pointing out these particular items because they will come into play later once we move to using DSE Search, namely, we will need to remove most of them.  We'll leave that there for now and come back to it later.\n\nOf the 3 tables I just mentioned 2 of them exist only to support Cassandra based searches in KillrVideo, **tags_by_letter** and **videos_by_tag**.  They follow the [denormalized data model][datamodel] pattern we've come to love in Cassandra and were created solely to support this purpose.  The **videos** table stores all videos inserted into KillrVideo.  It is not specialized to Cassandra based searches and will come into play a little later.\n\nI just mentioned that both **tags_by_letter** and **videos_by_tag** were specially created to support searches within KillrVideo.  Let's take a deeper look at both tables and see what's going on.  If you aren't familiar with primary keys in Apache Cassandra{% raw %}&#8482{% endraw %}\n I highly suggest you take 5 minutes to read [Patrick McFadin's post][primarykeypatrick] on their importance.  This will better explain how they are applied below.\n\nHere is the CQL schema for the **tags_by_letter** table:\n```SQL\nCREATE TABLE IF NOT EXISTS tags_by_letter (\n    first_letter text,\n    tag text,\n    PRIMARY KEY (first_letter, tag)\n);\n```\nThe **first_letter** column is the partition key with **tag** as a clustering column.  The partition key determines where data is located in your cluster while clustering columns handle how data is ordered within the partition.  This is especially useful in cases like a \"typeahead\" search where searches typically start with the first letter of a given search term and usually provide an alphabetical list of results.  This, in a sense, pre-optimizes query results and prevents us from having to sort our data, whether in query execution or code.\n\nJust to absolutely belabor this point (because who doesn't like belaboring something) here is an example of this in action.  Notice how the results are sorted automatically per the **tag** column with no sorting or extra commands needed in the query.\n{% asset_img tagsbyletterexample.png \"tags_by_letter query example\" %}\n\n\nMoving on, here is the CQL schema for the **videos_by_tag** table:\n```SQL\nCREATE TABLE IF NOT EXISTS videos_by_tag (\n    tag text,\n    videoid uuid,\n    added_date timestamp,\n    userid uuid,\n    name text,\n    preview_image_location text,\n    tagged_date timestamp,\n    PRIMARY KEY (tag, videoid)\n);\n```\nAgain, this table was specially created to answer the question of what videos have a specified tag.  It uses **tag** as the partition key which allows for fast retrieval of videos that match a tag when querying.  The other fields you see listed are there to provide information required by our web tier UI.\n\n\n#### VideoAddedHandlers\nAnother portion we need to keep an eye on is the VideoAddedHandlers class.  As the name implies this class is responsible for performing some action(s) every time a video is added to KillrVideo.  If you take a look at the two prepared statements within the init() method you should notice they are inserting data into the 2 search tables we mentioned above **tags_by_letter** and **videos_by_tag**.\n```java\n        videosByTagPrepared = dseSession.prepare(\n                \"INSERT INTO \" + Schema.KEYSPACE + \".\" + videosByTagTableName + \" \" +\n                        \"(tag, videoid, added_date, userid, name, preview_image_location, tagged_date) \" +\n                        \"VALUES (?, ?, ?, ?, ?, ?, ?)\"\n        );\n\n        tagsByLetterPrepared = dseSession.prepare(\n                \"INSERT INTO \" + Schema.KEYSPACE + \".\" + tagsByLetterTableName + \" \" +\n                        \"(first_letter, tag) VALUES (?, ?)\"\n        );\n```\n\nEvery time a video is added these queries are fired off to power our searches.  Notice some of the column names, things like \"tag\" and \"first_letter\".  Again, we will dig into the detailed logic here soon.\n\n#### Detailed logic here soon \nAlrighty, so, we've gone over a high level overview of the various items and objects we are using to support our Cassandra based searches.  Now, let's get into the searches themselves and see what they are doing.\n\n##### \"Typeahead\" search \nAs I mentioned above the typeahead search simply takes the values the user types into the search bar and provides search suggestions based off of the sequence of letters typed in usually with a wildcard attached to the end of the sequence.  An example is something like \"d\" which might return \"database\", \"decision\", \"document\", etc... Then, if the user continues with something like \"da\" could be \"database\", \"databases\", \"datastax\", etc... and so on.\n\nIn the Cassandra based search case this is supported by the **tags_by_letter** table.  Every time a video is added the related subscriber method in the VideoAddedHandlers class is called and **ALL** tags are inserted along with the first letter of the tag into their respective columns.  Since multiple tags are allowed this means we end up looping through and batching up all commands for each tag.\n\nThen, when a user starts typing into the search bar we have the following query to get our results:\n```SQL\nSELECT tag FROM tags_by_letter WHERE first_letter = ? AND tag >= ?\n```\nWhich returns all tags that match the query string from our search.  We loop through those results and send our tags back to the UI.  Pretty simple.  \n\nRemember I previously mentioned the **first_letter** column is the partition key and **tag** is the clustering column which handles data ordering.  This is where this all comes into play.  \n\nAt this point I'd like to point out that we are working only with tags.  **Neither the name or description of any videos are considered**.  Sure, we could add support for this in our data model and code if we really wanted to, but it is something we have to explicitly take into account if we want that capability. \n\n##### Tag search\nOk, let's move to the tag based search.  This one is pretty straightforward.  Click on a tag button in the video details page and return all videos that have the same tag.  This search is supported by the **videos_by_tag** table.  Every time a video is added the related subscriber method in the VideoAddedHandlers class is called and an entry is made for each tag associated with the video.  If a video has one tag there will be a single entry, if it has 5 there will be 5 entries, and so on.  Note that the **videos_by_tag** table is optimized specifically for this task.\n\nIf you click on a tag button the following query is executed:\n```SQL\nSELECT * FROM videos_by_tag WHERE tag = ?\n```\nWhich returns all videos that match the tag provided in the query.  We send these back to the UI which provides a list of videos for you to choose from.\n\n##### \"More videos like this\" search\nThe related videos or \"More videos like this\" section is very similar to the tag search.  The difference in this case is instead of matching only to the selected tag this search will find videos that match all tags of the selected video.  So, if my selected video has tags of \"datastax\", \"dsl\", \"graph\", and \"gremlin\" then the search will return videos that include any of those.  It uses the same query as the tag search above.  The only difference is we'll perform a query for each tag that exists with the video and combine the results.\n\n## A couple things to point out\nFor one, notice how our tables and searches work in lock-step.  The tables were created to support a particular set of searches or \"questions\" asked by our application UI and our code supports whatever CRUD operations are needed to maintain the data we use for searches.  Essentially this was all purpose made to fit our search needs exactly in a denormalized fashion.  This is quite different from how we may have handled things in the relational world.\n\nAlso notice the number of operations needed, mostly on the insert end, to constantly populate the search based tables with data when videos are added to the system.  Now, we're talking about Cassandra here so this is not really that much of an issue, but there is overhead associated with those operations and the code needed to support it.\n\n## Why move to DSE Search?\nSo, what happens now when we want to expand our searches to include more fields separate from tag, provide more varied results, or enable advanced searches?  Is there a way we could reduce the number of overall actions and code needed to support our searches and also speed things up?  Lastly, can we do this in such a way that does not take a whole rethink of our data model?\n\nWell, I think at this point you know exactly what I'm going to suggest, but you'll have to wait until part 2 of this series for details.\n\nOooo...suspense...I know....totally suspenseful\n\nUntil then (quite soon honestly), thanks for reading and I hope you got something useful out of part 1.  Always feel free to add comments or contact me directly for any thoughts or questions.\n\nTake care :D\n\n\n\n[killrvideo]: https://killrvideo.github.io/\n[killrvideo-java]: https://github.com/KillrVideo/killrvideo-java\n[killrvideo-c#]: https://github.com/LukeTillman/killrvideo-csharp\n[killrvideo-nodejs]: https://github.com/KillrVideo/killrvideo-nodejs\n[pullrequest]: https://github.com/KillrVideo/killrvideo-java/pull/23/files\n[mappedclasses]: https://docs.datastax.com/en/developer/java-driver-dse/1.4/manual/object_mapper/creating/\n[usingmapper]: https://docs.datastax.com/en/developer/java-driver-dse/1.4/manual/object_mapper/using/\n[datamodel]: https://www.datastax.com/dev/blog/basic-rules-of-cassandra-data-modeling\n[primarykeypatrick]: https://www.datastax.com/dev/blog/the-most-important-thing-to-know-in-cassandra-data-modeling-the-primary-key\n","slug":"Moving-from-Cassandra-tables-to-Search-with-DataStax-Part-I","published":1,"updated":"2018-01-22T19:38:23.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjcqm9a6f000wv6kmlkzc9f6b","content":"<p>Hi there and welcome to <strong>part 1</strong> of a three part series on upgrading our KillrVideo java reference application from Cassandra based tabular searches to using DSE Search.</p>\n<p>Here in <strong>part 1</strong>, we’ll take a look at the “before” picture and how we were previously performing searches.  I’ll give some examples of the types of searches and how those were implemented with Cassandra tables.  We’ll also talk a little about the “why” of moving to DSE Search.</p>\n<p>In <strong>part 2</strong>, I’ll explain the transition to DSE Search and what considerations I had to take into account along with a before and after code comparison.</p>\n<p>Finally, in <strong>part 3</strong>, we’ll take a look at our results along with some of the more advanced types of searches we can now perform.</p>\n<h2 id=\"Ok-let’s-do-this\"><a href=\"#Ok-let’s-do-this\" class=\"headerlink\" title=\"Ok, let’s do this\"></a>Ok, let’s do this</h2><p>First things first…assumptions!<br>If it isn’t obvious, we are using the Java based KillrVideo application for reference.  If you aren’t familiar with KillrVideo go take a look <a href=\"https://killrvideo.github.io/\" target=\"_blank\" rel=\"external\">here</a> to get up to speed.  In short, this is a real, open source, micro-service style application that we build and maintain to present examples and help folks understand the DataStax tech stack.  It’s also a nice way that I personally get some code time against the stack in a real application as compared to punching out demo apps.  </p>\n<p>We are using DataStax Enterprise from drivers to cluster.  All of the capabilities we’re talking about here are assumed to be within that ecosystem.</p>\n<a id=\"more\"></a>\n<h2 id=\"Do-we-really-need-to-use-DSE-Search\"><a href=\"#Do-we-really-need-to-use-DSE-Search\" class=\"headerlink\" title=\"Do we really need to use DSE Search?\"></a>Do we really need to use DSE Search?</h2><p>No. Maybe. Yes?  ¯\\_(ツ)_/¯<br>Ok, it depends, but for the most basic searches it isn’t a requirement.  As a matter of fact search was already implemented in the Java version without using DSE Search.  So, why the change?  Mostly it comes down to requirements and the right tool for the job.  So, before I get into all of this why don’t we take a look at the various types of searches that exist in KillrVideo.</p>\n<p>In KillrVideo, you can get details and play any video from the video detail page.  A quick look at the whole page and you can see all of the available searches.  At the top left is the <strong>“typeahead” search</strong> bar, over to the right are the <strong>tag search</strong> buttons, and at the very bottom is the <strong>“more videos like this”</strong> search.<br><img src=\"/2018/01/10/Moving-from-Cassandra-tables-to-Search-with-DataStax-Part-I/videodetail.png\" alt=\"videodetail\" title=\"videodetail\"></p>\n<h4 id=\"“Typeahead”-search\"><a href=\"#“Typeahead”-search\" class=\"headerlink\" title=\"“Typeahead” search\"></a>“Typeahead” search</h4><p>So, nothing new here really.  These types of searches have been around for quite some time.  Start typing letters in the search bar and you are provided with a list of potential matches<br><img src=\"/2018/01/10/Moving-from-Cassandra-tables-to-Search-with-DataStax-Part-I/typeahead.png\" alt=\"typeahead\" title=\"typeahead\"></p>\n<h4 id=\"Tag-search\"><a href=\"#Tag-search\" class=\"headerlink\" title=\"Tag search\"></a>Tag search</h4><p>This next one is pretty straightforward as well.  If you click on any of the tag buttons on the video detail page it will perform a search for other videos with the same tag.<br><img src=\"/2018/01/10/Moving-from-Cassandra-tables-to-Search-with-DataStax-Part-I/tag.png\" alt=\"tag\" title=\"tag\"></p>\n<h4 id=\"“More-videos-like-this”-search\"><a href=\"#“More-videos-like-this”-search\" class=\"headerlink\" title=\"“More videos like this” search\"></a>“More videos like this” search</h4><p>At the bottom of the video detail page is a section labeled “More Videos Like This”.  This search will happen automatically when you navigate to any video and present a set of videos that are similar to the video you are currently viewing.<br><img src=\"/2018/01/10/Moving-from-Cassandra-tables-to-Search-with-DataStax-Part-I/morelikethis.png\" alt=\"more videos like this\" title=\"more videos like this\"></p>\n<h3 id=\"Let’s-take-a-look-at-the-implementation\"><a href=\"#Let’s-take-a-look-at-the-implementation\" class=\"headerlink\" title=\"Let’s take a look at the implementation\"></a>Let’s take a look at the implementation</h3><p>Remember I mentioned <strong>before moving</strong> to using DSE Search these were all powered with Cassandra tables.  Let’s break some of this down and take a look at some details.  Also, if you are interested check out this <a href=\"https://github.com/KillrVideo/killrvideo-java/pull/23/files\" target=\"_blank\" rel=\"external\">pull request</a> up on github.  You can use this as a reference of the before and after changes if you so choose.</p>\n<h4 id=\"Overview\"><a href=\"#Overview\" class=\"headerlink\" title=\"Overview\"></a>Overview</h4><p>So overall the setup is pretty simple.  We have 3 searches that are supported by a combination of 3 Cassandra tables (the number of searches and tables just happen to match, there is no correlation between them), 3 <a href=\"https://docs.datastax.com/en/developer/java-driver-dse/1.4/manual/object_mapper/creating/\" target=\"_blank\" rel=\"external\">table entities</a> that map to our Cassandra tables, and 3 <a href=\"https://docs.datastax.com/en/developer/java-driver-dse/1.4/manual/object_mapper/using/\" target=\"_blank\" rel=\"external\">mapping objects</a> derived from our table entities.  Here is a simple visual representation.<br><img src=\"/2018/01/10/Moving-from-Cassandra-tables-to-Search-with-DataStax-Part-I/overviewarch.png\" alt=\"overview\" title=\"overview\"></p>\n<p>Now, I’m really pointing out these particular items because they will come into play later once we move to using DSE Search, namely, we will need to remove most of them.  We’ll leave that there for now and come back to it later.</p>\n<p>Of the 3 tables I just mentioned 2 of them exist only to support Cassandra based searches in KillrVideo, <strong>tags_by_letter</strong> and <strong>videos_by_tag</strong>.  They follow the <a href=\"https://www.datastax.com/dev/blog/basic-rules-of-cassandra-data-modeling\" target=\"_blank\" rel=\"external\">denormalized data model</a> pattern we’ve come to love in Cassandra and were created solely to support this purpose.  The <strong>videos</strong> table stores all videos inserted into KillrVideo.  It is not specialized to Cassandra based searches and will come into play a little later.</p>\n<p>I just mentioned that both <strong>tags_by_letter</strong> and <strong>videos_by_tag</strong> were specially created to support searches within KillrVideo.  Let’s take a deeper look at both tables and see what’s going on.  If you aren’t familiar with primary keys in Apache Cassandra&#8482<br> I highly suggest you take 5 minutes to read <a href=\"https://www.datastax.com/dev/blog/the-most-important-thing-to-know-in-cassandra-data-modeling-the-primary-key\" target=\"_blank\" rel=\"external\">Patrick McFadin’s post</a> on their importance.  This will better explain how they are applied below.</p>\n<p>Here is the CQL schema for the <strong>tags_by_letter</strong> table:<br><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> <span class=\"keyword\">IF</span> <span class=\"keyword\">NOT</span> <span class=\"keyword\">EXISTS</span> tags_by_letter (</div><div class=\"line\">    first_letter <span class=\"built_in\">text</span>,</div><div class=\"line\">    tag <span class=\"built_in\">text</span>,</div><div class=\"line\">    PRIMARY <span class=\"keyword\">KEY</span> (first_letter, tag)</div><div class=\"line\">);</div></pre></td></tr></table></figure></p>\n<p>The <strong>first_letter</strong> column is the partition key with <strong>tag</strong> as a clustering column.  The partition key determines where data is located in your cluster while clustering columns handle how data is ordered within the partition.  This is especially useful in cases like a “typeahead” search where searches typically start with the first letter of a given search term and usually provide an alphabetical list of results.  This, in a sense, pre-optimizes query results and prevents us from having to sort our data, whether in query execution or code.</p>\n<p>Just to absolutely belabor this point (because who doesn’t like belaboring something) here is an example of this in action.  Notice how the results are sorted automatically per the <strong>tag</strong> column with no sorting or extra commands needed in the query.<br><img src=\"/2018/01/10/Moving-from-Cassandra-tables-to-Search-with-DataStax-Part-I/tagsbyletterexample.png\" alt=\"tags_by_letter query example\" title=\"tags_by_letter query example\"></p>\n<p>Moving on, here is the CQL schema for the <strong>videos_by_tag</strong> table:<br><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> <span class=\"keyword\">IF</span> <span class=\"keyword\">NOT</span> <span class=\"keyword\">EXISTS</span> videos_by_tag (</div><div class=\"line\">    tag <span class=\"built_in\">text</span>,</div><div class=\"line\">    videoid <span class=\"keyword\">uuid</span>,</div><div class=\"line\">    added_date <span class=\"keyword\">timestamp</span>,</div><div class=\"line\">    userid <span class=\"keyword\">uuid</span>,</div><div class=\"line\">    <span class=\"keyword\">name</span> <span class=\"built_in\">text</span>,</div><div class=\"line\">    preview_image_location <span class=\"built_in\">text</span>,</div><div class=\"line\">    tagged_date <span class=\"keyword\">timestamp</span>,</div><div class=\"line\">    PRIMARY <span class=\"keyword\">KEY</span> (tag, videoid)</div><div class=\"line\">);</div></pre></td></tr></table></figure></p>\n<p>Again, this table was specially created to answer the question of what videos have a specified tag.  It uses <strong>tag</strong> as the partition key which allows for fast retrieval of videos that match a tag when querying.  The other fields you see listed are there to provide information required by our web tier UI.</p>\n<h4 id=\"VideoAddedHandlers\"><a href=\"#VideoAddedHandlers\" class=\"headerlink\" title=\"VideoAddedHandlers\"></a>VideoAddedHandlers</h4><p>Another portion we need to keep an eye on is the VideoAddedHandlers class.  As the name implies this class is responsible for performing some action(s) every time a video is added to KillrVideo.  If you take a look at the two prepared statements within the init() method you should notice they are inserting data into the 2 search tables we mentioned above <strong>tags_by_letter</strong> and <strong>videos_by_tag</strong>.<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\">videosByTagPrepared = dseSession.prepare(</div><div class=\"line\">        <span class=\"string\">\"INSERT INTO \"</span> + Schema.KEYSPACE + <span class=\"string\">\".\"</span> + videosByTagTableName + <span class=\"string\">\" \"</span> +</div><div class=\"line\">                <span class=\"string\">\"(tag, videoid, added_date, userid, name, preview_image_location, tagged_date) \"</span> +</div><div class=\"line\">                <span class=\"string\">\"VALUES (?, ?, ?, ?, ?, ?, ?)\"</span></div><div class=\"line\">);</div><div class=\"line\"></div><div class=\"line\">tagsByLetterPrepared = dseSession.prepare(</div><div class=\"line\">        <span class=\"string\">\"INSERT INTO \"</span> + Schema.KEYSPACE + <span class=\"string\">\".\"</span> + tagsByLetterTableName + <span class=\"string\">\" \"</span> +</div><div class=\"line\">                <span class=\"string\">\"(first_letter, tag) VALUES (?, ?)\"</span></div><div class=\"line\">);</div></pre></td></tr></table></figure></p>\n<p>Every time a video is added these queries are fired off to power our searches.  Notice some of the column names, things like “tag” and “first_letter”.  Again, we will dig into the detailed logic here soon.</p>\n<h4 id=\"Detailed-logic-here-soon\"><a href=\"#Detailed-logic-here-soon\" class=\"headerlink\" title=\"Detailed logic here soon\"></a>Detailed logic here soon</h4><p>Alrighty, so, we’ve gone over a high level overview of the various items and objects we are using to support our Cassandra based searches.  Now, let’s get into the searches themselves and see what they are doing.</p>\n<h5 id=\"“Typeahead”-search-1\"><a href=\"#“Typeahead”-search-1\" class=\"headerlink\" title=\"“Typeahead” search\"></a>“Typeahead” search</h5><p>As I mentioned above the typeahead search simply takes the values the user types into the search bar and provides search suggestions based off of the sequence of letters typed in usually with a wildcard attached to the end of the sequence.  An example is something like “d” which might return “database”, “decision”, “document”, etc… Then, if the user continues with something like “da” could be “database”, “databases”, “datastax”, etc… and so on.</p>\n<p>In the Cassandra based search case this is supported by the <strong>tags_by_letter</strong> table.  Every time a video is added the related subscriber method in the VideoAddedHandlers class is called and <strong>ALL</strong> tags are inserted along with the first letter of the tag into their respective columns.  Since multiple tags are allowed this means we end up looping through and batching up all commands for each tag.</p>\n<p>Then, when a user starts typing into the search bar we have the following query to get our results:<br><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">SELECT</span> tag <span class=\"keyword\">FROM</span> tags_by_letter <span class=\"keyword\">WHERE</span> first_letter = ? <span class=\"keyword\">AND</span> tag &gt;= ?</div></pre></td></tr></table></figure></p>\n<p>Which returns all tags that match the query string from our search.  We loop through those results and send our tags back to the UI.  Pretty simple.  </p>\n<p>Remember I previously mentioned the <strong>first_letter</strong> column is the partition key and <strong>tag</strong> is the clustering column which handles data ordering.  This is where this all comes into play.  </p>\n<p>At this point I’d like to point out that we are working only with tags.  <strong>Neither the name or description of any videos are considered</strong>.  Sure, we could add support for this in our data model and code if we really wanted to, but it is something we have to explicitly take into account if we want that capability. </p>\n<h5 id=\"Tag-search-1\"><a href=\"#Tag-search-1\" class=\"headerlink\" title=\"Tag search\"></a>Tag search</h5><p>Ok, let’s move to the tag based search.  This one is pretty straightforward.  Click on a tag button in the video details page and return all videos that have the same tag.  This search is supported by the <strong>videos_by_tag</strong> table.  Every time a video is added the related subscriber method in the VideoAddedHandlers class is called and an entry is made for each tag associated with the video.  If a video has one tag there will be a single entry, if it has 5 there will be 5 entries, and so on.  Note that the <strong>videos_by_tag</strong> table is optimized specifically for this task.</p>\n<p>If you click on a tag button the following query is executed:<br><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">SELECT</span> * <span class=\"keyword\">FROM</span> videos_by_tag <span class=\"keyword\">WHERE</span> tag = ?</div></pre></td></tr></table></figure></p>\n<p>Which returns all videos that match the tag provided in the query.  We send these back to the UI which provides a list of videos for you to choose from.</p>\n<h5 id=\"“More-videos-like-this”-search-1\"><a href=\"#“More-videos-like-this”-search-1\" class=\"headerlink\" title=\"“More videos like this” search\"></a>“More videos like this” search</h5><p>The related videos or “More videos like this” section is very similar to the tag search.  The difference in this case is instead of matching only to the selected tag this search will find videos that match all tags of the selected video.  So, if my selected video has tags of “datastax”, “dsl”, “graph”, and “gremlin” then the search will return videos that include any of those.  It uses the same query as the tag search above.  The only difference is we’ll perform a query for each tag that exists with the video and combine the results.</p>\n<h2 id=\"A-couple-things-to-point-out\"><a href=\"#A-couple-things-to-point-out\" class=\"headerlink\" title=\"A couple things to point out\"></a>A couple things to point out</h2><p>For one, notice how our tables and searches work in lock-step.  The tables were created to support a particular set of searches or “questions” asked by our application UI and our code supports whatever CRUD operations are needed to maintain the data we use for searches.  Essentially this was all purpose made to fit our search needs exactly in a denormalized fashion.  This is quite different from how we may have handled things in the relational world.</p>\n<p>Also notice the number of operations needed, mostly on the insert end, to constantly populate the search based tables with data when videos are added to the system.  Now, we’re talking about Cassandra here so this is not really that much of an issue, but there is overhead associated with those operations and the code needed to support it.</p>\n<h2 id=\"Why-move-to-DSE-Search\"><a href=\"#Why-move-to-DSE-Search\" class=\"headerlink\" title=\"Why move to DSE Search?\"></a>Why move to DSE Search?</h2><p>So, what happens now when we want to expand our searches to include more fields separate from tag, provide more varied results, or enable advanced searches?  Is there a way we could reduce the number of overall actions and code needed to support our searches and also speed things up?  Lastly, can we do this in such a way that does not take a whole rethink of our data model?</p>\n<p>Well, I think at this point you know exactly what I’m going to suggest, but you’ll have to wait until part 2 of this series for details.</p>\n<p>Oooo…suspense…I know….totally suspenseful</p>\n<p>Until then (quite soon honestly), thanks for reading and I hope you got something useful out of part 1.  Always feel free to add comments or contact me directly for any thoughts or questions.</p>\n<p>Take care :D</p>\n","excerpt":"<p>Hi there and welcome to <strong>part 1</strong> of a three part series on upgrading our KillrVideo java reference application from Cassandra based tabular searches to using DSE Search.</p>\n<p>Here in <strong>part 1</strong>, we’ll take a look at the “before” picture and how we were previously performing searches.  I’ll give some examples of the types of searches and how those were implemented with Cassandra tables.  We’ll also talk a little about the “why” of moving to DSE Search.</p>\n<p>In <strong>part 2</strong>, I’ll explain the transition to DSE Search and what considerations I had to take into account along with a before and after code comparison.</p>\n<p>Finally, in <strong>part 3</strong>, we’ll take a look at our results along with some of the more advanced types of searches we can now perform.</p>\n<h2 id=\"Ok-let’s-do-this\"><a href=\"#Ok-let’s-do-this\" class=\"headerlink\" title=\"Ok, let’s do this\"></a>Ok, let’s do this</h2><p>First things first…assumptions!<br>If it isn’t obvious, we are using the Java based KillrVideo application for reference.  If you aren’t familiar with KillrVideo go take a look <a href=\"https://killrvideo.github.io/\">here</a> to get up to speed.  In short, this is a real, open source, micro-service style application that we build and maintain to present examples and help folks understand the DataStax tech stack.  It’s also a nice way that I personally get some code time against the stack in a real application as compared to punching out demo apps.  </p>\n<p>We are using DataStax Enterprise from drivers to cluster.  All of the capabilities we’re talking about here are assumed to be within that ecosystem.</p>","more":"<h2 id=\"Do-we-really-need-to-use-DSE-Search\"><a href=\"#Do-we-really-need-to-use-DSE-Search\" class=\"headerlink\" title=\"Do we really need to use DSE Search?\"></a>Do we really need to use DSE Search?</h2><p>No. Maybe. Yes?  ¯\\_(ツ)_/¯<br>Ok, it depends, but for the most basic searches it isn’t a requirement.  As a matter of fact search was already implemented in the Java version without using DSE Search.  So, why the change?  Mostly it comes down to requirements and the right tool for the job.  So, before I get into all of this why don’t we take a look at the various types of searches that exist in KillrVideo.</p>\n<p>In KillrVideo, you can get details and play any video from the video detail page.  A quick look at the whole page and you can see all of the available searches.  At the top left is the <strong>“typeahead” search</strong> bar, over to the right are the <strong>tag search</strong> buttons, and at the very bottom is the <strong>“more videos like this”</strong> search.<br><img src=\"/2018/01/10/Moving-from-Cassandra-tables-to-Search-with-DataStax-Part-I/videodetail.png\" alt=\"videodetail\" title=\"videodetail\"></p>\n<h4 id=\"“Typeahead”-search\"><a href=\"#“Typeahead”-search\" class=\"headerlink\" title=\"“Typeahead” search\"></a>“Typeahead” search</h4><p>So, nothing new here really.  These types of searches have been around for quite some time.  Start typing letters in the search bar and you are provided with a list of potential matches<br><img src=\"/2018/01/10/Moving-from-Cassandra-tables-to-Search-with-DataStax-Part-I/typeahead.png\" alt=\"typeahead\" title=\"typeahead\"></p>\n<h4 id=\"Tag-search\"><a href=\"#Tag-search\" class=\"headerlink\" title=\"Tag search\"></a>Tag search</h4><p>This next one is pretty straightforward as well.  If you click on any of the tag buttons on the video detail page it will perform a search for other videos with the same tag.<br><img src=\"/2018/01/10/Moving-from-Cassandra-tables-to-Search-with-DataStax-Part-I/tag.png\" alt=\"tag\" title=\"tag\"></p>\n<h4 id=\"“More-videos-like-this”-search\"><a href=\"#“More-videos-like-this”-search\" class=\"headerlink\" title=\"“More videos like this” search\"></a>“More videos like this” search</h4><p>At the bottom of the video detail page is a section labeled “More Videos Like This”.  This search will happen automatically when you navigate to any video and present a set of videos that are similar to the video you are currently viewing.<br><img src=\"/2018/01/10/Moving-from-Cassandra-tables-to-Search-with-DataStax-Part-I/morelikethis.png\" alt=\"more videos like this\" title=\"more videos like this\"></p>\n<h3 id=\"Let’s-take-a-look-at-the-implementation\"><a href=\"#Let’s-take-a-look-at-the-implementation\" class=\"headerlink\" title=\"Let’s take a look at the implementation\"></a>Let’s take a look at the implementation</h3><p>Remember I mentioned <strong>before moving</strong> to using DSE Search these were all powered with Cassandra tables.  Let’s break some of this down and take a look at some details.  Also, if you are interested check out this <a href=\"https://github.com/KillrVideo/killrvideo-java/pull/23/files\">pull request</a> up on github.  You can use this as a reference of the before and after changes if you so choose.</p>\n<h4 id=\"Overview\"><a href=\"#Overview\" class=\"headerlink\" title=\"Overview\"></a>Overview</h4><p>So overall the setup is pretty simple.  We have 3 searches that are supported by a combination of 3 Cassandra tables (the number of searches and tables just happen to match, there is no correlation between them), 3 <a href=\"https://docs.datastax.com/en/developer/java-driver-dse/1.4/manual/object_mapper/creating/\">table entities</a> that map to our Cassandra tables, and 3 <a href=\"https://docs.datastax.com/en/developer/java-driver-dse/1.4/manual/object_mapper/using/\">mapping objects</a> derived from our table entities.  Here is a simple visual representation.<br><img src=\"/2018/01/10/Moving-from-Cassandra-tables-to-Search-with-DataStax-Part-I/overviewarch.png\" alt=\"overview\" title=\"overview\"></p>\n<p>Now, I’m really pointing out these particular items because they will come into play later once we move to using DSE Search, namely, we will need to remove most of them.  We’ll leave that there for now and come back to it later.</p>\n<p>Of the 3 tables I just mentioned 2 of them exist only to support Cassandra based searches in KillrVideo, <strong>tags_by_letter</strong> and <strong>videos_by_tag</strong>.  They follow the <a href=\"https://www.datastax.com/dev/blog/basic-rules-of-cassandra-data-modeling\">denormalized data model</a> pattern we’ve come to love in Cassandra and were created solely to support this purpose.  The <strong>videos</strong> table stores all videos inserted into KillrVideo.  It is not specialized to Cassandra based searches and will come into play a little later.</p>\n<p>I just mentioned that both <strong>tags_by_letter</strong> and <strong>videos_by_tag</strong> were specially created to support searches within KillrVideo.  Let’s take a deeper look at both tables and see what’s going on.  If you aren’t familiar with primary keys in Apache Cassandra&#8482<br> I highly suggest you take 5 minutes to read <a href=\"https://www.datastax.com/dev/blog/the-most-important-thing-to-know-in-cassandra-data-modeling-the-primary-key\">Patrick McFadin’s post</a> on their importance.  This will better explain how they are applied below.</p>\n<p>Here is the CQL schema for the <strong>tags_by_letter</strong> table:<br><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> <span class=\"keyword\">IF</span> <span class=\"keyword\">NOT</span> <span class=\"keyword\">EXISTS</span> tags_by_letter (</div><div class=\"line\">    first_letter <span class=\"built_in\">text</span>,</div><div class=\"line\">    tag <span class=\"built_in\">text</span>,</div><div class=\"line\">    PRIMARY <span class=\"keyword\">KEY</span> (first_letter, tag)</div><div class=\"line\">);</div></pre></td></tr></table></figure></p>\n<p>The <strong>first_letter</strong> column is the partition key with <strong>tag</strong> as a clustering column.  The partition key determines where data is located in your cluster while clustering columns handle how data is ordered within the partition.  This is especially useful in cases like a “typeahead” search where searches typically start with the first letter of a given search term and usually provide an alphabetical list of results.  This, in a sense, pre-optimizes query results and prevents us from having to sort our data, whether in query execution or code.</p>\n<p>Just to absolutely belabor this point (because who doesn’t like belaboring something) here is an example of this in action.  Notice how the results are sorted automatically per the <strong>tag</strong> column with no sorting or extra commands needed in the query.<br><img src=\"/2018/01/10/Moving-from-Cassandra-tables-to-Search-with-DataStax-Part-I/tagsbyletterexample.png\" alt=\"tags_by_letter query example\" title=\"tags_by_letter query example\"></p>\n<p>Moving on, here is the CQL schema for the <strong>videos_by_tag</strong> table:<br><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> <span class=\"keyword\">IF</span> <span class=\"keyword\">NOT</span> <span class=\"keyword\">EXISTS</span> videos_by_tag (</div><div class=\"line\">    tag <span class=\"built_in\">text</span>,</div><div class=\"line\">    videoid <span class=\"keyword\">uuid</span>,</div><div class=\"line\">    added_date <span class=\"keyword\">timestamp</span>,</div><div class=\"line\">    userid <span class=\"keyword\">uuid</span>,</div><div class=\"line\">    <span class=\"keyword\">name</span> <span class=\"built_in\">text</span>,</div><div class=\"line\">    preview_image_location <span class=\"built_in\">text</span>,</div><div class=\"line\">    tagged_date <span class=\"keyword\">timestamp</span>,</div><div class=\"line\">    PRIMARY <span class=\"keyword\">KEY</span> (tag, videoid)</div><div class=\"line\">);</div></pre></td></tr></table></figure></p>\n<p>Again, this table was specially created to answer the question of what videos have a specified tag.  It uses <strong>tag</strong> as the partition key which allows for fast retrieval of videos that match a tag when querying.  The other fields you see listed are there to provide information required by our web tier UI.</p>\n<h4 id=\"VideoAddedHandlers\"><a href=\"#VideoAddedHandlers\" class=\"headerlink\" title=\"VideoAddedHandlers\"></a>VideoAddedHandlers</h4><p>Another portion we need to keep an eye on is the VideoAddedHandlers class.  As the name implies this class is responsible for performing some action(s) every time a video is added to KillrVideo.  If you take a look at the two prepared statements within the init() method you should notice they are inserting data into the 2 search tables we mentioned above <strong>tags_by_letter</strong> and <strong>videos_by_tag</strong>.<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\">videosByTagPrepared = dseSession.prepare(</div><div class=\"line\">        <span class=\"string\">\"INSERT INTO \"</span> + Schema.KEYSPACE + <span class=\"string\">\".\"</span> + videosByTagTableName + <span class=\"string\">\" \"</span> +</div><div class=\"line\">                <span class=\"string\">\"(tag, videoid, added_date, userid, name, preview_image_location, tagged_date) \"</span> +</div><div class=\"line\">                <span class=\"string\">\"VALUES (?, ?, ?, ?, ?, ?, ?)\"</span></div><div class=\"line\">);</div><div class=\"line\"></div><div class=\"line\">tagsByLetterPrepared = dseSession.prepare(</div><div class=\"line\">        <span class=\"string\">\"INSERT INTO \"</span> + Schema.KEYSPACE + <span class=\"string\">\".\"</span> + tagsByLetterTableName + <span class=\"string\">\" \"</span> +</div><div class=\"line\">                <span class=\"string\">\"(first_letter, tag) VALUES (?, ?)\"</span></div><div class=\"line\">);</div></pre></td></tr></table></figure></p>\n<p>Every time a video is added these queries are fired off to power our searches.  Notice some of the column names, things like “tag” and “first_letter”.  Again, we will dig into the detailed logic here soon.</p>\n<h4 id=\"Detailed-logic-here-soon\"><a href=\"#Detailed-logic-here-soon\" class=\"headerlink\" title=\"Detailed logic here soon\"></a>Detailed logic here soon</h4><p>Alrighty, so, we’ve gone over a high level overview of the various items and objects we are using to support our Cassandra based searches.  Now, let’s get into the searches themselves and see what they are doing.</p>\n<h5 id=\"“Typeahead”-search-1\"><a href=\"#“Typeahead”-search-1\" class=\"headerlink\" title=\"“Typeahead” search\"></a>“Typeahead” search</h5><p>As I mentioned above the typeahead search simply takes the values the user types into the search bar and provides search suggestions based off of the sequence of letters typed in usually with a wildcard attached to the end of the sequence.  An example is something like “d” which might return “database”, “decision”, “document”, etc… Then, if the user continues with something like “da” could be “database”, “databases”, “datastax”, etc… and so on.</p>\n<p>In the Cassandra based search case this is supported by the <strong>tags_by_letter</strong> table.  Every time a video is added the related subscriber method in the VideoAddedHandlers class is called and <strong>ALL</strong> tags are inserted along with the first letter of the tag into their respective columns.  Since multiple tags are allowed this means we end up looping through and batching up all commands for each tag.</p>\n<p>Then, when a user starts typing into the search bar we have the following query to get our results:<br><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">SELECT</span> tag <span class=\"keyword\">FROM</span> tags_by_letter <span class=\"keyword\">WHERE</span> first_letter = ? <span class=\"keyword\">AND</span> tag &gt;= ?</div></pre></td></tr></table></figure></p>\n<p>Which returns all tags that match the query string from our search.  We loop through those results and send our tags back to the UI.  Pretty simple.  </p>\n<p>Remember I previously mentioned the <strong>first_letter</strong> column is the partition key and <strong>tag</strong> is the clustering column which handles data ordering.  This is where this all comes into play.  </p>\n<p>At this point I’d like to point out that we are working only with tags.  <strong>Neither the name or description of any videos are considered</strong>.  Sure, we could add support for this in our data model and code if we really wanted to, but it is something we have to explicitly take into account if we want that capability. </p>\n<h5 id=\"Tag-search-1\"><a href=\"#Tag-search-1\" class=\"headerlink\" title=\"Tag search\"></a>Tag search</h5><p>Ok, let’s move to the tag based search.  This one is pretty straightforward.  Click on a tag button in the video details page and return all videos that have the same tag.  This search is supported by the <strong>videos_by_tag</strong> table.  Every time a video is added the related subscriber method in the VideoAddedHandlers class is called and an entry is made for each tag associated with the video.  If a video has one tag there will be a single entry, if it has 5 there will be 5 entries, and so on.  Note that the <strong>videos_by_tag</strong> table is optimized specifically for this task.</p>\n<p>If you click on a tag button the following query is executed:<br><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">SELECT</span> * <span class=\"keyword\">FROM</span> videos_by_tag <span class=\"keyword\">WHERE</span> tag = ?</div></pre></td></tr></table></figure></p>\n<p>Which returns all videos that match the tag provided in the query.  We send these back to the UI which provides a list of videos for you to choose from.</p>\n<h5 id=\"“More-videos-like-this”-search-1\"><a href=\"#“More-videos-like-this”-search-1\" class=\"headerlink\" title=\"“More videos like this” search\"></a>“More videos like this” search</h5><p>The related videos or “More videos like this” section is very similar to the tag search.  The difference in this case is instead of matching only to the selected tag this search will find videos that match all tags of the selected video.  So, if my selected video has tags of “datastax”, “dsl”, “graph”, and “gremlin” then the search will return videos that include any of those.  It uses the same query as the tag search above.  The only difference is we’ll perform a query for each tag that exists with the video and combine the results.</p>\n<h2 id=\"A-couple-things-to-point-out\"><a href=\"#A-couple-things-to-point-out\" class=\"headerlink\" title=\"A couple things to point out\"></a>A couple things to point out</h2><p>For one, notice how our tables and searches work in lock-step.  The tables were created to support a particular set of searches or “questions” asked by our application UI and our code supports whatever CRUD operations are needed to maintain the data we use for searches.  Essentially this was all purpose made to fit our search needs exactly in a denormalized fashion.  This is quite different from how we may have handled things in the relational world.</p>\n<p>Also notice the number of operations needed, mostly on the insert end, to constantly populate the search based tables with data when videos are added to the system.  Now, we’re talking about Cassandra here so this is not really that much of an issue, but there is overhead associated with those operations and the code needed to support it.</p>\n<h2 id=\"Why-move-to-DSE-Search\"><a href=\"#Why-move-to-DSE-Search\" class=\"headerlink\" title=\"Why move to DSE Search?\"></a>Why move to DSE Search?</h2><p>So, what happens now when we want to expand our searches to include more fields separate from tag, provide more varied results, or enable advanced searches?  Is there a way we could reduce the number of overall actions and code needed to support our searches and also speed things up?  Lastly, can we do this in such a way that does not take a whole rethink of our data model?</p>\n<p>Well, I think at this point you know exactly what I’m going to suggest, but you’ll have to wait until part 2 of this series for details.</p>\n<p>Oooo…suspense…I know….totally suspenseful</p>\n<p>Until then (quite soon honestly), thanks for reading and I hope you got something useful out of part 1.  Always feel free to add comments or contact me directly for any thoughts or questions.</p>\n<p>Take care :D</p>"}],"PostAsset":[{"_id":"source/_posts/Mixed-Workload-DSE-Cluster-with-Raspberry-PI-s/raspberry.jpg","slug":"raspberry.jpg","post":"cjcqm9a61000ov6km4zzyyrfl","modified":1,"renderable":0},{"_id":"source/_posts/Dropping-in-on-my-cluster/datastax_drop.gif","slug":"datastax_drop.gif","post":"cjcqm9a590002v6km8ltkbqr7","modified":1,"renderable":0},{"_id":"source/_posts/Mixed-Workload-DSE-Cluster-with-Raspberry-PI-s/myPIs.gif","slug":"myPIs.gif","post":"cjcqm9a61000ov6km4zzyyrfl","modified":1,"renderable":0},{"_id":"source/_posts/Mixed-Workload-DSE-Cluster-with-Raspberry-PI-s/opscenter_cluster.png","post":"cjcqm9a61000ov6km4zzyyrfl","slug":"opscenter_cluster.png","modified":1,"renderable":1},{"_id":"source/_posts/Mixed-Workload-DSE-Cluster-with-Raspberry-PI-s/pie-pi.jpg","post":"cjcqm9a61000ov6km4zzyyrfl","slug":"pie-pi.jpg","modified":1,"renderable":1},{"_id":"source/_posts/Mixed-Workload-DSE-Cluster-with-Raspberry-PI-s/raspberrypi.jpg","post":"cjcqm9a61000ov6km4zzyyrfl","slug":"raspberrypi.jpg","modified":1,"renderable":1},{"_id":"source/_posts/Moving-from-Cassandra-tables-to-Search-with-DataStax-Part-I/morelikethis.png","slug":"morelikethis.png","post":"cjcqm9a6f000wv6kmlkzc9f6b","modified":1,"renderable":0},{"_id":"source/_posts/Moving-from-Cassandra-tables-to-Search-with-DataStax-Part-I/overviewarch.png","post":"cjcqm9a6f000wv6kmlkzc9f6b","slug":"overviewarch.png","modified":1,"renderable":1},{"_id":"source/_posts/Moving-from-Cassandra-tables-to-Search-with-DataStax-Part-I/tag.png","post":"cjcqm9a6f000wv6kmlkzc9f6b","slug":"tag.png","modified":1,"renderable":1},{"_id":"source/_posts/Moving-from-Cassandra-tables-to-Search-with-DataStax-Part-I/tagsbyletterexample.png","post":"cjcqm9a6f000wv6kmlkzc9f6b","slug":"tagsbyletterexample.png","modified":1,"renderable":1},{"_id":"source/_posts/Moving-from-Cassandra-tables-to-Search-with-DataStax-Part-I/typeahead.png","slug":"typeahead.png","post":"cjcqm9a6f000wv6kmlkzc9f6b","modified":1,"renderable":0},{"_id":"source/_posts/Moving-from-Cassandra-tables-to-Search-with-DataStax-Part-I/videodetail.png","slug":"videodetail.png","post":"cjcqm9a6f000wv6kmlkzc9f6b","modified":1,"renderable":0}],"PostCategory":[{"post_id":"cjcqm9a560001v6kmzj6f5wkm","category_id":"cjcqm9a5b0003v6km5n0ouenj","_id":"cjcqm9a5h0007v6kmezlugwnc"},{"post_id":"cjcqm9a590002v6km8ltkbqr7","category_id":"cjcqm9a5h0005v6km2jrs7ysz","_id":"cjcqm9a5i0009v6kmp17i327f"},{"post_id":"cjcqm9a5z000nv6kmb74oez6v","category_id":"cjcqm9a66000pv6kmu6e5qkte","_id":"cjcqm9a6h000xv6kmr5tj1g3i"},{"post_id":"cjcqm9a6c000tv6km5li4uv4w","category_id":"cjcqm9a5b0003v6km5n0ouenj","_id":"cjcqm9a6i000zv6kmumnkusi0"},{"post_id":"cjcqm9a61000ov6km4zzyyrfl","category_id":"cjcqm9a66000pv6kmu6e5qkte","_id":"cjcqm9a6j0010v6kmru8lpcrg"}],"PostTag":[{"post_id":"cjcqm9a560001v6kmzj6f5wkm","tag_id":"cjcqm9a5d0004v6kmjdomkygt","_id":"cjcqm9a5j000cv6km5mzh5i0l"},{"post_id":"cjcqm9a560001v6kmzj6f5wkm","tag_id":"cjcqm9a5h0006v6kmjga9j0nk","_id":"cjcqm9a5j000dv6kmfzx57olr"},{"post_id":"cjcqm9a560001v6kmzj6f5wkm","tag_id":"cjcqm9a5i0008v6kml3dosyhh","_id":"cjcqm9a5k000fv6kmljgkb76g"},{"post_id":"cjcqm9a560001v6kmzj6f5wkm","tag_id":"cjcqm9a5j000av6kmsgqj97n7","_id":"cjcqm9a5k000gv6kmxh01r2br"},{"post_id":"cjcqm9a590002v6km8ltkbqr7","tag_id":"cjcqm9a5j000bv6kmxsk4zc70","_id":"cjcqm9a5k000jv6km343cr8g4"},{"post_id":"cjcqm9a590002v6km8ltkbqr7","tag_id":"cjcqm9a5j000ev6kmmwcmoj5f","_id":"cjcqm9a5k000kv6kmlv57z1j9"},{"post_id":"cjcqm9a590002v6km8ltkbqr7","tag_id":"cjcqm9a5k000hv6kmhj3al30o","_id":"cjcqm9a5k000lv6kmb8kjy3il"},{"post_id":"cjcqm9a590002v6km8ltkbqr7","tag_id":"cjcqm9a5k000iv6kmgfkboanj","_id":"cjcqm9a5k000mv6kmc8xkfz84"},{"post_id":"cjcqm9a5z000nv6kmb74oez6v","tag_id":"cjcqm9a66000qv6kmtx58m73x","_id":"cjcqm9a6l0014v6kmemkhovc8"},{"post_id":"cjcqm9a5z000nv6kmb74oez6v","tag_id":"cjcqm9a6e000vv6kmijxpvzol","_id":"cjcqm9a6n0015v6kmxt3n1lsq"},{"post_id":"cjcqm9a5z000nv6kmb74oez6v","tag_id":"cjcqm9a6i000yv6kmnjvz7wj6","_id":"cjcqm9a6o0017v6km1af5jlf5"},{"post_id":"cjcqm9a5z000nv6kmb74oez6v","tag_id":"cjcqm9a6j0011v6km1l34lck0","_id":"cjcqm9a6o0018v6kmap7lhis0"},{"post_id":"cjcqm9a5z000nv6kmb74oez6v","tag_id":"cjcqm9a6k0012v6kmazikjuxr","_id":"cjcqm9a6q001av6kmlx2qfe5i"},{"post_id":"cjcqm9a61000ov6km4zzyyrfl","tag_id":"cjcqm9a6k0013v6kme1mkehpj","_id":"cjcqm9a6t001cv6km7pjx16pc"},{"post_id":"cjcqm9a61000ov6km4zzyyrfl","tag_id":"cjcqm9a6n0016v6kmkj9bg58t","_id":"cjcqm9a6t001dv6km8361otyk"},{"post_id":"cjcqm9a61000ov6km4zzyyrfl","tag_id":"cjcqm9a6k0012v6kmazikjuxr","_id":"cjcqm9a6t001ev6kmgemderlg"},{"post_id":"cjcqm9a6c000tv6km5li4uv4w","tag_id":"cjcqm9a6k0012v6kmazikjuxr","_id":"cjcqm9a6u001fv6km05i2zrep"},{"post_id":"cjcqm9a6c000tv6km5li4uv4w","tag_id":"cjcqm9a5j000bv6kmxsk4zc70","_id":"cjcqm9a6u001gv6kmt5c1w6lp"}],"Tag":[{"name":"hi there","_id":"cjcqm9a5d0004v6kmjdomkygt"},{"name":"welcome","_id":"cjcqm9a5h0006v6kmjga9j0nk"},{"name":"fun times","_id":"cjcqm9a5i0008v6kml3dosyhh"},{"name":"OMG","_id":"cjcqm9a5j000av6kmsgqj97n7"},{"name":"datastax","_id":"cjcqm9a5j000bv6kmxsk4zc70"},{"name":"opscenter","_id":"cjcqm9a5j000ev6kmmwcmoj5f"},{"name":"aerial","_id":"cjcqm9a5k000hv6kmhj3al30o"},{"name":"drop","_id":"cjcqm9a5k000iv6kmgfkboanj"},{"name":"TIL","_id":"cjcqm9a66000qv6kmtx58m73x"},{"name":"async","_id":"cjcqm9a6e000vv6kmijxpvzol"},{"name":"blocking","_id":"cjcqm9a6i000yv6kmnjvz7wj6"},{"name":"java","_id":"cjcqm9a6j0011v6km1l34lck0"},{"name":"killrvideo","_id":"cjcqm9a6k0012v6kmazikjuxr"},{"name":"raspberry PI","_id":"cjcqm9a6k0013v6kme1mkehpj"},{"name":"cluster","_id":"cjcqm9a6n0016v6kmkj9bg58t"}]}}